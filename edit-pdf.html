<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>PDF Editor Online Free - Edit PDF Files Online Without Installation | easyjpgtopdf</title>
    <meta name="description" content="Edit PDF files online for free. Add text, images, annotations, modify PDF documents, highlight content - all without software installation. Best free online PDF editor 2024.">
    <meta name="keywords" content="pdf editor online free, edit pdf online, free pdf editor, online pdf editor, edit pdf files, pdf editing tool, modify pdf, edit pdf documents, pdf editor free online, best pdf editor online, edit pdf online free no download, pdf editor website, free online pdf editor, edit pdf text, pdf editor tool">
<link href="css/footer.css" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&amp;family=Roboto:wght@400;700&amp;family=Open+Sans:wght@400;700&amp;family=Lato:wght@400;700&amp;family=Poppins:wght@400;700&amp;family=Montserrat:wght@400;700&amp;family=Source+Sans+3:wght@400;700&amp;family=Noto+Sans:wght@400;700&amp;family=Merriweather:wght@400;700&amp;family=PT+Sans:wght@400;700&amp;family=PT+Serif:wght@400;700&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&amp;family=Raleway:wght@400;700&amp;family=Ubuntu:wght@400;700&amp;family=Work+Sans:wght@400;700&amp;family=Karla:wght@400;700&amp;family=Heebo:wght@400;700&amp;family=Rubik:wght@400;700&amp;family=Titillium+Web:wght@400;700&amp;display=swap" rel="stylesheet"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<!-- PDF.js libraries -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js"></script>

<style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        :root { --primary: #4361ee; --primary-dark: #3a0ca3; --secondary: #f72585; --success: #4cc9f0; --light: #f8f9fa; --dark: #212529; --gray: #6c757d; --border-radius: 12px; --box-shadow: 0 5px 15px rgba(0,0,0,0.08); --transition: all 0.3s ease; }
        body { background: linear-gradient(135deg, #f5f7ff 0%, #e9ecef 100%); color: var(--dark); min-height: 100vh; line-height: 1.6; display:flex; flex-direction:column; }
        .container { width: 100%; max-width: 1400px; margin: 0 auto; padding: 0 20px; }
        header { background: #fff; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 10px rgba(0,0,0,.08); }
        .navbar { display: flex; justify-content: space-between; align-items: center; padding: 14px 0; }
        .logo { display: flex; gap: 10px; align-items: center; font-size: 22px; font-weight: 700; color: var(--primary); text-decoration: none; }
        .logo i { color: var(--primary-dark); }
        .nav-links { display: flex; gap: 22px; }
        .nav-links a { text-decoration: none; color: var(--dark); font-weight: 500; }
        .nav-links a.active, .nav-links a:hover { color: var(--primary); }
        .dropdown { position: relative; }
        .dropdown-content { display: none; position: absolute; background: #fff; min-width: 200px; box-shadow: 0 8px 16px rgba(0,0,0,.1); border-radius: 8px; padding: 10px 0; top: 100%; left: 0; }
        .dropdown:hover .dropdown-content { display: block; }
        .dropdown-content a { display: block; padding: 10px 20px; text-decoration: none; color: var(--dark); }
        .dropdown-content a:hover { background: var(--light); }
        .auth-buttons { display:flex; gap:10px; }
        .auth-btn { padding:6px 15px; border-radius:50px; text-decoration:none; font-weight:500; transition:.3s; font-size:.9rem; }
        .auth-btn.login { background: transparent; color: var(--primary); border:1px solid var(--primary); }
        .auth-btn.signup { background: var(--primary); color:#fff; border:1px solid var(--primary); }
        .page-wrap { padding: 20px 0; }
        .editor-header { text-align: center; margin-bottom: 30px; padding: 20px; }
        .editor-header h1 { font-size: 2.2rem; color: var(--primary); margin-bottom: 10px; }
        .editor-header p { font-size: 1.05rem; color: var(--gray); max-width: 700px; margin: 0 auto; }
        .editor-card { background: #fff; border-radius: var(--border-radius); padding: 30px; box-shadow: var(--box-shadow); margin-bottom: 30px; }
        .upload-area { border: 4px dashed #ddd; border-radius: var(--border-radius); padding: 80px 40px; text-align: center; cursor: pointer; margin-bottom: 30px; transition: var(--transition); position: relative; min-height: 400px; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .upload-area:hover { border-color: var(--primary); background: rgba(67, 97, 238, 0.05); }
        .upload-area.dragover { border-color: var(--primary); background: rgba(67, 97, 238, 0.12); }
        .upload-icon { font-size: 120px; color: var(--primary); margin-bottom: 30px; }
        .upload-area h3 { font-size: 2.2rem; margin-bottom: 15px; color: var(--dark); font-weight: 700; }
        .upload-area p { color: var(--gray); margin-bottom: 8px; font-size: 1.1rem; }
        .file-input { display: none; }
        #browse-btn { font-size: 1.4rem; padding: 20px 50px; min-height: 70px; min-width: 280px; font-weight: 700; border-radius: 50px; margin-top: 30px; display: inline-flex; align-items: center; justify-content: center; gap: 15px; box-shadow: 0 8px 20px rgba(67, 97, 238, 0.25); }
        #browse-btn:hover { transform: translateY(-3px); box-shadow: 0 12px 30px rgba(67, 97, 238, 0.35); }
        #browse-btn i { font-size: 1.6rem; }
        .file-info { background: var(--light); border-radius: var(--border-radius); padding: 20px; margin: 20px 0; display: none; }
        .file-details { display: flex; align-items: center; gap: 15px; }
        .file-icon { font-size: 40px; color: var(--primary); }
        .file-text h4 { font-size: 1.2rem; margin-bottom: 5px; }
        .file-text p { color: var(--gray); font-size: 0.9rem; }

        .color-picker { width: 40px; height: 40px; border: none; border-radius: 8px; cursor: pointer; }
        
        .font-select, .font-size-select { padding: 8px 12px; border: 1px solid #ddd; border-radius: 8px; background: white; }
        
        .highlight-color { display: flex; gap: 10px; flex-wrap: wrap; }
        .highlight-btn { width: 30px; height: 30px; border: 2px solid transparent; border-radius: 4px; cursor: pointer; }
        .highlight-btn.active { border-color: var(--dark); }
        .preview-container { flex: 1; display: flex; flex-direction: column; }
        .ribbon { display:flex; flex-direction:column; gap:8px; background:#fff; border:1px solid #e5e7eb; border-radius:10px; padding:10px; margin-bottom:10px; }
        .ribbon-row { display:flex; gap:12px; align-items:center; flex-wrap:wrap }
        .ribbon-group { display:flex; gap:8px; align-items:center; padding:6px 8px; border-right:1px solid #eee }
        .ribbon-group:last-child { border-right:none }
        .group-title { font-size:.75rem; color:#6c757d; margin-right:6px; text-transform:uppercase }
        .ribbon select, .ribbon input[type="color"] { padding:6px 8px; border:1px solid #ddd; border-radius:8px; background:#fff }
        .ribbon .btn { padding:8px 12px }
        .zoom-label { color:#6c757d; min-width:54px; text-align:center; }
        .preview-area { border: 1px solid #ddd; border-radius: var(--border-radius); padding: 20px; background: white; flex: 1; display: flex; justify-content: center; align-items: flex-start; overflow: auto; box-shadow: 0 2px 8px rgba(0,0,0,0.1); position: relative; }
        .a4-preview { width: 595px; min-height: 842px; background: white; box-shadow: 0 4px 12px rgba(0,0,0,0.15); position: relative; margin: 0 auto; transform-origin: top left; }
        #pdf-canvas { display: block; width: 100%; height: 100%; }
        #overlay-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        /* Container to hold editable text elements */
        #text-layer { position: absolute; inset: 0; pointer-events: auto; }
        /* Overlay image items */
        .overlay-image { position:absolute; max-width:595px; cursor:move; user-select:none; border:1px dashed transparent; z-index:61; }
        .overlay-image.selected { border-color:#4361ee; }
        .editable-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; cursor: text; }
        .page-navigation { display: flex; justify-content: center; align-items: center; gap: 15px; margin-top: 20px; }
        .page-btn { display: flex; align-items: center; justify-content: center; width: 40px; height: 40px; border: none; border-radius: 8px; background: var(--primary); color: white; cursor: pointer; transition: var(--transition); }
        .page-btn:hover { background: var(--primary-dark); }
        .page-btn:disabled { background: #ccc; cursor: not-allowed; }
        .page-info { font-weight: 500; }
        .action-buttons { display: flex; gap: 15px; margin-top: 25px; flex-wrap: wrap; }
        .btn { display: inline-flex; align-items: center; justify-content: center; gap: 8px; padding: 12px 24px; border: none; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: var(--transition); text-decoration: none; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-dark); transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .btn-secondary { background: white; color: var(--primary); border: 2px solid var(--primary); }
        .btn-secondary:hover { background: var(--light); }
        .btn:disabled { background: #ccc; cursor: not-allowed; transform: none; box-shadow: none; }
        .progress-container { margin: 20px 0; display: none; }
        .progress-bar { width: 100%; height: 10px; background: #e9ecef; border-radius: 5px; overflow: hidden; }
        .progress { height: 100%; background: linear-gradient(90deg, var(--primary), var(--success)); width: 0%; transition: width 0.4s ease; }
        .progress-text { text-align: center; margin-top: 10px; color: var(--gray); font-size: 0.9rem; }
        .loading { display: none; text-align: center; padding: 30px; }
        .loading-spinner { border: 4px solid #f3f3f3; border-top: 4px solid var(--primary); border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; margin: 0 auto 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .message { padding: 15px; border-radius: 8px; margin: 20px 0; display: none; }
        .success-message { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error-message { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .features { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 40px; }
        .feature-card { background: #fff; border-radius: var(--border-radius); padding: 25px; text-align: center; box-shadow: var(--box-shadow); transition: var(--transition); }
        .feature-card:hover { transform: translateY(-5px); }
        .feature-icon { font-size: 40px; color: var(--primary); margin-bottom: 15px; }
        .feature-card h3 { margin-bottom: 10px; color: var(--dark); }
        .feature-card p { color: var(--gray); }
        footer { background: #212529; color: #fff; margin-top: auto; padding: 60px 0 30px; }
        .footer-content { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 40px; margin-bottom: 40px; }
        .footer-links { list-style: none; }
        .footer-links a { color: #aaa; text-decoration: none; }
        .footer-links a:hover { color: #fff; }
        .copyright { text-align: center; color: #aaa; border-top: 1px solid #444; padding-top: 16px; font-size: .9rem; }
        
        /* Text editor */
        .text-editor { position: absolute; z-index: 100; background: white; border: 1px solid #ddd; border-radius: 4px; padding: 5px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); display: none; }
        .text-editor input { border: none; outline: none; font-size: 14px; width: 200px; }
        
        /* Editable text elements */
        .editable-text { position: absolute; cursor: text; padding: 2px 5px; border: 1px dashed transparent; user-select: text; white-space: pre-wrap; z-index: 60; }
        .editable-text:hover { border-color: var(--primary); background: rgba(67, 97, 238, 0.05); }
        .editable-text.selected { border-color: var(--primary); background: rgba(67, 97, 238, 0.1); }
        .editable-text.editing { border: 2px solid var(--primary); background: #fff; z-index: 100; outline: none; }
        .mask-block { position:absolute; background:#fff; pointer-events:none; z-index: 50; }
        
        /* Context menu */
        .context-menu { position: absolute; background: white; border: 1px solid #ddd; border-radius: 4px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); z-index: 1000; display: none; }
        .context-menu-item { padding: 8px 15px; cursor: pointer; border-bottom: 1px solid #eee; }
        .context-menu-item:last-child { border-bottom: none; }
        .context-menu-item:hover { background: #f5f5f5; }
        
        @media (max-width: 1024px) {

            .a4-preview { width: 100%; max-width: 595px; }
        }

        // Insert Image handlers
        let selectedImageEl = null;
        function onImageChosen(e){
            const f = e.target.files && e.target.files[0]; if(!f) return;
            const reader = new FileReader();
            reader.onload = function(){
                const img = new Image();
                img.onload = function(){
                    img.className = 'overlay-image';
                    img.src = reader.result;
                    img.dataset.baseW = Math.min(img.naturalWidth, 400);
                    img.dataset.baseH = img.naturalHeight * (img.dataset.baseW / img.naturalWidth);
                    img.style.left = '50px';
                    img.style.top = '50px';
                    img.style.width = img.dataset.baseW + 'px';
                    img.style.height = 'auto';
                    img.tabIndex = 0;
                    img.addEventListener('click', (ev)=>{ ev.stopPropagation(); selectImage(img); });
                    img.addEventListener('dblclick', (ev)=>{ ev.stopPropagation(); selectImage(img); });
                    // Drag with Ctrl
                    img.addEventListener('mousedown', (ev)=>{
                        if(!ev.ctrlKey) return; ev.preventDefault(); selectImage(img);
                        const sx=ev.clientX, sy=ev.clientY; const l=parseFloat(img.style.left)||0; const t=parseFloat(img.style.top)||0;
                        function mm(e2){ img.style.left = (l + e2.clientX - sx) + 'px'; img.style.top = (t + e2.clientY - sy) + 'px'; }
                        function mu(){ window.removeEventListener('mousemove', mm); window.removeEventListener('mouseup', mu); }
                        window.addEventListener('mousemove', mm); window.addEventListener('mouseup', mu);
                    });
                    textLayer.appendChild(img);
                    selectImage(img);
                    imgFileInput.value = '';
                };
                img.src = reader.result;
            };
            reader.readAsDataURL(f);
        }
        function selectImage(el){
            document.querySelectorAll('.overlay-image.selected').forEach(x=>x.classList.remove('selected'));
            el.classList.add('selected'); selectedImageEl = el;
            if(tbImageScale){
                const baseW = parseFloat(el.dataset.baseW)||parseFloat(el.style.width)||100;
                const curW = parseFloat(el.style.width)||baseW;
                tbImageScale.value = Math.round((curW/baseW)*100);
            }
        }
        function onImageScaleChange(){
            if(!selectedImageEl) return;
            const baseW = parseFloat(selectedImageEl.dataset.baseW)||parseFloat(selectedImageEl.style.width)||100;
            const scale = Math.max(10, Math.min(300, parseInt(tbImageScale.value||'100',10)))/100;
            selectedImageEl.style.width = (baseW * scale) + 'px';
        }
        @media (max-width: 768px) { 
            .nav-links { display: none; } 
            .action-buttons { flex-direction: column; } 
            .btn { width: 100%; justify-content: center; } 

        }
    </style>
<link href="css/header.css" rel="stylesheet"/>
<link href="css/theme-modern.css" rel="stylesheet"/>
        <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "PDF Editor Online Free",
      "description": "Edit PDF files online for free. Add text, images, annotations, modify PDF documents, highlight content - all without software installation. Best free online PDF editor 2024.",
      "url": "https://easyjpgtopdf.com/edit-pdf.html",
      "applicationCategory": "UtilityApplication",
      "operatingSystem": "Any",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "featureList": [
        "Edit PDF text online",
        "Add images to PDF",
        "OCR text recognition",
        "Real-time PDF editing",
        "Full A4 preview",
        "No software installation required"
      ],
      "inLanguage": "en-US",
      "isPartOf": {
        "@type": "WebSite",
        "name": "easyjpgtopdf",
        "url": "https://easyjpgtopdf.com"
      },
      "publisher": {
        "@type": "Organization",
        "name": "easyjpgtopdf",
        "url": "https://easyjpgtopdf.com"
      },
      "author": {
        "@type": "Person",
        "name": "Riyaz Mohammad"
      }
    }
    </script>
</head>
<body>
<header>
        <div class="container">
            <nav class="navbar">
                <a href="index.html" class="logo"><img src="images/logo.png" alt="Logo" style="height:54px;"></a>
                <div class="nav-links">
                    <div class="dropdown">
                        <a href="#">Convert to PDF <i class="fas fa-chevron-down"></i></a>
                        <div class="dropdown-content">
                            <a href="jpg-to-pdf.html">JPG to PDF</a>
                            <a href="word-to-pdf.html">Word to PDF</a>
                            <a href="excel-to-pdf.html">Excel to PDF</a>
                            <a href="ppt-to-pdf.html">PowerPoint to PDF</a>
                        </div>
                    </div>
                    <div class="dropdown">
                        <a href="#">Convert from PDF <i class="fas fa-chevron-down"></i></a>
                        <div class="dropdown-content">
                            <a href="pdf-to-jpg.html">PDF to JPG</a>
                            <a href="pdf-to-word.html">PDF to Word</a>
                            <a href="pdf-to-excel.html">PDF to Excel</a>
                            <a href="pdf-to-ppt.html">PDF to PowerPoint</a>
                        </div>
                    </div>
                    <div class="dropdown">
                        <a href="#">Pdf Editor <i class="fas fa-chevron-down"></i></a>
                        <div class="dropdown-content">
                            <a href="merge-pdf.html">Merge PDF</a>
                            <a href="split-pdf.html">Split PDF</a>
                            <a href="compress-pdf.html">Compress PDF</a>
                            <a href="edit-pdf.html">Pdf Editor</a>
                            <a href="protect-pdf.html">Protect PDF</a>
                            <a href="unlock-pdf.html">Unlock PDF</a>
                            <a href="watermark-pdf.html">Watermark PDF</a>
                            <a href="crop-pdf.html">Crop PDF</a>
                            <a href="add-page-numbers.html">Add Page Numbers</a>
                        </div>
                    </div>
                    <div class="dropdown">
                        <a href="#">Image Tools <i class="fas fa-chevron-down"></i></a>
                        <div class="dropdown-content">
                            <a href="image-repair.html">AI Image Repair</a>
                            <a href="image-compressor.html">Image Compressor</a>
                            <a href="image-resizer.html">Image Resizer</a>
                            <a href="image-editor.html">Image Editor</a>
                            <a href="background-remover.html">Image Background Remover</a>
                            <a href="ocr-image.html">OCR Image</a>
                            <a href="image-watermark.html">Image Watermark Tool</a>
                        </div>
                    </div>
                    <div class="dropdown">
                        <a href="#">Other Tools <i class="fas fa-chevron-down"></i></a>
                        <div class="dropdown-content">
                            <a href="resume-maker.html">Resume Maker</a>
                            <a href="biodata-maker.html">Marrige Biodata-Data Maker</a>
                            <a href="ai-image-generator.html">AI Image Generator</a>
                            <a href="marriage-card.html">Marriage Card</a>
                            <a href="excel-unlocker/" target="_blank">Excel Unlocker</a>
                            <a href="protect-excel.html">Protect Excel Sheet</a>
                        </div>
                    </div>
                    <div class="dropdown">
                        <a href="#">More <i class="fas fa-chevron-down"></i></a>
                        <div class="dropdown-content">
                            <a href="pricing.html">Pricing</a>
                            <a href="blog.html">Blog/Articles</a>

                        </div>
                    </div>
                </div>
                
                <div id="user-menu" class="user-menu" data-open="false">
                    <button id="user-menu-toggle" class="user-menu-toggle" type="button" aria-haspopup="true" aria-expanded="false" aria-label="Account menu">
                        <span class="user-initial" aria-hidden="true">U</span>
                        <i class="fas fa-chevron-down" aria-hidden="true"></i>
                    </button>
                    <div class="user-dropdown" id="user-dropdown" hidden>
                        <a href="dashboard.html#dashboard-overview" data-user-nav="dashboard-overview"><i class="fas fa-user-circle"></i> Account Dashboard</a>
                        <a href="dashboard.html#dashboard-billing" data-user-nav="dashboard-billing"><i class="fas fa-file-invoice"></i> Billing Details</a>
                        <a href="dashboard.html#dashboard-payments" data-user-nav="dashboard-payments"><i class="fas fa-wallet"></i> Payment History</a>
                        <a href="dashboard.html#dashboard-orders" data-user-nav="dashboard-orders"><i class="fas fa-clipboard-list"></i> Orders &amp; Subscriptions</a>
                        <a href="accounts.html#login"><i class="fas fa-user-cog"></i> Account Center</a>
                        <button type="button" id="logout-button" class="dropdown-logout"><i class="fas fa-sign-out-alt"></i> Sign out</button>
                    </div>
                </div>
            </nav>
        </div>
    </header>

        <nav aria-label="Breadcrumb" style="padding: 15px 0; background: #f8f9ff; border-bottom: 1px solid #e2e6ff;">
        <div class="container" style="max-width: 1200px; margin: 0 auto; padding: 0 24px;">
            <ol style="list-style: none; display: flex; flex-wrap: wrap; gap: 10px; margin: 0; padding: 0; align-items: center;">
                <li><a href="index.html" style="color: #4361ee; text-decoration: none; font-weight: 500; transition: color 0.3s;" onmouseover="this.style.color='#3a0ca3'" onmouseout="this.style.color='#4361ee'">Home</a></li>
                <li><span style="margin: 0 8px; color: #9ca3af;">|</span></li>
                <li><a href="login.html" style="color: #56607a; font-weight: 500; text-decoration: none; transition: color 0.3s;" onmouseover="this.style.color='#4361ee'" onmouseout="this.style.color='#56607a'">Sign In</a></li>
                <li><span style="margin: 0 8px; color: #9ca3af;">|</span></li>
                <li><a href="signup.html" style="color: #56607a; font-weight: 500; text-decoration: none; transition: color 0.3s;" onmouseover="this.style.color='#4361ee'" onmouseout="this.style.color='#56607a'">Signup</a></li>
            </ol>
        </div>
    </nav>

<div class="container page-wrap"><div class="editor-header">
<h1>PDF Editor Online Free - Edit PDF Files Online Without Installation</h1>
<p>Edit PDF files online for free with our advanced PDF editor tool. Add text, images, annotations, highlight content, modify PDF documents, and more - all without software installation. Best free online PDF editor 2024.</p>
</div>

<div class="editor-card">
<div aria-label="Upload your PDF" class="upload-area" id="upload-area" role="button" tabindex="0">
<div class="upload-icon"><i class="fas fa-file-pdf"></i></div>
<h3>Upload Your PDF File</h3>
<p>Drag &amp; drop your PDF file here</p>
<p>or click to browse files</p>
<div style="margin-top:10px">
<label class="btn btn-secondary" for="file-input" id="browse-btn"><i class="fas fa-folder-open"></i> Choose PDF</label>
</div>
<input accept="application/pdf,.pdf" class="file-input" id="file-input" type="file"/>
</div>

<div class="file-info" id="file-info" style="display: none;">
<div class="file-details">
<div class="file-icon"><i class="fas fa-file-pdf"></i></div>
<div class="file-text">
<h4 id="file-name">document.pdf</h4>
<p id="file-size">0 KB</p>
</div>
</div>
</div>

<h2 style="text-align: center; font-size: 1.8rem; color: var(--primary); margin: 30px 0 20px; font-weight: 700;">Features of Our Free PDF Editor</h2>
<div class="features">
<div class="feature-card">
<div class="feature-icon"><i class="fas fa-edit"></i></div>
<h3>Direct Text Editing</h3>
<p>Click and edit text directly on the PDF with real-time preview</p>
</div>
<div class="feature-card">
<div class="feature-icon"><i class="fas fa-palette"></i></div>
<h3>Font Customization</h3>
<p>Change font family, size, color and apply highlights to text</p>
</div>
<div class="feature-card">
<div class="feature-icon"><i class="fas fa-text-height"></i></div>
<h3>Add New Text</h3>
<p>Insert new text anywhere on the PDF document</p>
</div>
<div class="feature-card">
<div class="feature-icon"><i class="fas fa-shield-alt"></i></div>
<h3>Secure &amp; Private</h3>
<p>Your files stay in your browser - no server uploads</p>
</div>
</div>
</div>

<script>
// Set PDF.js worker path
if (typeof pdfjsLib !== 'undefined') {
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
}

// DOM elements
const uploadArea = document.getElementById('upload-area');
const fileInput = document.getElementById('file-input');
const fileInfo = document.getElementById('file-info');
const fileName = document.getElementById('file-name');
const fileSize = document.getElementById('file-size');

// Format file size
function formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
}

// Handle file selection
function handleFile(file) {
    console.log("File selected:", file);
    
    // Validate file type
    if (file.type !== 'application/pdf' && !file.name.toLowerCase().endsWith('.pdf')) {
        alert('Please select a valid PDF file');
        return;
    }
    
    // Check file size (50MB limit)
    if (file.size > 50 * 1024 * 1024) {
        if(!confirm('This file is larger than 50MB. It may be slow to load. Continue?')){ 
            return; 
        }
    }
    
    // Show file info
    fileName.textContent = file.name;
    fileSize.textContent = formatFileSize(file.size);
    fileInfo.style.display = 'block';
    
    // Store file data and redirect to preview page
    const reader = new FileReader();
    reader.onload = function(e) {
        // Use IndexedDB for large files (better than sessionStorage)
        const request = indexedDB.open('PDFEditorDB', 1);
        
        request.onerror = function() {
            // Fallback: use blob URL if IndexedDB fails
            const blob = new Blob([e.target.result], { type: 'application/pdf' });
            const url = URL.createObjectURL(blob);
            sessionStorage.setItem('pdfFileURL', url);
            sessionStorage.setItem('pdfFileName', file.name);
            sessionStorage.setItem('pdfFileSize', file.size.toString());
            window.location.href = 'edit-pdf-preview.html';
        };
        
        request.onsuccess = function() {
            const db = request.result;
            
            // Create object store if it doesn't exist
            if (!db.objectStoreNames.contains('pdfFiles')) {
                db.close();
                const upgradeRequest = indexedDB.open('PDFEditorDB', 2);
                upgradeRequest.onupgradeneeded = function(event) {
                    const db = event.target.result;
                    if (!db.objectStoreNames.contains('pdfFiles')) {
                        db.createObjectStore('pdfFiles', { keyPath: 'id', autoIncrement: true });
                    }
                };
                upgradeRequest.onsuccess = function() {
                    storeFileAndRedirect(upgradeRequest.result, e.target.result, file);
                };
            } else {
                storeFileAndRedirect(db, e.target.result, file);
            }
        };
        
        request.onupgradeneeded = function(event) {
            const db = event.target.result;
            if (!db.objectStoreNames.contains('pdfFiles')) {
                db.createObjectStore('pdfFiles', { keyPath: 'id', autoIncrement: true });
            }
        };
    };
    
    reader.readAsArrayBuffer(file);
}

// Store file in IndexedDB and redirect
function storeFileAndRedirect(db, fileData, file) {
    const transaction = db.transaction(['pdfFiles'], 'readwrite');
    const store = transaction.objectStore('pdfFiles');
    
    // Clear old files
    store.clear().onsuccess = function() {
        // Store new file
        const request = store.add({
            data: fileData,
            name: file.name,
            size: file.size,
            type: file.type,
            timestamp: Date.now()
        });
        
        request.onsuccess = function() {
            // Store metadata in sessionStorage for quick access
            sessionStorage.setItem('pdfFileId', request.result.toString());
            sessionStorage.setItem('pdfFileName', file.name);
            sessionStorage.setItem('pdfFileSize', file.size.toString());
            sessionStorage.setItem('pdfFileType', file.type);
            
            // Redirect to preview page
            window.location.href = 'edit-pdf-preview.html';
        };
        
        request.onerror = function() {
            console.error('Failed to store file in IndexedDB');
            // Fallback to blob URL
            const blob = new Blob([fileData], { type: 'application/pdf' });
            const url = URL.createObjectURL(blob);
            sessionStorage.setItem('pdfFileURL', url);
            sessionStorage.setItem('pdfFileName', file.name);
            sessionStorage.setItem('pdfFileSize', file.size.toString());
            window.location.href = 'edit-pdf-preview.html';
        };
    };
}

// Event listeners
if (fileInput) {
    fileInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            handleFile(file);
        }
    });
}

if (uploadArea) {
    // Click to browse
    uploadArea.addEventListener('click', function() {
        fileInput.click();
    });
    
    // Keyboard support
    uploadArea.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            fileInput.click();
        }
    });
    
    // Drag and drop
    uploadArea.addEventListener('dragover', function(e) {
        e.preventDefault();
        uploadArea.classList.add('dragover');
    });
    
    uploadArea.addEventListener('dragleave', function(e) {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
    });
    
    uploadArea.addEventListener('drop', function(e) {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
        
        const file = e.dataTransfer.files[0];
        if (file) {
            handleFile(file);
        }
    });
}
</script>

<script src="js/auth.js" type="module"></script>
</div>
</div>

<footer>
        <div class="container footer-inner">
            <div class="footer-company-links">
                <span>Company</span>
                <a href="index.html#about">About Us</a>
                <a href="index.html#contact">Contact</a>
                <a href="pricing.html">Pricing</a>
                <a href="privacy-policy.html">Privacy Policy</a>
                <a href="terms-of-service.html">Terms of Service</a>
                <a href="dmca-en.html">DMCA</a>
                <a href="blog.html">Blog</a>
            </div>
            <p class="footer-brand-line">&copy; easyjpgtopdf &mdash; Free PDF &amp; Image Tools for everyone. All rights reserved.</p>
            <p class="footer-credits">
                Thanks to Font Awesome, Google Fonts, jsPDF, pdf.js, pdf-lib, Mammoth, Tesseract.js, IMG.LY, Firebase, Unsplash photographers, and every open-source contributor powering this site.
                <a href="attributions.html">See full acknowledgements</a>.
            </p>
        </div>
    </footer>
</body></html>');
            d.close();
            function addScript(src){ return new Promise((res,rej)=&gt;{ const s=d.createElement('script'); s.src=src; s.onload=res; s.onerror=rej; d.body.appendChild(s); }); }
            (async ()=&gt;{
                try{
                    await addScript('https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js');
                    // OCR functionality moved to backend API - see runOcrOnCurrentPage function
                    // This iframe code is for legacy preview - OCR now handled via /api/pdf-ocr/process
                    // toolbar handlers
                    d.getElementById('ff').addEventListener('change',()=&gt;{ if(selected){ selected.style.fontFamily=d.getElementById('ff').value; }});
                    d.getElementById('fs').addEventListener('change',()=&gt;{ if(selected){ selected.style.fontSize=d.getElementById('fs').value+'px'; }});
                    d.getElementById('tc').addEventListener('input',()=&gt;{ if(selected){ selected.style.color=d.getElementById('tc').value; }});
                    d.getElementById('bBold').addEventListener('click',()=&gt;{ if(selected){ const wgt=w.getComputedStyle(selected).fontWeight; selected.style.fontWeight=(wgt==='700'||wgt==='bold')?'400':'700'; }});
                    d.getElementById('bItalic').addEventListener('click',()=&gt;{ if(selected){ const st=w.getComputedStyle(selected).fontStyle; selected.style.fontStyle=(st==='italic')?'normal':'italic'; }});
                    d.getElementById('bUnderline').addEventListener('click',()=&gt;{ if(selected){ const dec=w.getComputedStyle(selected).textDecorationLine; selected.style.textDecoration=(dec.includes('underline'))?'none':'underline'; }});
                    // drag with Ctrl
                    layer.addEventListener('mousedown',e=&gt;{ const t=e.target; if(!(t&amp;&amp;t.classList&amp;&amp;t.classList.contains('editable-text'))) return; if(t.isContentEditable||!e.ctrlKey) return; e.preventDefault(); select(t); const sx=e.clientX, sy=e.clientY; const l=parseFloat(t.style.left)||0; const tp=parseFloat(t.style.top)||0; function mm(ev){ t.style.left=(l+ev.clientX-sx)+'px'; t.style.top=(tp+ev.clientY-sy)+'px'; } function mu(){ w.removeEventListener('mousemove',mm); w.removeEventListener('mouseup',mu);} w.addEventListener('mousemove',mm); w.addEventListener('mouseup',mu); });
                    // save
                    d.getElementById('bSave').addEventListener('click',()=&gt;{ const { jsPDF }=w.jspdf; const pdf=new jsPDF({unit:'pt',format:[595,842]}); const nodes=[...d.querySelectorAll('.editable-text')]; nodes.forEach(el=&gt;{ const left=parseFloat(el.style.left)||0; const top=parseFloat(el.style.top)||0; const fs=parseFloat(el.style.fontSize)||14; const fam=el.style.fontFamily||'Arial'; const col=el.style.color||'#000'; pdf.setTextColor(col); pdf.setFont(fam,'normal'); pdf.setFontSize(fs); const lines=(el.textContent||'').split('\n'); let y=top+fs*0.1; lines.forEach(line=&gt;{ pdf.text(line,left,y); y+=fs*1.2; }); }); pdf.save('ocr-edited.pdf'); });
                }catch(e){ console.error(e); }
            })();
        }
        
        // Change font of selected text
        function changeSelectedFont() {
            if (selectedTextElement) {
                const newFont = prompt('Enter font family:', selectedTextElement.style.fontFamily || 'Arial');
                if (newFont) {
                    selectedTextElement.style.fontFamily = newFont;
                    saveTextAnnotation(selectedTextElement);
                }
                contextMenu.style.display = 'none';
            }
        }
        
        // Change color of selected text
        function changeSelectedColor() {
            if (selectedTextElement) {
                const newColor = prompt('Enter color (hex or name):', selectedTextElement.style.color || '#000000');
                if (newColor) {
                    selectedTextElement.style.color = newColor;
                    saveTextAnnotation(selectedTextElement);
                }
                contextMenu.style.display = 'none';
            }
        }
        
        // Highlight selected text
        function highlightSelectedText() {
            if (selectedTextElement) {
                selectedTextElement.style.backgroundColor = highlightColor;
                saveTextAnnotation(selectedTextElement);
                contextMenu.style.display = 'none';
            }
        }
        
        // Remove selected text
        function removeSelectedText() {
            if (selectedTextElement) {
                if (confirm('Are you sure you want to remove this text?')) {
                    selectedTextElement.remove();
                    // Remove from annotations
                    textAnnotations = textAnnotations.filter(ann =&gt; 
                        !(ann.x === parseFloat(selectedTextElement.style.left) &amp;&amp; 
                          ann.y === parseFloat(selectedTextElement.style.top))
                    );
                    annotationHistory.push([...textAnnotations]);
                    redoHistory = [];
                    updateUndoRedoButtons();
                }
                contextMenu.style.display = 'none';
            }
        }
        
        // Select text element
        function selectTextElement(textEl) {
            document.querySelectorAll('.editable-text.selected').forEach(el =&gt; {
                el.classList.remove('selected');
            });
            textEl.classList.add('selected');
            selectedTextElement = textEl;
        }
        
        // Add new text at click position
        function addNewText(x, y) {
            const textEl = document.createElement('div');
            textEl.className = 'editable-text';
            textEl.textContent = 'New Text';
            textEl.style.left = x + 'px';
            textEl.style.top = y + 'px';
            const defSize = (tbFontSize &amp;&amp; tbFontSize.value) ? tbFontSize.value : (fontSizeSelect &amp;&amp; fontSizeSelect.value ? fontSizeSelect.value : '14');
            const defFamily = (tbFontFamily &amp;&amp; tbFontFamily.value) ? tbFontFamily.value : (fontFamilySelect &amp;&amp; fontFamilySelect.value ? fontFamilySelect.value : 'Noto Sans, Arial, sans-serif');
            const defColor = (tbColor &amp;&amp; tbColor.value) ? tbColor.value : (colorPicker &amp;&amp; colorPicker.value ? colorPicker.value : '#000');
            textEl.style.fontSize = defSize + 'px';
            textEl.style.fontFamily = defFamily;
            textEl.style.color = defColor;
            textEl.style.cursor = 'text';
            
            // Add event listeners
            textEl.addEventListener('dblclick', function(e) {
                e.stopPropagation();
                makeTextEditable(textEl);
            });
            
            textEl.addEventListener('contextmenu', function(e) {
                e.preventDefault();
                e.stopPropagation();
                showContextMenu(e, textEl);
            });
            
            textEl.addEventListener('click', function(e) {
                e.stopPropagation();
                selectTextElement(textEl);
            });
            
            textLayer.appendChild(textEl);
            ensureMask(textEl);
            makeTextEditable(textEl);
        }
        
        // Handle canvas click for adding new text
        function handleCanvasClick(e) {
            if (activeTool === 'text') {
                const rect = a4Preview.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                addNewText(x, y);
            } else if (activeTool === 'highlight' &amp;&amp; selectedTextElement) {
                selectedTextElement.style.backgroundColor = highlightColor;
                saveTextAnnotation(selectedTextElement);
            }
        }
        
        // Add event listener for canvas click
        a4Preview.addEventListener('click', handleCanvasClick);

        // Deselect when clicking outside any text element
        a4Preview.addEventListener('mousedown', (e)=&gt;{
            if(!(e.target &amp;&amp; e.target.classList &amp;&amp; e.target.classList.contains('editable-text'))){
                document.querySelectorAll('.editable-text.selected').forEach(el =&gt; { el.classList.remove('selected','editing'); el.contentEditable='false'; });
                selectedTextElement = null;
            }
        });

        // Drag to move when not editing (hold Ctrl to move to avoid text selection)
        let dragInfo = null;
        textLayer.addEventListener('mousedown', (e)=&gt;{
            const target = e.target;
            if(!(target &amp;&amp; target.classList &amp;&amp; target.classList.contains('editable-text'))) return;
            // Start drag only if not in editing mode and Ctrl pressed
            if(target.isContentEditable || !e.ctrlKey) return;
            e.preventDefault();
            selectTextElement(target);
            const startX = e.clientX, startY = e.clientY;
            const origLeft = parseFloat(target.style.left)||0;
            const origTop = parseFloat(target.style.top)||0;
            dragInfo = { target, startX, startY, origLeft, origTop };
            const onMove = (ev)=&gt;{
                if(!dragInfo) return;
                const dx = ev.clientX - dragInfo.startX;
                const dy = ev.clientY - dragInfo.startY;
                dragInfo.target.style.left = (dragInfo.origLeft + dx) + 'px';
                dragInfo.target.style.top = (dragInfo.origTop + dy) + 'px';
                updateMask(dragInfo.target);
            };
            const onUp = ()=&gt;{
                if(dragInfo){ saveTextAnnotation(dragInfo.target); }
                dragInfo = null; window.removeEventListener('mousemove', onMove); window.removeEventListener('mouseup', onUp);
            };
            window.addEventListener('mousemove', onMove);
            window.addEventListener('mouseup', onUp);
        });

        // Key handling for selected element when not editing
        document.addEventListener('keydown', (e)=&gt;{
            if(!selectedTextElement) return;
            const isEditing = selectedTextElement.isContentEditable &amp;&amp; selectedTextElement.classList.contains('editing');
            if(isEditing) return; // already inline editing

            // Ctrl/Cmd + Delete/Backspace =&gt; remove entire block
            if((e.key === 'Delete' || e.key === 'Backspace') &amp;&amp; (e.ctrlKey || e.metaKey)){
                e.preventDefault();
                const tgt = selectedTextElement; selectedTextElement = null;
                // remove mask if present
                const prev = tgt.previousElementSibling; if(prev &amp;&amp; prev.classList.contains('mask-block')) prev.remove();
                tgt.remove();
                textAnnotations = textAnnotations.filter(ann =&gt; !(ann.x === parseFloat(tgt.style.left) &amp;&amp; ann.y === parseFloat(tgt.style.top)));
                annotationHistory.push([...textAnnotations]);
                redoHistory = [];
                updateUndoRedoButtons();
                return;
            }

            // Character typing -&gt; enter edit mode and insert char
            if(e.key &amp;&amp; e.key.length === 1 &amp;&amp; !e.altKey &amp;&amp; !e.ctrlKey &amp;&amp; !e.metaKey){
                e.preventDefault();
                makeTextEditable(selectedTextElement);
                // insert the typed character at caret
                try{ document.execCommand('insertText', false, e.key); }catch(_){ /* ignore */ }
                updateMask(selectedTextElement);
                return;
            }

            // Backspace/Delete -&gt; enter edit mode and delete one character
            if(e.key === 'Backspace' || e.key === 'Delete'){
                e.preventDefault();
                makeTextEditable(selectedTextElement);
                // simulate deletion
                setTimeout(()=&gt;{
                    try{ document.execCommand(e.key === 'Delete' ? 'forwardDelete' : 'delete'); }catch(_){ /* ignore */ }
                    updateMask(selectedTextElement);
                },0);
                return;
            }
        });

        // Apply formatting to selected element (guard missing left controls)
        if(fontFamilySelect){
            fontFamilySelect.addEventListener('change', ()=&gt;{
                if(selectedTextElement){ selectedTextElement.style.fontFamily = fontFamilySelect.value; saveTextAnnotation(selectedTextElement); }
            });
        }
        if(fontSizeSelect){
            fontSizeSelect.addEventListener('change', ()=&gt;{
                if(selectedTextElement){ selectedTextElement.style.fontSize = fontSizeSelect.value + 'px'; saveTextAnnotation(selectedTextElement); }
            });
        }
        if(colorPicker){
            colorPicker.addEventListener('input', ()=&gt;{
                if(selectedTextElement){ selectedTextElement.style.color = colorPicker.value; saveTextAnnotation(selectedTextElement); }
            });
        }
        
        // Set active tool
        function setActiveTool(tool) {
            activeTool = tool;
            
            // Update UI
            document.querySelectorAll(');
            
            switch(tool) {
                case 'select':
                    selectTool.classList.add('active');
                    a4Preview.style.cursor = 'default';
                    break;
                case 'text':
                    textTool.classList.add('active');
                    a4Preview.style.cursor = 'text';
                    break;
                case 'highlight':
                    highlightTool.classList.add('active');
                    a4Preview.style.cursor = 'pointer';
                    break;
            }
        }
        
        // Add annotation to history
        function addAnnotation(annotation) {
            textAnnotations.push(annotation);
            annotationHistory.push([...textAnnotations]);
            redoHistory = [];
            updateUndoRedoButtons();
        }
        
        // Render text annotations
        function renderTextAnnotations() {
            // This would render the text annotations on the overlay canvas
            // For now, we're using DOM elements for text editing
        }

        // Mask helpers to hide original PDF text below overlays
        function ensureMask(el){
            if(!el || !el.parentNode) return;
            const prev = el.previousElementSibling;
            if(!(prev &amp;&amp; prev.classList &amp;&amp; prev.classList.contains('mask-block'))){
                const m = document.createElement('div');
                m.className = 'mask-block';
                el.parentNode.insertBefore(m, el);
            }
            updateMask(el);
        }
        function updateMask(el){
            if(!el) return;
            const m = el.previousElementSibling;
            if(!(m &amp;&amp; m.classList &amp;&amp; m.classList.contains('mask-block'))) return;
            // padding to fully hide glyph descenders/overshoot
            const padX = 4, padY = 4;
            const left = parseFloat(el.style.left||'0');
            const top = parseFloat(el.style.top||'0');
            const fs = parseFloat(el.style.fontSize)||14;
            // compute width/height using both box size and text length heuristic
            const wBox = el.offsetWidth; const hBox = el.offsetHeight;
            const wHeu = Math.max(1, (el.textContent||'').length) * (fs * 0.62);
            const hHeu = fs * 1.6;
            const w = Math.max(wBox||0, wHeu) + padX*2;
            const h = Math.max(hBox||0, hHeu) + padY*2;
            m.style.left = (left - padX) + 'px';
            m.style.top = (top - padY) + 'px';
            m.style.width = w + 'px';
            m.style.height = h + 'px';
        }
        
        // Undo last action
        function undo() {
            if (annotationHistory.length &gt; 1) {
                redoHistory.push(textAnnotations);
                annotationHistory.pop();
                textAnnotations = [...annotationHistory[annotationHistory.length - 1]];
                updateUndoRedoButtons();
                // In a real implementation, we would re-render the annotations
            }
        }
        
        // Redo last undone action
        function redo() {
            if (redoHistory.length &gt; 0) {
                textAnnotations = redoHistory.pop();
                annotationHistory.push([...textAnnotations]);
                updateUndoRedoButtons();
                // In a real implementation, we would re-render the annotations
            }
        }
        
        // Clear all annotations
        function clearAnnotations() {
            if (confirm('Are you sure you want to clear all annotations?')) {
                textAnnotations = [];
                annotationHistory.push([...textAnnotations]);
                redoHistory = [];
                textLayer.innerHTML = '';
                updateUndoRedoButtons();
            }
        }
        
        // Update undo/redo button states
        function updateUndoRedoButtons() {
            if(undoBtn) undoBtn.disabled = annotationHistory.length &lt;= 1;
            if(redoBtn) redoBtn.disabled = redoHistory.length === 0;
        }
        
        // Save edited PDF (exports the currently visible page with overlays)
        async function savePDF() {
            if (!pdfDoc || !currentFile) return;
            loading.style.display = 'block';
            hideMessages();
            try{
                // Compose a snapshot of current page: base PDF canvas + overlays
                const w = pdfCanvas.width; const h = pdfCanvas.height;
                const out = document.createElement('canvas'); out.width = w; out.height = h;
                const octx = out.getContext('2d');
                // Draw base PDF
                octx.drawImage(pdfCanvas, 0, 0);
                // Draw overlays from DOM (first mask white, then optional highlight, then text)
                const nodes = Array.from(textLayer.querySelectorAll('.editable-text'));
                nodes.forEach(el =&gt; {
                    const left = parseFloat(el.style.left)||0;
                    const top = parseFloat(el.style.top)||0;
                    const fs = parseFloat(el.style.fontSize)||14;
                    const fam = el.style.fontFamily || 'Arial';
                    const col = el.style.color || '#000';
                    const cs = getComputedStyle(el);
                    const fw = cs.fontWeight;
                    const it = cs.fontStyle;
                    const bg = el.style.backgroundColor;
                    const padX=4, padY=4;
                    const textW = Math.max(el.offsetWidth||0, (el.textContent||'').length * fs*0.62);
                    const textH = Math.max(el.offsetHeight||0, fs*1.6);
                    // 1) White mask to remove original PDF text shadow
                    octx.fillStyle = '#FFFFFF';
                    octx.fillRect(left-padX, top-padY, textW+padX*2, textH+padY*2);
                    // 2) Optional highlight background over the mask
                    if(bg &amp;&amp; bg !== 'transparent'){
                        octx.fillStyle = bg;
                        octx.fillRect(left-padX, top-padY, textW+padX*2, textH+padY*2);
                    }
                    // 3) Draw text on top
                    octx.fillStyle = col;
                    octx.textBaseline = 'top';
                    octx.font = `${it==='italic'?'italic ':''}${(fw==='700'||fw==='bold')?'bold ':''}${fs}px ${fam}`;
                    const lines = (el.textContent||'').split('\n');
                    let y = top; const lh = fs * 1.2;
                    lines.forEach(line=&gt;{ octx.fillText(line, left, y); y += lh; });
                });
                // Draw overlay images
                const imgs = Array.from(textLayer.querySelectorAll('.overlay-image'));
                await Promise.all(imgs.map(el=&gt; new Promise((res)=&gt;{ const im = new Image(); im.onload=()=&gt;{ const left=parseFloat(el.style.left)||0; const top=parseFloat(el.style.top)||0; const wv=parseFloat(el.style.width)||im.naturalWidth; const hv=im.naturalHeight*(wv/im.naturalWidth); octx.drawImage(im, left, top, wv, hv); res(); }; im.src = el.src; })));
                // Export to PDF via jsPDF with A4 points matching our 595x842 canvas
                const imgData = out.toDataURL('image/png');
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF({ unit:'pt', format:[595, 842], compress:true });
                doc.addImage(imgData, 'PNG', 0, 0, 595, 842);
                const fname = 'edited-' + (currentFile.name.replace(/\.pdf$/i,'') || 'document') + '.pdf';
                doc.save(fname);
                loading.style.display = 'none';
                successMessage.style.display = 'block';
            }catch(err){
                console.error(err);
                loading.style.display = 'none';
                showError('Save failed.');
            }
        }
        
        // Reset editor
        function resetEditor() {
            pdfDoc = null;
            currentPage = 1;
            textAnnotations = [];
            annotationHistory = [];
            redoHistory = [];
            
            fileInfo.style.display = 'none';
            editorSection.style.display = 'none';
            saveBtn.disabled = true;
            if(saveOcrOnlyBtn) saveOcrOnlyBtn.disabled = true;
            hideMessages();
            
            // Clear canvases and text layer
            ctx.clearRect(0, 0, pdfCanvas.width, pdfCanvas.height);
            if(overlayCtx) overlayCtx.clearRect(0, 0, overlayCanvas.width, overlayCanvas.height);
            textLayer.innerHTML = '';
            
            // Reset file input
            fileInput.value = '';
            
            // Hide context menu
            contextMenu.style.display = 'none';
        }
        
        // Navigation functions
        function prevPage() {
            if (currentPage &lt;= 1) return;
            currentPage--;
            renderPage(currentPage);
        }
        
        function nextPage() {
            if (!pdfDoc || currentPage &gt;= pdfDoc.numPages) return;
            currentPage++;
            renderPage(currentPage);
        }
        
        // Utility functions
        function formatFileSize(bytes) {
            if (bytes &lt; 1024) return bytes + ' bytes';
            else if (bytes &lt; 1048576) return (bytes / 1024).toFixed(1) + ' KB';
            else return (bytes / 1048576).toFixed(1) + ' MB';
        }
        
        function updateProgress(percent, text) {
            progressBar.style.width = percent + '%';
            progressText.textContent = text;
        }
        
        function showError(message) {
            errorText.textContent = message;
            errorMessage.style.display = 'block';
        }
        
        function hideMessages() {
            successMessage.style.display = 'none';
            errorMessage.style.display = 'none';
        }

        // Zoom helpers
        function setUiZoom(z){
            uiZoom = Math.max(0.2, Math.min(z, 3));
            a4Preview.style.transform = `scale(${uiZoom})`;
            if(zoomPct) zoomPct.textContent = Math.round(uiZoom*100) + '%';
        }
        function fitPreviewToWidth(){
            const container = a4Preview.parentElement; if(!container) return;
            const cs = getComputedStyle(container);
            const padX = parseFloat(cs.paddingLeft||'0') + parseFloat(cs.paddingRight||'0');
            const avail = container.clientWidth - padX;
            const baseWidth = 595; // CSS width of a4-preview
            if(baseWidth&gt;0){ setUiZoom(avail / baseWidth); }
        }

        // OCR: create editable text overlays from current canvas
        // Uses high-accuracy server-side OCR processing for better results
        async function runOcrOnCurrentPage(customDataUrl, offsetX=0, offsetY=0){
            try{
                if(!pdfDoc){ showError('Please upload a PDF first'); return; }
                progressContainer.style.display = 'block';
                updateProgress(5, 'Preparing OCR...');
                // Use the visible canvas as image source
                const dataUrl = customDataUrl || pdfCanvas.toDataURL('image/png');
                updateProgress(15, 'Sending to OCR service...');
                const lang = (ocrLang &amp;&amp; ocrLang.value) ? ocrLang.value : 'eng';
                
                // Use backend API for high-accuracy OCR processing
                updateProgress(25, 'Processing with high-accuracy OCR engine...');
                const response = await fetch('/api/pdf-ocr/process', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        image: dataUrl,
                        language: lang
                    })
                });
                
                if(!response.ok){
                    throw new Error('OCR API request failed');
                }
                
                const result = await response.json();
                
                if(!result.success){
                    throw new Error(result.error || 'OCR processing failed');
                }
                
                updateProgress(95, 'Placing editable text...');
                const { lines } = result;
                if(!lines || !lines.length){ updateProgress(100, 'No text found'); setTimeout(()=&gt;{progressContainer.style.display='none';}, 800); return; }
                // Add overlays for each OCR line
                lines.forEach(line =&gt; {
                    if(!line.text || !line.text.trim()) return;
                    const bbox = line.bbox || {};
                    const { x0, y0, x1, y1 } = bbox;
                    if(x0==null||y0==null||x1==null||y1==null) return;
                    const left = offsetX + x0;
                    const top = offsetY + y0;
                    const width = x1 - x0;
                    const height = y1 - y0;
                    const fontPx = Math.max(10, Math.round(height * 0.8));
                    const el = document.createElement('div');
                    el.className = 'editable-text';
                    el.textContent = line.text.trim();
                    el.style.left = left + 'px';
                    el.style.top = top + 'px';
                    el.style.fontSize = fontPx + 'px';
                    el.style.fontFamily = (tbFontFamily &amp;&amp; tbFontFamily.value) ? tbFontFamily.value : (fontFamilySelect &amp;&amp; fontFamilySelect.value ? fontFamilySelect.value : 'Arial');
                    el.style.color = (tbColor &amp;&amp; tbColor.value) ? tbColor.value : (colorPicker &amp;&amp; colorPicker.value ? colorPicker.value : '#000');
                    // interactions
                    el.addEventListener('dblclick', (e)=&gt;{ e.stopPropagation(); makeTextEditable(el); });
                    el.addEventListener('contextmenu', (e)=&gt;{ e.preventDefault(); e.stopPropagation(); showContextMenu(e, el); });
                    el.addEventListener('click', (e)=&gt;{ e.stopPropagation(); selectTextElement(el); });
                    textLayer.appendChild(el);
                    ensureMask(el);
                    saveTextAnnotation(el);
                });
                updateProgress(100, 'OCR completed');
                setTimeout(()=&gt;{progressContainer.style.display='none';}, 800);
            }catch(err){
                console.error(err);
                progressContainer.style.display='none';
                showError('OCR failed. Please try again.');
            }
        }
        
        // OCR Region selection
        let ocrRegionMode = false;
        let selStart = null; let selRect = null;
        function enableOcrRegionMode(){
            ocrRegionMode = true;
            a4Preview.style.cursor = 'crosshair';
        }
        a4Preview.addEventListener('mousedown', (e)=&gt;{
            if(!ocrRegionMode) return;
            const r = a4Preview.getBoundingClientRect();
            selStart = { x: e.clientX - r.left, y: e.clientY - r.top };
            // draw via overlay canvas
            if(overlayCtx) overlayCtx.clearRect(0,0,overlayCanvas.width, overlayCanvas.height);
        });
        a4Preview.addEventListener('mousemove', (e)=&gt;{
            if(!ocrRegionMode || !selStart) return;
            const r = a4Preview.getBoundingClientRect();
            const x = e.clientX - r.left; const y = e.clientY - r.top;
            const x0 = Math.min(selStart.x, x), y0 = Math.min(selStart.y, y);
            const w = Math.abs(x - selStart.x), h = Math.abs(y - selStart.y);
            selRect = { x:x0, y:y0, w, h };
            if(overlayCtx) overlayCtx.clearRect(0,0,overlayCanvas.width, overlayCanvas.height);
            if(overlayCtx){ overlayCtx.strokeStyle = '#3a0ca3'; overlayCtx.lineWidth = 2; overlayCtx.setLineDash([6,4]); overlayCtx.strokeRect(x0, y0, w, h); }
        });
        a4Preview.addEventListener('mouseup', async (e)=&gt;{
            if(!ocrRegionMode) return;
            a4Preview.style.cursor = 'default';
            ocrRegionMode = false;
            if(!selRect || selRect.w&lt;5 || selRect.h&lt;5){ if(overlayCtx) overlayCtx.clearRect(0,0,overlayCanvas.width, overlayCanvas.height); return; }
            try{
                // crop region from pdfCanvas
                const sx = Math.round(selRect.x), sy = Math.round(selRect.y);
                const sw = Math.round(selRect.w), sh = Math.round(selRect.h);
                const tmp = document.createElement('canvas'); tmp.width = sw; tmp.height = sh;
                const tctx = tmp.getContext('2d');
                tctx.drawImage(pdfCanvas, sx, sy, sw, sh, 0, 0, sw, sh);
                const dataUrl = tmp.toDataURL('image/png');
                await runOcrOnCurrentPage(dataUrl, sx, sy);
            }finally{
                if(overlayCtx) overlayCtx.clearRect(0,0,overlayCanvas.width, overlayCanvas.height);
                selStart = null; selRect = null;
            }
        });
        
        // Initialize when page loads
        window.addEventListener('load', init);

<script src="js/auth.js" type="module"></script>

