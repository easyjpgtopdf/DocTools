<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>PDF Editor Online Free - Edit PDF Files Online Without Installation | easyjpgtopdf</title>
    <meta name="description" content="Edit PDF files online for free. Add text, images, annotations, modify PDF documents, highlight content - all without software installation. Best free online PDF editor 2024.">
    <meta name="keywords" content="pdf editor online free, edit pdf online, free pdf editor, online pdf editor, edit pdf files, pdf editing tool, modify pdf, edit pdf documents, pdf editor free online, best pdf editor online, edit pdf online free no download, pdf editor website, free online pdf editor, edit pdf text, pdf editor tool">
    
    <!-- Resource Hints for Performance -->
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    
    <!-- Preload Critical CSS -->
    <link rel="preload" href="css/header.css" as="style">
    <link rel="preload" href="css/footer.css" as="style">
    
    <link rel="stylesheet" href="css/footer.css">
    <link rel="stylesheet" href="css/header.css">
    <link rel="stylesheet" href="css/theme-modern.css">
    <!-- Defer Font Awesome to prevent render blocking -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" media="print" onload="this.media='all'">
    <noscript><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"></noscript>
    
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "PDF Editor Online Free",
      "description": "Edit PDF files online for free. Add text, images, annotations, modify PDF documents, highlight content - all without software installation. Best free online PDF editor 2024.",
      "url": "https://easyjpgtopdf.com/edit-pdf.html",
      "applicationCategory": "ProductivityApplication",
      "operatingSystem": "Any",
      "browserRequirements": "Requires HTML5 support",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "featureList": [
        "Edit PDF text online",
        "Add images to PDF",
        "OCR text recognition",
        "Real-time PDF editing",
        "Full A4 preview",
        "No software installation required"
      ],
      "inLanguage": "en-US",
      "isPartOf": {
        "@type": "WebSite",
        "name": "easyjpgtopdf",
        "url": "https://easyjpgtopdf.com"
      },
      "publisher": {
        "@type": "Organization",
        "name": "easyjpgtopdf",
        "url": "https://easyjpgtopdf.com"
      },
      "author": {
        "@type": "Person",
        "name": "Riyaz Mohammad"
      }
    }
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background-color: #f5f7ff;
            color: #0b1630;
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 24px;
        }
        
        main {
            flex: 1;
            padding: 40px 0;
        }
        
        .page-header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .page-header h1 {
            font-size: 2.5rem;
            color: #0b1630;
            margin-bottom: 15px;
            font-weight: 700;
        }
        
        .page-header p {
            font-size: 1.1rem;
            color: #56607a;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .upload-section {
            background: white;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .upload-area {
            border: 3px dashed #4361ee;
            border-radius: 16px;
            padding: 60px 40px;
            text-align: center;
            cursor: pointer;
            background: linear-gradient(145deg, #f8f9ff, #ffffff);
            transition: all 0.3s ease;
            position: relative;
        }
        
        .upload-area:hover {
            border-color: #3a0ca3;
            box-shadow: 0 8px 24px rgba(67, 97, 238, 0.15);
            transform: translateY(-2px);
        }
        
        .upload-area.dragover {
            border-color: #3a0ca3;
            background: #eef2ff;
        }
        
        .upload-icon {
            font-size: 64px;
            color: #4361ee;
            margin-bottom: 20px;
        }
        
        .upload-area h3 {
            font-size: 1.5rem;
            color: #0b1630;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .upload-area p {
            color: #56607a;
            font-size: 1rem;
            margin-bottom: 5px;
        }
        
        .browse-btn {
            display: inline-block;
            margin-top: 20px;
            padding: 12px 30px;
            background: #4361ee;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .browse-btn:hover {
            background: #3a0ca3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(67, 97, 238, 0.3);
        }
        
        .file-input {
            display: none;
        }
        
        .file-info {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9ff;
            border-radius: 12px;
            display: none;
        }
        
        .file-info.show {
            display: block;
        }
        
        .file-details {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .file-icon {
            font-size: 48px;
            color: #4361ee;
        }
        
        .file-text h4 {
            font-size: 1.2rem;
            color: #0b1630;
            margin-bottom: 5px;
        }
        
        .file-text p {
            color: #56607a;
            font-size: 0.9rem;
        }
        
        .continue-btn-container {
            text-align: center;
            margin-top: 30px;
        }
        
        .continue-btn {
            display: inline-block;
            padding: 15px 40px;
            background: linear-gradient(135deg, #4361ee, #3a0ca3);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(67, 97, 238, 0.3);
        }
        
        .continue-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(67, 97, 238, 0.4);
        }
        
        .continue-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .tools-roadmap {
            background: white;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .tools-roadmap h2 {
            font-size: 2rem;
            color: #0b1630;
            margin-bottom: 30px;
            text-align: center;
            font-weight: 700;
        }
        
        .roadmap-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }
        
        .roadmap-card {
            background: linear-gradient(135deg, #f8f9ff, #ffffff);
            padding: 25px;
            border-radius: 12px;
            border: 2px solid #e2e6ff;
            transition: all 0.3s ease;
        }
        
        .roadmap-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(67, 97, 238, 0.15);
            border-color: #4361ee;
        }
        
        .roadmap-icon {
            font-size: 36px;
            color: #4361ee;
            margin-bottom: 15px;
        }
        
        .roadmap-card h3 {
            font-size: 1.3rem;
            color: #0b1630;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .roadmap-card p {
            color: #56607a;
            font-size: 0.95rem;
            line-height: 1.6;
        }
        
        .user-feedback {
            background: white;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        
        .user-feedback h2 {
            font-size: 2rem;
            color: #0b1630;
            margin-bottom: 25px;
            text-align: center;
            font-weight: 700;
        }
        
        .feedback-form {
            max-width: 600px;
            margin: 0 auto;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #0b1630;
            font-weight: 600;
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e2e6ff;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #4361ee;
        }
        
        textarea.form-control {
            min-height: 120px;
            resize: vertical;
        }
        
        .submit-btn {
            padding: 12px 30px;
            background: #4361ee;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .submit-btn:hover {
            background: #3a0ca3;
            transform: translateY(-2px);
        }
        
        .ssl-badges {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #f8f9ff, #ffffff);
            border-radius: 12px;
            margin: 30px 0;
            border: 2px solid #e2e6ff;
        }
        
        .ssl-badges-grid {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 40px;
            flex-wrap: wrap;
        }
        
        .ssl-badge {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .ssl-badge i {
            font-size: 2rem;
            color: #4361ee;
        }
        
        .ssl-badge-text h4 {
            color: #0b1630;
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 3px;
        }
        
        .ssl-badge-text p {
            color: #56607a;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .page-header h1 {
                font-size: 1.8rem;
            }
            
            .upload-area {
                padding: 40px 20px;
            }
            
            .upload-icon {
                font-size: 48px;
            }
            
            .roadmap-grid {
                grid-template-columns: 1fr;
            }
            
            .ssl-badges-grid {
                flex-direction: column;
                gap: 20px;
            }
        }
    </style>
</head>
<body>
    <script src="js/global-components.js"></script>
    <div id="global-header-placeholder"></div>
    <div id="global-breadcrumb-placeholder"></div>
    
    <main>
        <div class="container">
            <div class="page-header">
                <h1>PDF Editor Online Free - Edit PDF Files Online Without Installation</h1>
                <p>Edit PDF files online for free with our advanced PDF editor tool. Add text, images, annotations, highlight content, modify PDF documents, and more - all without software installation. Best free online PDF editor 2024.</p>
            </div>
            
            <div class="upload-section">
                <div class="upload-area" id="upload-area">
                    <div class="upload-icon">
                        <i class="fas fa-file-pdf"></i>
                    </div>
                    <h3>Upload Your PDF File</h3>
                    <p>Drag & drop your PDF file here</p>
                    <p>or click to browse files</p>
                    <label for="file-input" class="browse-btn">
                        <i class="fas fa-folder-open"></i> Browse Files
                    </label>
                    <input type="file" id="file-input" class="file-input" accept="application/pdf,.pdf">
                </div>
                
                <div class="file-info" id="file-info">
                    <div class="file-details">
                        <div class="file-icon">
                            <i class="fas fa-file-pdf"></i>
                        </div>
                        <div class="file-text">
                            <h4 id="file-name">document.pdf</h4>
                            <p id="file-size">0 KB</p>
                        </div>
                    </div>
                </div>
                
                <div class="continue-btn-container">
                    <button class="continue-btn" id="continue-btn" disabled>
                        <i class="fas fa-arrow-right"></i> Continue to Editor
                    </button>
                </div>
                
                <!-- Loading Overlay -->
                <div id="loading-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 10000; justify-content: center; align-items: center; flex-direction: column; color: white;">
                    <div class="spinner" style="border: 4px solid #f3f3f3; border-top: 4px solid #4361ee; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; margin-bottom: 20px;"></div>
                    <div class="loading-text" style="font-size: 18px; font-weight: 600;">Processing...</div>
                </div>
                <style>
                    @keyframes spin {
                        0% { transform: rotate(0deg); }
                        100% { transform: rotate(360deg); }
                    }
                </style>
            </div>
            
            <div class="tools-roadmap">
                <h2>How Our PDF Editor Works</h2>
                <div class="roadmap-grid">
                    <div class="roadmap-card">
                        <div class="roadmap-icon">
                            <i class="fas fa-upload"></i>
                        </div>
                        <h3>Upload PDF</h3>
                        <p>Simply drag and drop your PDF file or click to browse. Our system supports all standard PDF formats up to 50MB.</p>
                    </div>
                    <div class="roadmap-card">
                        <div class="roadmap-icon">
                            <i class="fas fa-edit"></i>
                        </div>
                        <h3>Edit Every Word</h3>
                        <p>Click on any text in your PDF to edit it directly. Every word is fully editable with real-time preview, just like Adobe Acrobat Pro.</p>
                    </div>
                    <div class="roadmap-card">
                        <div class="roadmap-icon">
                            <i class="fas fa-magic"></i>
                        </div>
                        <h3>Advanced Features</h3>
                        <p>Add images, highlight text, insert annotations, change fonts, adjust colors, and more. All changes are visible in real-time.</p>
                    </div>
                    <div class="roadmap-card">
                        <div class="roadmap-icon">
                            <i class="fas fa-download"></i>
                        </div>
                        <h3>Download & Save</h3>
                        <p>Once you're done editing, download your modified PDF instantly. Your original file remains untouched.</p>
                    </div>
                </div>
            </div>
            
            <div class="tools-roadmap">
                <h2>Key Features & Characteristics</h2>
                <div class="roadmap-grid">
                    <div class="roadmap-card">
                        <div class="roadmap-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <h3>100% Free</h3>
                        <p>No hidden charges, no registration required. Edit PDFs completely free with unlimited usage.</p>
                    </div>
                    <div class="roadmap-card">
                        <div class="roadmap-icon">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <h3>Secure & Private</h3>
                        <p>Your files are processed securely. All files are automatically deleted after processing for your privacy.</p>
                    </div>
                    <div class="roadmap-card">
                        <div class="roadmap-icon">
                            <i class="fas fa-mobile-alt"></i>
                        </div>
                        <h3>Mobile Friendly</h3>
                        <p>Works perfectly on desktop, tablet, and mobile devices. Edit PDFs on the go from any device.</p>
                    </div>
                    <div class="roadmap-card">
                        <div class="roadmap-icon">
                            <i class="fas fa-bolt"></i>
                        </div>
                        <h3>Fast Processing</h3>
                        <p>Powered by Google Cloud infrastructure for lightning-fast editing and OCR processing with 100% accuracy.</p>
                    </div>
                    <div class="roadmap-card">
                        <div class="roadmap-icon">
                            <i class="fas fa-language"></i>
                        </div>
                        <h3>Multi-Language OCR</h3>
                        <p>Extract text from scanned PDFs in multiple languages using advanced Google Cloud Vision API OCR technology.</p>
                    </div>
                    <div class="roadmap-card">
                        <div class="roadmap-icon">
                            <i class="fas fa-paint-brush"></i>
                        </div>
                        <h3>Professional Tools</h3>
                        <p>Full-featured editor with font selection, color picker, text alignment, highlighting, and image insertion capabilities.</p>
                    </div>
                </div>
            </div>
            
            <div class="user-feedback">
                <h2>Share Your Feedback</h2>
                <div class="feedback-form">
                    <div class="form-group">
                        <label for="feedback-name">Your Name</label>
                        <input type="text" id="feedback-name" class="form-control" placeholder="Enter your name">
                    </div>
                    <div class="form-group">
                        <label for="feedback-email">Email Address</label>
                        <input type="email" id="feedback-email" class="form-control" placeholder="Enter your email">
                    </div>
                    <div class="form-group">
                        <label for="feedback-message">Your Feedback</label>
                        <textarea id="feedback-message" class="form-control" placeholder="Share your experience with our PDF editor"></textarea>
                    </div>
                    <button class="submit-btn" onclick="submitFeedback()">
                        <i class="fas fa-paper-plane"></i> Submit Feedback
                    </button>
                </div>
            </div>
            
            <div class="ssl-badges">
                <div class="ssl-badges-grid">
                    <div class="ssl-badge">
                        <i class="fas fa-shield-alt"></i>
                        <div class="ssl-badge-text">
                            <h4>SSL Secured</h4>
                            <p>256-bit Encryption</p>
                        </div>
                    </div>
                    <div class="ssl-badge">
                        <i class="fas fa-lock"></i>
                        <div class="ssl-badge-text">
                            <h4>100% Secure</h4>
                            <p>Files Auto-Deleted</p>
                        </div>
                    </div>
                    <div class="ssl-badge">
                        <i class="fas fa-check-circle"></i>
                        <div class="ssl-badge-text">
                            <h4>Privacy Protected</h4>
                            <p>No Data Storage</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <div id="global-footer-placeholder"></div>
    
    <script src="js/mobile-menu-init.js"></script>
    <script src="js/auth.js" type="module"></script>
    <script>
        // File upload handling
        const uploadArea = document.getElementById('upload-area');
        const fileInput = document.getElementById('file-input');
        const fileInfo = document.getElementById('file-info');
        const fileName = document.getElementById('file-name');
        const fileSize = document.getElementById('file-size');
        const continueBtn = document.getElementById('continue-btn');
        
        // Format file size
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
        }
        
        // Get API base URL
        function getApiBaseUrl() {
            if (window.location.protocol === 'file:') {
                return 'http://localhost:3000';
            }
            return '';
        }
        
        // Show loading state
        function showLoading(message) {
            const loadingOverlay = document.getElementById('loading-overlay');
            if (loadingOverlay) {
                loadingOverlay.style.display = 'flex';
                const loadingText = loadingOverlay.querySelector('.loading-text');
                if (loadingText) loadingText.textContent = message || 'Processing...';
            }
        }
        
        // Hide loading state
        function hideLoading() {
            const loadingOverlay = document.getElementById('loading-overlay');
            if (loadingOverlay) {
                loadingOverlay.style.display = 'none';
            }
        }
        
        // Show error message
        function showError(message) {
            hideLoading();
            alert('Error: ' + message);
        }
        
        // Handle file selection with backend upload
        async function handleFile(file) {
            // Validate file type first (before any processing)
            if (file.type !== 'application/pdf' && !file.name.toLowerCase().endsWith('.pdf')) {
                alert('Please select a valid PDF file');
                return;
            }
            
            // Validate file size
            if (file.size > 100 * 1024 * 1024) {
                alert('File size exceeds 100MB limit. Please select a smaller file.');
                return;
            }
            
            if (file.size > 50 * 1024 * 1024) {
                if(!confirm('This file is larger than 50MB. It may be slow to load. Continue?')){ 
                    return;
                }
            }
            
            try {
                showLoading('Uploading PDF to server...');
                
                // Get loading overlay element for progress updates
                const loadingOverlayEl = document.getElementById('loading-overlay');
                
                // Upload to backend server with progress tracking
                const formData = new FormData();
                formData.append('pdfFile', file);
                
                const apiBaseUrl = getApiBaseUrl();
                const uploadUrl = `${apiBaseUrl}/api/pdf/upload`;
                
                console.log('Uploading to:', uploadUrl);
                
                // Create XMLHttpRequest for upload progress
                const xhr = new XMLHttpRequest();
                
                // Set timeout (60 seconds)
                xhr.timeout = 60000;
                
                xhr.upload.addEventListener('progress', function(e) {
                    if (e.lengthComputable) {
                        const percentComplete = (e.loaded / e.total) * 100;
                        if (loadingOverlayEl) {
                            const loadingText = loadingOverlayEl.querySelector('.loading-text');
                            if (loadingText) {
                                loadingText.textContent = `Uploading... ${Math.round(percentComplete)}%`;
                            }
                        }
                    }
                });
                
                xhr.addEventListener('load', function() {
                    if (xhr.status === 200 || xhr.status === 201) {
                        try {
                            const uploadResult = JSON.parse(xhr.responseText);
                            
                            if (!uploadResult.success) {
                                throw new Error(uploadResult.error || 'Upload failed');
                            }
                            
                            // Store file ID and server URL for preview page
                            const serverUrl = `${apiBaseUrl}/api/pdf/load/${uploadResult.fileId}`;
                            sessionStorage.setItem('pdfFileId', uploadResult.fileId);
                            sessionStorage.setItem('pdfServerUrl', serverUrl);
                            sessionStorage.setItem('pdfFileName', uploadResult.filename);
                            sessionStorage.setItem('pdfFileSize', uploadResult.size.toString());
                            sessionStorage.setItem('pdfFileMetadata', JSON.stringify({
                                fileId: uploadResult.fileId,
                                filename: uploadResult.filename,
                                size: uploadResult.size,
                                createdAt: uploadResult.createdAt,
                                serverUrl: serverUrl
                            }));
                            
                            // Store file data locally as fallback
                            const reader = new FileReader();
                            reader.onload = function(e) {
                                const fileData = e.target.result;
                                const blob = new Blob([fileData], { type: 'application/pdf' });
                                const blobURL = URL.createObjectURL(blob);
                                sessionStorage.setItem('pdfFileURL', blobURL);
                                
                                // Update UI
                                fileName.textContent = uploadResult.filename;
                                fileSize.textContent = formatFileSize(uploadResult.size);
                                fileInfo.classList.add('show');
                                continueBtn.disabled = false;
                                
                                console.log('PDF uploaded successfully. File ID:', uploadResult.fileId);
                                console.log('Server URL:', serverUrl);
                                hideLoading();
                            };
                            
                            reader.onerror = function() {
                                console.warn('FileReader error, but server upload succeeded');
                                // Still update UI even if FileReader fails
                                fileName.textContent = uploadResult.filename;
                                fileSize.textContent = formatFileSize(uploadResult.size);
                                fileInfo.classList.add('show');
                                continueBtn.disabled = false;
                                hideLoading();
                            };
                            
                            reader.readAsArrayBuffer(file);
                        } catch (parseError) {
                            console.error('Parse error:', parseError);
                            throw new Error('Invalid server response: ' + parseError.message);
                        }
                    } else {
                        let errorMsg = `Upload failed: ${xhr.status}`;
                        try {
                            const errorResponse = JSON.parse(xhr.responseText);
                            if (errorResponse.error) {
                                errorMsg = errorResponse.error;
                            } else if (errorResponse.message) {
                                errorMsg = errorResponse.message;
                            }
                        } catch (e) {
                            errorMsg = `Upload failed: ${xhr.status} ${xhr.statusText}`;
                        }
                        throw new Error(errorMsg);
                    }
                });
                
                xhr.addEventListener('error', function() {
                    console.error('XHR error event fired');
                    hideLoading();
                    const error = new Error('Network error during upload. Please check if the server is running at http://localhost:3000');
                    handleUploadError(error);
                });
                
                xhr.addEventListener('timeout', function() {
                    console.error('XHR timeout event fired');
                    hideLoading();
                    const error = new Error('Upload timeout. The file may be too large or the server is slow.');
                    handleUploadError(error);
                });
                
                xhr.addEventListener('abort', function() {
                    hideLoading();
                    alert('Upload cancelled');
                });
                
                // Open connection
                xhr.open('POST', uploadUrl);
                
                // Don't set Content-Type header for FormData - browser will set it automatically with boundary
                // xhr.setRequestHeader('Content-Type', 'multipart/form-data'); // DON'T set this!
                
                // Send form data
                xhr.send(formData);
                
            } catch (error) {
                console.error('Upload error:', error);
                
                // Check if it's a 404 or server not available
                if (error.message.includes('404') || error.message.includes('Network error')) {
                    console.warn('Server upload failed, using local storage fallback');
                    showError('Server upload failed. Using local storage. Some features may be limited.');
                } else {
                    showError('Failed to upload PDF: ' + error.message);
                }
                
                // Fallback: Store locally without server upload
                const reader = new FileReader();
                reader.onload = function(e) {
                    const fileData = e.target.result;
                    const blob = new Blob([fileData], { type: 'application/pdf' });
                    const blobURL = URL.createObjectURL(blob);
                    sessionStorage.setItem('pdfFileURL', blobURL);
                    sessionStorage.setItem('pdfFileName', file.name);
                    sessionStorage.setItem('pdfFileSize', file.size.toString());
                    sessionStorage.setItem('pdfFileType', file.type);
                    
                    fileName.textContent = file.name;
                    fileSize.textContent = formatFileSize(file.size);
                    fileInfo.classList.add('show');
                    continueBtn.disabled = false;
                    hideLoading();
                };
                reader.readAsArrayBuffer(file);
            }
        }
        
        function storeFileAndRedirect(db, fileData, file) {
            const transaction = db.transaction(['pdfFiles'], 'readwrite');
            const store = transaction.objectStore('pdfFiles');
            
            // Create Blob URL as fallback for sessionStorage
            const blob = new Blob([fileData], { type: 'application/pdf' });
            const blobURL = URL.createObjectURL(blob);
            sessionStorage.setItem('pdfFileURL', blobURL);
            sessionStorage.setItem('pdfFileName', file.name);
            sessionStorage.setItem('pdfFileSize', file.size.toString());
            sessionStorage.setItem('pdfFileType', file.type);
            
            store.clear().onsuccess = function() {
                const request = store.add({
                    data: fileData,
                    name: file.name,
                    size: file.size,
                    type: file.type,
                    timestamp: Date.now()
                });
                
                request.onsuccess = function() {
                    sessionStorage.setItem('pdfFileId', request.result.toString());
                    // File is now stored, ready for preview page
                    console.log('PDF file stored successfully in IndexedDB');
                };
                
                request.onerror = function() {
                    console.warn('IndexedDB storage failed, but Blob URL is available in sessionStorage');
                };
            };
        }
        
        // Event listeners
        fileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                handleFile(file);
            }
        });
        
        uploadArea.addEventListener('click', function() {
            fileInput.click();
        });
        
        uploadArea.addEventListener('dragover', function(e) {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });
        
        uploadArea.addEventListener('dragleave', function(e) {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
        });
        
        uploadArea.addEventListener('drop', function(e) {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            
            const file = e.dataTransfer.files[0];
            if (file) {
                handleFile(file);
            }
        });
        
        continueBtn.addEventListener('click', function() {
            if (!continueBtn.disabled) {
                window.location.href = 'pdf-editor-preview.html';
            }
        });
        
        // Feedback submission
        function submitFeedback() {
            const name = document.getElementById('feedback-name').value;
            const email = document.getElementById('feedback-email').value;
            const message = document.getElementById('feedback-message').value;
            
            if (!name || !email || !message) {
                alert('Please fill in all fields');
                return;
            }
            
            // Here you would send feedback to your backend
            // For now, just show a thank you message
            alert('Thank you for your feedback! We appreciate your input.');
            document.getElementById('feedback-name').value = '';
            document.getElementById('feedback-email').value = '';
            document.getElementById('feedback-message').value = '';
        }
    </script>
</body>
</html>

