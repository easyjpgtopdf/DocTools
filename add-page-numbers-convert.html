<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Add Page Numbers to PDF - easyjpgtopdf</title>
<link href="css/footer.css" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"></link>
<style>
    *{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif}
    :root{--primary:#4361ee;--secondary:#3a0ca3;--accent:#4cc9f0;--light:#f8f9fa;--dark:#212529;--gray:#6c757d}
    body{background:#f5f7ff;color:var(--dark);min-height:100vh;display:flex;flex-direction:column;line-height:1.6}
    .container{max-width:1200px;margin:0 auto;padding:0 20px}
    /* Header from index.html */
    header{background:#fff;position:sticky;top:0;z-index:100;box-shadow:0 2px 10px rgba(0,0,0,.08)}
    .navbar{display:flex;justify-content:space-between;align-items:center;padding:14px 0}
    .logo{display:flex;gap:10px;align-items:center;font-size:22px;font-weight:700;color:var(--primary);text-decoration:none}
    .logo i{color:var(--secondary)}
    .nav-links{display:flex;gap:22px}
    .nav-links a{text-decoration:none;color:var(--dark);font-weight:500}
    .nav-links a:hover,.nav-links a.active{color:var(--primary)}
    .dropdown{position:relative}
    .dropdown-content{display:none;position:absolute;background:#fff;min-width:200px;box-shadow:0 8px 16px rgba(0,0,0,.1);border-radius:8px;padding:10px 0;top:100%;left:0}
    .dropdown:hover .dropdown-content{display:block}
    .dropdown-content a{display:block;padding:10px 20px;text-decoration:none;color:var(--dark)}
    .dropdown-content a:hover{background:var(--light)}
    .auth-buttons{display:flex;gap:10px}
    .auth-btn{padding:6px 15px;border-radius:50px;text-decoration:none;font-weight:500;transition:.3s;font-size:.9rem}
    .auth-btn.login{background:transparent;color:var(--primary);border:1px solid var(--primary)}
    .auth-btn.signup{background:var(--primary);color:#fff;border:1px solid var(--primary)}

    .tool-page{background:#fff;border-radius:12px;padding:24px;box-shadow:0 5px 15px rgba(0,0,0,.05);margin:24px 0}
    .title{font-size:1.4rem;color:var(--primary);margin-bottom:10px}
    .meta{color:var(--gray);font-size:.95rem;margin-bottom:14px}
    .actions{display:flex;flex-wrap:wrap;gap:10px;margin-bottom:12px}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 18px;border-radius:8px;border:1px solid var(--primary);background:#fff;color:var(--primary);text-decoration:none;font-weight:600;cursor:pointer;transition:.2s}
    .btn:hover{transform:translateY(-2px);box-shadow:0 5px 15px rgba(0,0,0,.1)}
    .btn-primary{background:var(--primary);color:#fff;border:none}
    .preview{border:1px solid #ddd;border-radius:10px;overflow:hidden;background:#fff;height:70vh}
    .preview iframe{width:100%;height:100%;border:0}
    /* Share bar styles are now in share-bar.css */

    /* Comment section styled like index */
    .comments{padding:40px 0;background:#fff;border-radius:20px;margin:20px 0}
    .comment-form{max-width:600px;margin:0 auto;background:var(--light);padding:30px;border-radius:12px}
    .form-group{margin-bottom:20px}
    .form-group label{display:block;margin-bottom:8px;font-weight:500}
    .form-control{width:100%;padding:12px 15px;border:1px solid #ddd;border-radius:8px}

    /* Footer from index.html */
    footer{background:#212529;color:#fff;margin-top:auto;padding:60px 0 30px}
    .footer-content{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:40px;margin-bottom:40px}
    .footer-links{list-style:none}
    .footer-links a{color:#aaa;text-decoration:none}
    .footer-links a:hover{color:#fff}
    .copyright{text-align:center;color:#aaa;border-top:1px solid #444;padding-top:16px;font-size:.9rem}

    @media (max-width:768px){.nav-links{display:none}.split-layout{flex-direction:column}.left-panel,.right-panel{width:100%!important}.btn{width:100%;justify-content:center}}
    
    /* Split Layout - 50-50 */
    .split-layout{display:flex;gap:20px;margin:20px 0;min-height:calc(100vh + 384px - 300px)}
    .left-panel{flex:1;background:#fff;border-radius:12px;padding:24px;box-shadow:0 2px 10px rgba(0,0,0,.08);overflow-y:auto;max-height:calc(100vh + 384px - 280px)}
    .right-panel{flex:1;background:#fff;border-radius:12px;padding:24px;box-shadow:0 2px 10px rgba(0,0,0,.08);overflow-y:auto;max-height:calc(100vh + 384px - 280px)}
    
    /* Page Numbering Options */
    .numbering-options{background:var(--light);border-radius:12px;padding:15px;margin-bottom:15px}
    .option-group{margin-bottom:12px}
    .option-group h3{font-size:1rem;color:var(--primary);margin-bottom:8px}
    .option-group label{display:block;margin-bottom:6px;font-weight:500;color:var(--dark);font-size:.9rem}
    .option-select,.form-control{width:100%;padding:8px 12px;border:1px solid #ddd;border-radius:8px;background:#fff;font-size:.9rem}
    .radio-group{display:flex;flex-wrap:wrap;gap:6px;margin-top:6px}
    .radio-option{display:inline-flex;align-items:center;gap:4px;padding:5px 10px;background:#fff;border:1px solid #ddd;border-radius:6px;cursor:pointer;transition:.2s;font-size:.85rem}
    .radio-option:hover{border-color:var(--primary);background:rgba(67,97,238,0.05)}
    .radio-option input[type="radio"]{margin:0}
    .color-picker{display:flex;align-items:center;gap:10px;margin-top:8px}
    .color-preview{width:40px;height:40px;border:2px solid #ddd;border-radius:6px;cursor:pointer}
    
    /* Preview Panel */
    .preview-panel-header{margin-bottom:16px;padding-bottom:12px;border-bottom:2px solid var(--light)}
    .preview-panel-header h3{color:var(--primary);font-size:1.2rem}
    .preview-container{display:flex;flex-direction:column;gap:16px;padding:10px}
    .pdf-page-preview{width:8.5cm;height:11cm;border:2px solid #ddd;border-radius:8px;background:#fff;box-shadow:0 2px 8px rgba(0,0,0,.1);position:relative;margin:0 auto}
    .pdf-page-preview canvas{width:100%;height:100%;border-radius:6px}
    .page-number-overlay{position:absolute;font-size:14px;padding:5px 10px;background:rgba(255,255,255,0.9);border:1px solid #ddd;border-radius:4px}
    .page-number-overlay.top-left{top:10px;left:10px}
    .page-number-overlay.top-center{top:10px;left:50%;transform:translateX(-50%)}
    .page-number-overlay.top-right{top:10px;right:10px}
    .page-number-overlay.bottom-left{bottom:10px;left:10px}
    .page-number-overlay.bottom-center{bottom:10px;left:50%;transform:translateX(-50%)}
    .page-number-overlay.bottom-right{bottom:10px;right:10px}
    .page-label{text-align:center;margin-top:8px;color:var(--gray);font-size:.85rem}
    
    /* Progress */
    .progress-container{margin:20px 0;display:none}
    .progress-bar{width:100%;height:8px;background:#e9ecef;border-radius:4px;overflow:hidden}
    .progress-fill{height:100%;background:linear-gradient(90deg,var(--primary),var(--accent));width:0%;transition:width .3s}
    .progress-text{text-align:center;margin-top:10px;color:var(--gray);font-size:.9rem}
  </style>
<link href="css/header.css" rel="stylesheet"/>
<link href="css/theme-modern.css" rel="stylesheet"/>
<!-- PDF.js for rendering PDF pages to canvas -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script>
      // Configure pdf.js worker
      if(typeof pdfjsLib !== 'undefined'){
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
      }
    </script>
</head>
<body>
<header>
        <div class="container">
            <nav class="navbar">
                <a href="index.html" class="logo"><img src="images/logo.png" alt="Logo" style="height:54px;"></a>
                <div class="nav-links">
                    <div class="dropdown">
                        <a href="#">Convert to PDF <i class="fas fa-chevron-down"></i></a>
                        <div class="dropdown-content">
                            <a href="jpg-to-pdf.html">JPG to PDF</a>
                            <a href="word-to-pdf.html">Word to PDF</a>
                            <a href="excel-to-pdf.html">Excel to PDF</a>
                            <a href="ppt-to-pdf.html">PowerPoint to PDF</a>
                        </div>
                    </div>
                    <div class="dropdown">
                        <a href="#">Convert from PDF <i class="fas fa-chevron-down"></i></a>
                        <div class="dropdown-content">
                            <a href="pdf-to-jpg.html">PDF to JPG</a>
                            <a href="pdf-to-word.html">PDF to Word</a>
                            <a href="pdf-to-excel.html">PDF to Excel</a>
                            <a href="pdf-to-ppt.html">PDF to PowerPoint</a>
                        </div>
                    </div>
                    <div class="dropdown">
                        <a href="#">Pdf Editor <i class="fas fa-chevron-down"></i></a>
                        <div class="dropdown-content">
                            <a href="merge-pdf.html">Merge PDF</a>
                            <a href="split-pdf.html">Split PDF</a>
                            <a href="compress-pdf.html">Compress PDF</a>
                            <a href="edit-pdf.html">Pdf Editor</a>
                            <a href="protect-pdf.html">Protect PDF</a>
                            <a href="unlock-pdf.html">Unlock PDF</a>
                            <a href="watermark-pdf.html">Watermark PDF</a>
                            <a href="crop-pdf.html">Crop PDF</a>
                            <a href="add-page-numbers.html">Add Page Numbers</a>
                        </div>
                    </div>
                    <div class="dropdown">
                        <a href="#">Image Tools <i class="fas fa-chevron-down"></i></a>
                        <div class="dropdown-content">
                            <a href="image-repair.html">AI Image Repair</a>
                            <a href="image-compressor.html">Image Compressor</a>
                            <a href="image-resizer.html">Image Resizer</a>
                            <a href="image-editor.html">Image Editor</a>
                            <a href="background-remover.html">Image Background Remover</a>
                            <a href="ocr-image.html">OCR Image</a>
                            <a href="image-watermark.html">Image Watermark Tool</a>
                        </div>
                    </div>
                    <div class="dropdown">
                        <a href="#">Other Tools <i class="fas fa-chevron-down"></i></a>
                        <div class="dropdown-content">
                            <a href="resume-maker.html">Resume Maker</a>
                            <a href="biodata-maker.html">Marrige Biodata-Data Maker</a>
                            <a href="ai-image-generator.html">AI Image Generator</a>
                            <a href="marriage-card.html">Marriage Card</a>
                            <a href="excel-unlocker/" target="_blank">Excel Unlocker</a>
                            <a href="protect-excel.html">Protect Excel Sheet</a>
                        </div>
                    </div>
                    <div class="dropdown">
                        <a href="#">More <i class="fas fa-chevron-down"></i></a>
                        <div class="dropdown-content">
                            <a href="pricing.html">Pricing</a>
                            <a href="blog.html">Blog/Articles</a>
                            
                            
                        </div>
                    </div>
                </div>
                
                <div id="user-menu" class="user-menu" data-open="false">
                    <button id="user-menu-toggle" class="user-menu-toggle" type="button" aria-haspopup="true" aria-expanded="false" aria-label="Account menu">
                        <span class="user-initial" aria-hidden="true">U</span>
                        <i class="fas fa-chevron-down" aria-hidden="true"></i>
                    </button>
                    <div class="user-dropdown" id="user-dropdown" hidden>
                        <a href="dashboard.html#dashboard-overview" data-user-nav="dashboard-overview"><i class="fas fa-user-circle"></i> Account Dashboard</a>
                        <a href="dashboard.html#dashboard-billing" data-user-nav="dashboard-billing"><i class="fas fa-file-invoice"></i> Billing Details</a>
                        <a href="dashboard.html#dashboard-payments" data-user-nav="dashboard-payments"><i class="fas fa-wallet"></i> Payment History</a>
                        <a href="dashboard.html#dashboard-orders" data-user-nav="dashboard-orders"><i class="fas fa-clipboard-list"></i> Orders &amp; Subscriptions</a>
                        <a href="accounts.html#login"><i class="fas fa-user-cog"></i> Account Center</a>
                        <button type="button" id="logout-button" class="dropdown-logout"><i class="fas fa-sign-out-alt"></i> Sign out</button>
                    </div>
                </div>
            </nav>
        </div>
    </header>
    <nav aria-label="Breadcrumb" style="padding: 15px 0; background: #f8f9ff; border-bottom: 1px solid #e2e6ff;">
        <div class="container" style="max-width: 1200px; margin: 0 auto; padding: 0 24px;">
            <ol style="list-style: none; display: flex; flex-wrap: wrap; gap: 10px; margin: 0; padding: 0; align-items: center;">
                <li><a href="index.html" style="color: #4361ee; text-decoration: none; font-weight: 500; transition: color 0.3s;" onmouseover="this.style.color='#3a0ca3'" onmouseout="this.style.color='#4361ee'">Home</a></li>
                <li><span style="margin: 0 8px; color: #9ca3af;">|</span></li>
                <li><a href="login.html" style="color: #56607a; font-weight: 500; text-decoration: none; transition: color 0.3s;" onmouseover="this.style.color='#4361ee'" onmouseout="this.style.color='#56607a'">Sign In</a></li>
                <li><span style="margin: 0 8px; color: #9ca3af;">|</span></li>
                <li><a href="signup.html" style="color: #56607a; font-weight: 500; text-decoration: none; transition: color 0.3s;" onmouseover="this.style.color='#4361ee'" onmouseout="this.style.color='#56607a'">Signup</a></li>
            </ol>
        </div>
    </nav>
<div class="container">
<div class="tool-page">
<div class="title">Add Page Numbers to Your PDF</div>
<div class="meta" id="meta">Customize and preview your page numbering options below</div>
<!-- Split Layout: Left Panel = Options, Right Panel = Preview -->
<div class="split-layout">
<!-- LEFT PANEL: Numbering Options -->
<div class="left-panel">
<div class="numbering-options">
<h3 style="margin-bottom:12px;color:var(--primary);font-size:1.1rem">Page Numbering Options</h3>
<div class="option-group">
<label>Position</label>
<div class="radio-group">
<label class="radio-option"><input name="position" type="radio" value="top-left"/> Top Left</label>
<label class="radio-option"><input name="position" type="radio" value="top-center"/> Top Center</label>
<label class="radio-option"><input name="position" type="radio" value="top-right"/> Top Right</label>
<label class="radio-option"><input name="position" type="radio" value="bottom-left"/> Bottom Left</label>
<label class="radio-option"><input name="position" type="radio" value="bottom-center"/> Bottom Center</label>
<label class="radio-option"><input checked="" name="position" type="radio" value="bottom-right"/> Bottom Right</label>
</div>
</div>
<div class="option-group">
<label>Number Format</label>
<div class="radio-group">
<label class="radio-option"><input checked="" name="format" type="radio" value="1"/> 1, 2, 3...</label>
<label class="radio-option"><input name="format" type="radio" value="i"/> i, ii, iii...</label>
<label class="radio-option"><input name="format" type="radio" value="I"/> I, II, III...</label>
<label class="radio-option"><input name="format" type="radio" value="a"/> a, b, c...</label>
<label class="radio-option"><input name="format" type="radio" value="A"/> A, B, C...</label>
</div>
</div>
<div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:10px;margin-top:8px">
<div class="option-group">
<label for="startNumber">Starting Number</label>
<input class="form-control" id="startNumber" min="1" type="number" value="1"/>
</div>
<div class="option-group">
<label for="fontSize">Font Size</label>
<select class="option-select" id="fontSize">
<option value="8">8pt</option>
<option value="10">10pt</option>
<option selected="" value="12">12pt</option>
<option value="14">14pt</option>
<option value="16">16pt</option>
<option value="18">18pt</option>
</select>
</div>
<div class="option-group">
<label for="fontColor">Font Color</label>
<div class="color-picker">
<div class="color-preview" id="colorPreview" style="background-color:#000000"></div>
<input id="fontColor" style="width:60px;height:40px;border:none;cursor:pointer" type="color" value="#000000"/>
</div>
</div>
</div>
<div class="option-group">
<label for="pageText">Page Text Template (use {n} for number, {total} for total pages)</label>
<input class="form-control" id="pageText" placeholder="e.g., Page {n} of {total}" type="text"/>
</div>
</div>
<!-- Progress Section -->
<div class="progress-container" id="progressContainer">
<div class="progress-bar">
<div class="progress-fill" id="progressFill"></div>
</div>
<div class="progress-text" id="progressText">Processing...</div>
</div>
<!-- Actions -->
<div class="actions">
<a class="btn" href="add-page-numbers.html"><i class="fas fa-arrow-left"></i> Back</a>
<button class="btn btn-primary" id="applyBtn"><i class="fas fa-plus-circle"></i> Apply Page Numbers</button>
<button class="btn btn-primary" id="downloadBtn" style="display:none"><i class="fas fa-download"></i> Download PDF</button>
</div>
<!-- Share Bar (hidden initially) -->
<div class="share-bar" id="shareBar" style="display:none">
<span>Share:</span>
<button class="share-btn native" id="nativeShare" title="Share">
<i class="fas fa-share-alt"></i>
</button>
<a class="share-btn facebook" id="shareFacebook" rel="noopener" target="_blank" title="Share on Facebook">
<i class="fab fa-facebook-f"></i>
</a>
<a class="share-btn twitter" id="shareTwitter" rel="noopener" target="_blank" title="Share on Twitter">
<i class="fab fa-twitter"></i>
</a>
<a class="share-btn whatsapp" id="shareWhatsApp" rel="noopener" target="_blank" title="Share on WhatsApp">
<i class="fab fa-whatsapp"></i>
</a>
<a class="share-btn email" id="shareEmail" rel="noopener" target="_blank" title="Share via Email">
<i class="fas fa-envelope"></i>
</a>
</div>
</div>
<!-- RIGHT PANEL: PDF Preview with Multiple Pages -->
<div class="right-panel">
<div style="padding:20px;background:var(--bg-light);border-bottom:1px solid var(--border-color);margin-bottom:10px">
<h3 style="margin:0;color:var(--primary)">PDF Preview</h3>
<p style="margin:5px 0 0 0;color:var(--gray);font-size:14px">All pages will be displayed below</p>
</div>
<div class="preview-container" id="previewContainer">
<!-- PDF pages will be rendered here as canvas elements -->
<p style="text-align:center;color:var(--gray);padding:40px 20px">
<i class="fas fa-file-pdf" style="font-size:48px;margin-bottom:16px;display:block;opacity:0.3"></i>
              PDF preview will appear here after you apply page numbers
            </p>
</div>
</div>
</div>
</div>
</div>
<!-- Add share bar styles and scripts -->
<link href="css/share-bar.css" rel="stylesheet"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
<script src="js/share-utils.js"></script>
<script>
    const { PDFDocument, rgb, StandardFonts } = PDFLib;
    let originalPdfData=null, processedPdfBlob=null, fileName='document.pdf';
    
    async function init(){
      try{
        const pdfFile = sessionStorage.getItem('pdfFile');
        fileName = sessionStorage.getItem('pdfFileName') || 'document.pdf';
        if(!pdfFile){ 
          document.getElementById('meta').textContent='No PDF found. Please upload again.';
          document.getElementById('applyBtn').disabled=true;
          return; 
        }
        // Convert base64 to array buffer
        const base64Response = await fetch(pdfFile);
        originalPdfData = await base64Response.arrayBuffer();
        
        // Load and preview original PDF
        const pdfDoc = await PDFDocument.load(originalPdfData);
        const pageCount = pdfDoc.getPageCount();
        document.getElementById('meta').textContent = `${fileName} Â• ${pageCount} page(s)`;
        
        // Show message in preview panel
        const previewContainer = document.getElementById('previewContainer');
        previewContainer.innerHTML = `
          <p style="text-align:center;color:var(--gray);padding:40px 20px">
            <i class="fas fa-file-pdf" style="font-size:48px;margin-bottom:16px;display:block;opacity:0.5"></i>
            <strong>${fileName}</strong><br>
            ${pageCount} page(s) loaded<br><br>
            <small>Click "Apply Page Numbers" to see preview with page numbers</small>
          </p>
        `;
      }catch(e){
        console.error(e);
        alert('Error loading PDF: '+e.message);
      }
    }
    
    // Update color preview when color changes
    function updatePreview(){
      const fontColor = document.getElementById('fontColor').value;
      document.getElementById('colorPreview').style.backgroundColor = fontColor;
    }
    
    // Apply page numbers using pdf-lib
    async function applyPageNumbers(){
      if(!originalPdfData) return alert('No PDF loaded');
      
      const progressContainer = document.getElementById('progressContainer');
      const progressFill = document.getElementById('progressFill');
      const progressText = document.getElementById('progressText');
      const applyBtn = document.getElementById('applyBtn');
      const downloadBtn = document.getElementById('downloadBtn');
      const shareBar = document.getElementById('shareBar');
      
      progressContainer.style.display = 'block';
      applyBtn.disabled = true;
      
      try{
        progressText.textContent = 'Loading PDF...';
        progressFill.style.width = '20%';
        
        const pdfDoc = await PDFDocument.load(originalPdfData);
        const pages = pdfDoc.getPages();
        const totalPages = pages.length;
        
        const position = document.querySelector('input[name="position"]:checked').value;
        const format = document.querySelector('input[name="format"]:checked').value;
        const startNum = parseInt(document.getElementById('startNumber').value) || 1;
        const fontSize = parseInt(document.getElementById('fontSize').value);
        const fontColorHex = document.getElementById('fontColor').value;
        const pageText = document.getElementById('pageText').value || '{n}';
        
        const r = parseInt(fontColorHex.substr(1,2),16)/255;
        const g = parseInt(fontColorHex.substr(3,2),16)/255;
        const b = parseInt(fontColorHex.substr(5,2),16)/255;
        
        const font = await pdfDoc.embedFont(StandardFonts.Helvetica);
        
        progressText.textContent = 'Adding page numbers...';
        progressFill.style.width = '40%';
        
        for(let i=0; i<totalPages; i++){
          const page = pages[i];
          const {width,height} = page.getSize();
          
          let num = startNum+i;
          if(format==='i') num = toRoman(num).toLowerCase();
          else if(format==='I') num = toRoman(num);
          else if(format==='a') num = toAlpha(num-1).toLowerCase();
          else if(format==='A') num = toAlpha(num-1);
          
          let text = pageText.replace('{n}',num).replace('{total}',totalPages);
          if(!text.trim()) text = num.toString();
          
          const textWidth = font.widthOfTextAtSize(text,fontSize);
          const margin = 30;
          let x,y;
          
          if(position==='top-left'){ x=margin; y=height-margin; }
          else if(position==='top-center'){ x=(width-textWidth)/2; y=height-margin; }
          else if(position==='top-right'){ x=width-textWidth-margin; y=height-margin; }
          else if(position==='bottom-left'){ x=margin; y=margin; }
          else if(position==='bottom-center'){ x=(width-textWidth)/2; y=margin; }
          else{ x=width-textWidth-margin; y=margin; }
          
          page.drawText(text,{x,y,size:fontSize,font,color:rgb(r,g,b)});
          
          const progress = 40 + ((i+1)/totalPages*50);
          progressFill.style.width = progress+'%';
        }
        
        progressText.textContent = 'Saving PDF...';
        progressFill.style.width = '95%';
        
        const pdfBytes = await pdfDoc.save();
        processedPdfBlob = new Blob([pdfBytes],{type:'application/pdf'});
        
        progressFill.style.width = '100%';
        progressText.textContent = 'Complete!';
        
        // Render multi-page preview
        await renderPdfPreview(processedPdfBlob);
        
        // Show download and share buttons
        downloadBtn.style.display = 'inline-flex';
        shareBar.style.display = 'flex';
        applyBtn.style.display = 'none';
        
        setTimeout(()=>{
          progressContainer.style.display = 'none';
          progressFill.style.width = '0%';
        },2000);
        
        // Initialize share buttons
        initShareButtons(
          'Add Page Numbers to PDF',
          'Check out this PDF page numbering tool',
          window.location.href.split('?')[0]
        );
        
      }catch(e){
        console.error(e);
        alert('Error processing PDF: '+e.message);
        progressContainer.style.display = 'none';
        applyBtn.disabled = false;
      }
    }
    
    // Render PDF preview with multiple pages at fixed dimensions
    async function renderPdfPreview(pdfBlob){
      const previewContainer = document.getElementById('previewContainer');
      previewContainer.innerHTML = ''; // Clear existing content
      
      try{
        const arrayBuffer = await pdfBlob.arrayBuffer();
        const pdf = await PDFDocument.load(arrayBuffer);
        const pages = pdf.getPages();
        const totalPages = pages.length;
        
        // Use pdf.js for rendering (if available) or create placeholders
        if(typeof pdfjsLib !== 'undefined'){
          const loadingTask = pdfjsLib.getDocument(arrayBuffer);
          const pdfDoc = await loadingTask.promise;
          
          for(let pageNum = 1; pageNum <= totalPages; pageNum++){
            const page = await pdfDoc.getPage(pageNum);
            
            // Create preview wrapper
            const pageWrapper = document.createElement('div');
            pageWrapper.className = 'pdf-page-preview';
            
            // Create canvas for this page
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            
            // Set viewport to match 8.5cm x 11cm (A4 ratio at 96 DPI = ~322px x 417px)
            const viewport = page.getViewport({scale: 1.0});
            const desiredWidth = 322; // 8.5cm at 96 DPI
            const scale = desiredWidth / viewport.width;
            const scaledViewport = page.getViewport({scale: scale});
            
            canvas.width = scaledViewport.width;
            canvas.height = scaledViewport.height;
            
            // Render PDF page into canvas
            await page.render({
              canvasContext: context,
              viewport: scaledViewport
            }).promise;
            
            pageWrapper.appendChild(canvas);
            
            // Add page number overlay to show how it will look
            const position = document.querySelector('input[name="position"]:checked').value;
            const format = document.querySelector('input[name="format"]:checked').value;
            const startNum = parseInt(document.getElementById('startNumber').value) || 1;
            const fontSize = parseInt(document.getElementById('fontSize').value);
            const fontColor = document.getElementById('fontColor').value;
            const pageText = document.getElementById('pageText').value || '{n}/{total}';
            
            let num = startNum + pageNum - 1;
            if(format==='i') num = toRoman(num).toLowerCase();
            else if(format==='I') num = toRoman(num);
            else if(format==='a') num = toAlpha(num-1).toLowerCase();
            else if(format==='A') num = toAlpha(num-1);
            
            // Handle {total} formatting
            let totalFormatted = totalPages;
            if(format==='i') totalFormatted = toRoman(totalPages).toLowerCase();
            else if(format==='I') totalFormatted = toRoman(totalPages);
            else if(format==='a') totalFormatted = toAlpha(totalPages-1).toLowerCase();
            else if(format==='A') totalFormatted = toAlpha(totalPages-1);
            
            let text = pageText.replace('{n}',num).replace('{total}',totalFormatted);
            if(!text.trim()) text = `${num}/${totalFormatted}`;
            
            const overlay = document.createElement('div');
            overlay.className = 'page-number-overlay ' + position;
            overlay.style.fontSize = fontSize + 'px';
            overlay.style.color = fontColor;
            overlay.textContent = text;
            pageWrapper.appendChild(overlay);
            
            // Add page label
            const label = document.createElement('div');
            label.style.cssText = 'text-align:center;padding:8px;font-size:12px;color:var(--gray)';
            label.textContent = `Page ${pageNum} of ${totalPages}`;
            pageWrapper.appendChild(label);
            
            previewContainer.appendChild(pageWrapper);
          }
        }else{
          // Fallback: show simple message if pdf.js not loaded
          for(let i=1; i<=totalPages; i++){
            const pageWrapper = document.createElement('div');
            pageWrapper.className = 'pdf-page-preview';
            pageWrapper.style.cssText += 'display:flex;align-items:center;justify-content:center;background:#f5f5f5';
            pageWrapper.innerHTML = `<p style="color:var(--gray)">Page ${i} of ${totalPages}<br><small>Preview ready</small></p>`;
            previewContainer.appendChild(pageWrapper);
          }
        }
        
      }catch(e){
        console.error('Preview render error:',e);
        previewContainer.innerHTML = '<p style="text-align:center;color:red;padding:20px">Error rendering preview</p>';
      }
    }
    
    function downloadPdf(){
      if(!processedPdfBlob) return alert('Please apply page numbers first');
      const outputName = fileName.replace(/\.pdf$/i,'')+'_numbered.pdf';
      saveAs(processedPdfBlob, outputName);
    }
    
    function toRoman(num){
      const lookup={M:1000,CM:900,D:500,CD:400,C:100,XC:90,L:50,XL:40,X:10,IX:9,V:5,IV:4,I:1};
      let str='';
      for(let i of Object.keys(lookup)){
        const q = Math.floor(num/lookup[i]);
        num -= q*lookup[i];
        str += i.repeat(q);
      }
      return str;
    }
    
    function toAlpha(num){
      let s='';
      while(num>=0){
        s = String.fromCharCode(65+(num%26)) + s;
        num = Math.floor(num/26)-1;
      }
      return s||'A';
    }
    
    // Event listeners
    document.addEventListener('DOMContentLoaded',()=>{
      init();
      document.getElementById('applyBtn').addEventListener('click',applyPageNumbers);
      document.getElementById('downloadBtn').addEventListener('click',downloadPdf);
      document.getElementById('fontColor').addEventListener('input',updatePreview);
      updatePreview();
    });
  </script>
    
<script src="js/auth.js" type="module"></script>

    <footer>
        <div class="container footer-inner">
            <div class="footer-company-links">
                <span>Company</span>
                <a href="index.html#about">About Us</a>
                <a href="index.html#contact">Contact</a>
                <a href="pricing.html">Pricing</a>
                <a href="privacy-policy.html">Privacy Policy</a>
                <a href="terms-of-service.html">Terms of Service</a>
                <a href="dmca-en.html">DMCA</a>
                <a href="blog.html">Blog</a>
            </div>
            <p class="footer-brand-line">&copy; easyjpgtopdf &mdash; Free PDF &amp; Image Tools for everyone. All rights reserved.</p>
            <p class="footer-credits">
                Thanks to Font Awesome, Google Fonts, jsPDF, pdf.js, pdf-lib, Mammoth, Tesseract.js, IMG.LY, Firebase, Unsplash photographers, and every open-source contributor powering this site.
                <a href="attributions.html">See full acknowledgements</a>.
            </p>
        </div>
    </footer>
</body>
</html>
