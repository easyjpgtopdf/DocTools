<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Advanced PDF Editor Online - Edit PDF Files with Real-Time Preview | easyjpgtopdf</title>
    <meta name="description" content="Advanced PDF editor online with real-time editing, full A4 preview, text editing, image insertion, OCR, and professional editing tools. Edit PDF files online free without installation.">
    <meta name="keywords" content="advanced pdf editor online, pdf editor online free, edit pdf online, free pdf editor, online pdf editor, edit pdf files online, pdf editor tool, edit pdf documents, pdf editor software, edit pdf text, pdf editor free online, best pdf editor online, edit pdf online free no download, pdf editor website, edit pdf online tool, free online pdf editor, real-time pdf editor">
    <meta name="author" content="Riyaz Mohammad">
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
    <link rel="canonical" href="https://easyjpgtopdf.com/edit-pdf-preview.html">
    <meta property="og:title" content="Advanced PDF Editor Online - Edit PDF Files with Real-Time Preview">
    <meta property="og:description" content="Advanced PDF editor online with real-time editing, full A4 preview, text editing, image insertion, OCR, and professional editing tools.">
    <meta property="og:url" content="https://easyjpgtopdf.com/edit-pdf-preview.html">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://easyjpgtopdf.com/images/pdf-editor-preview-og.jpg">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Advanced PDF Editor Online - Edit PDF Files with Real-Time Preview">
    <meta name="twitter:description" content="Advanced PDF editor online with real-time editing, full A4 preview, text editing, image insertion, OCR, and professional editing tools.">
<link href="css/footer.css" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&amp;family=Roboto:wght@400;700&amp;family=Open+Sans:wght@400;700&amp;family=Lato:wght@400;700&amp;family=Poppins:wght@400;700&amp;family=Montserrat:wght@400;700&amp;family=Source+Sans+3:wght@400;700&amp;family=Noto+Sans:wght@400;700&amp;family=Merriweather:wght@400;700&amp;family=PT+Sans:wght@400;700&amp;family=PT+Serif:wght@400;700&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&amp;family=Raleway:wght@400;700&amp;family=Ubuntu:wght@400;700&amp;family=Work+Sans:wght@400;700&amp;family=Karla:wght@400;700&amp;family=Heebo:wght@400;700&amp;family=Rubik:wght@400;700&amp;family=Titillium+Web:wght@400;700&amp;display=swap" rel="stylesheet"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<!-- PDF.js libraries -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js"></script>

<style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        :root { --primary: #4361ee; --primary-dark: #3a0ca3; --secondary: #f72585; --success: #4cc9f0; --light: #f8f9fa; --dark: #212529; --gray: #6c757d; --border-radius: 12px; --box-shadow: 0 5px 15px rgba(0,0,0,0.08); --transition: all 0.3s ease; }
        body { background: linear-gradient(135deg, #f5f7ff 0%, #e9ecef 100%); color: var(--dark); min-height: 100vh; line-height: 1.6; display:flex; flex-direction:column; }
        .container { width: 100%; max-width: 1400px; margin: 0 auto; padding: 0 20px; }
        header { background: #fff; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 10px rgba(0,0,0,.08); }
        .navbar { display: flex; justify-content: space-between; align-items: center; padding: 14px 0; }
        .logo { display: flex; gap: 10px; align-items: center; font-size: 22px; font-weight: 700; color: var(--primary); text-decoration: none; }
        .logo i { color: var(--primary-dark); }
        .nav-links { display: flex; gap: 22px; }
        .nav-links a { text-decoration: none; color: var(--dark); font-weight: 500; }
        .nav-links a.active, .nav-links a:hover { color: var(--primary); }
        .dropdown { position: relative; }
        .dropdown-content { display: none; position: absolute; background: #fff; min-width: 200px; box-shadow: 0 8px 16px rgba(0,0,0,.1); border-radius: 8px; padding: 10px 0; top: 100%; left: 0; }
        .dropdown:hover .dropdown-content { display: block; }
        .dropdown-content a { display: block; padding: 10px 20px; text-decoration: none; color: var(--dark); }
        .dropdown-content a:hover { background: var(--light); }
        .auth-buttons { display:flex; gap:10px; }
        .auth-btn { padding:6px 15px; border-radius:50px; text-decoration:none; font-weight:500; transition:.3s; font-size:.9rem; }
        .auth-btn.login { background: transparent; color: var(--primary); border:1px solid var(--primary); }
        .auth-btn.signup { background: var(--primary); color:#fff; border:1px solid var(--primary); }
        .page-wrap { padding: 20px 0; }
        .editor-header { text-align: center; margin-bottom: 30px; padding: 20px; }
        .editor-header h1 { font-size: 2.2rem; color: var(--primary); margin-bottom: 10px; }
        .editor-header p { font-size: 1.05rem; color: var(--gray); max-width: 700px; margin: 0 auto; }
        .editor-card { background: #fff; border-radius: var(--border-radius); padding: 30px; box-shadow: var(--box-shadow); margin-bottom: 30px; }
        .upload-area { border: 4px dashed #ddd; border-radius: var(--border-radius); padding: 80px 40px; text-align: center; cursor: pointer; margin-bottom: 30px; transition: var(--transition); position: relative; min-height: 400px; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .upload-area:hover { border-color: var(--primary); background: rgba(67, 97, 238, 0.05); }
        .upload-area.dragover { border-color: var(--primary); background: rgba(67, 97, 238, 0.12); }
        .upload-icon { font-size: 120px; color: var(--primary); margin-bottom: 30px; }
        .upload-area h3 { font-size: 2.2rem; margin-bottom: 15px; color: var(--dark); font-weight: 700; }
        .upload-area p { color: var(--gray); margin-bottom: 8px; font-size: 1.1rem; }
        .file-input { display: none; }
        #browse-btn { font-size: 1.4rem; padding: 20px 50px; min-height: 70px; min-width: 280px; font-weight: 700; border-radius: 50px; margin-top: 30px; display: inline-flex; align-items: center; justify-content: center; gap: 15px; box-shadow: 0 8px 20px rgba(67, 97, 238, 0.25); }
        #browse-btn:hover { transform: translateY(-3px); box-shadow: 0 12px 30px rgba(67, 97, 238, 0.35); }
        #browse-btn i { font-size: 1.6rem; }
        .file-info { background: var(--light); border-radius: var(--border-radius); padding: 20px; margin: 20px 0; display: none; }
        .file-details { display: flex; align-items: center; gap: 15px; }
        .file-icon { font-size: 40px; color: var(--primary); }
        .file-text h4 { font-size: 1.2rem; margin-bottom: 5px; }
        .file-text p { color: var(--gray); font-size: 0.9rem; }

        .color-picker { width: 40px; height: 40px; border: none; border-radius: 8px; cursor: pointer; }
        
        .font-select, .font-size-select { padding: 8px 12px; border: 1px solid #ddd; border-radius: 8px; background: white; }
        
        .highlight-color { display: flex; gap: 10px; flex-wrap: wrap; }
        .highlight-btn { width: 30px; height: 30px; border: 2px solid transparent; border-radius: 4px; cursor: pointer; }
        .highlight-btn.active { border-color: var(--dark); }
        .preview-container { flex: 1; display: flex; flex-direction: column; }
        .ribbon { display:flex; flex-direction:column; gap:8px; background:#fff; border:1px solid #e5e7eb; border-radius:10px; padding:10px; margin-bottom:10px; }
        .ribbon-row { display:flex; gap:12px; align-items:center; flex-wrap:wrap }
        .ribbon-group { display:flex; gap:8px; align-items:center; padding:6px 8px; border-right:1px solid #eee }
        .ribbon-group:last-child { border-right:none }
        .group-title { font-size:.75rem; color:#6c757d; margin-right:6px; text-transform:uppercase }
        .ribbon select, .ribbon input[type="color"] { padding:6px 8px; border:1px solid #ddd; border-radius:8px; background:#fff }
        .ribbon .btn { padding:8px 12px }
        .zoom-label { color:#6c757d; min-width:54px; text-align:center; }
        .preview-area { border: 1px solid #ddd; border-radius: var(--border-radius); padding: 20px; background: white; flex: 1; display: flex; justify-content: center; align-items: flex-start; overflow: auto; box-shadow: 0 2px 8px rgba(0,0,0,0.1); position: relative; }
        .a4-preview { width: 595px; min-height: 842px; background: white; box-shadow: 0 4px 12px rgba(0,0,0,0.15); position: relative; margin: 0 auto; transform-origin: top left; }
        #pdf-canvas { display: block; width: 100%; height: 100%; }
        #overlay-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        /* Container to hold editable text elements */
        #text-layer { position: absolute; inset: 0; pointer-events: auto; }
        /* Overlay image items */
        .overlay-image { position:absolute; max-width:595px; cursor:move; user-select:none; border:1px dashed transparent; z-index:61; }
        .overlay-image.selected { border-color:#4361ee; }
        .editable-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; cursor: text; }
        .page-navigation { display: flex; justify-content: center; align-items: center; gap: 15px; margin-top: 20px; }
        .page-btn { display: flex; align-items: center; justify-content: center; width: 40px; height: 40px; border: none; border-radius: 8px; background: var(--primary); color: white; cursor: pointer; transition: var(--transition); }
        .page-btn:hover { background: var(--primary-dark); }
        .page-btn:disabled { background: #ccc; cursor: not-allowed; }
        .page-info { font-weight: 500; }
        .action-buttons { display: flex; gap: 15px; margin-top: 25px; flex-wrap: wrap; }
        .btn { display: inline-flex; align-items: center; justify-content: center; gap: 8px; padding: 12px 24px; border: none; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: var(--transition); text-decoration: none; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-dark); transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .btn-secondary { background: white; color: var(--primary); border: 2px solid var(--primary); }
        .btn-secondary:hover { background: var(--light); }
        .btn:disabled { background: #ccc; cursor: not-allowed; transform: none; box-shadow: none; }
        .progress-container { margin: 20px 0; display: none; }
        .progress-bar { width: 100%; height: 10px; background: #e9ecef; border-radius: 5px; overflow: hidden; }
        .progress { height: 100%; background: linear-gradient(90deg, var(--primary), var(--success)); width: 0%; transition: width 0.4s ease; }
        .progress-text { text-align: center; margin-top: 10px; color: var(--gray); font-size: 0.9rem; }
        .loading { display: none; text-align: center; padding: 30px; }
        .loading-spinner { border: 4px solid #f3f3f3; border-top: 4px solid var(--primary); border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; margin: 0 auto 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .message { padding: 15px; border-radius: 8px; margin: 20px 0; display: none; }
        .success-message { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error-message { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .features { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 40px; }
        .feature-card { background: #fff; border-radius: var(--border-radius); padding: 25px; text-align: center; box-shadow: var(--box-shadow); transition: var(--transition); }
        .feature-card:hover { transform: translateY(-5px); }
        .feature-icon { font-size: 40px; color: var(--primary); margin-bottom: 15px; }
        .feature-card h3 { margin-bottom: 10px; color: var(--dark); }
        .feature-card p { color: var(--gray); }
        footer { background: #212529; color: #fff; margin-top: auto; padding: 60px 0 30px; }
        .footer-content { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 40px; margin-bottom: 40px; }
        .footer-links { list-style: none; }
        .footer-links a { color: #aaa; text-decoration: none; }
        .footer-links a:hover { color: #fff; }
        .copyright { text-align: center; color: #aaa; border-top: 1px solid #444; padding-top: 16px; font-size: .9rem; }
        
        /* Text editor */
        .text-editor { position: absolute; z-index: 100; background: white; border: 1px solid #ddd; border-radius: 4px; padding: 5px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); display: none; }
        .text-editor input { border: none; outline: none; font-size: 14px; width: 200px; }
        
        /* Editable text elements */
        .editable-text { position: absolute; cursor: text; padding: 2px 5px; border: 1px dashed transparent; user-select: text; white-space: pre-wrap; z-index: 60; }
        .editable-text:hover { border-color: var(--primary); background: rgba(67, 97, 238, 0.05); }
        .editable-text.selected { border-color: var(--primary); background: rgba(67, 97, 238, 0.1); }
        .editable-text.editing { border: 2px solid var(--primary); background: #fff; z-index: 100; outline: none; }
        .mask-block { position:absolute; background:#fff; pointer-events:none; z-index: 50; }
        
        /* Context menu */
        .context-menu { position: absolute; background: white; border: 1px solid #ddd; border-radius: 4px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); z-index: 1000; display: none; }
        .context-menu-item { padding: 8px 15px; cursor: pointer; border-bottom: 1px solid #eee; }
        .context-menu-item:last-child { border-bottom: none; }
        .context-menu-item:hover { background: #f5f5f5; }
        
        @media (max-width: 1024px) {
            .a4-preview { width: 100%; max-width: 595px; }
        }
        @media (max-width: 768px) { 
            .nav-links { display: none; } 
            .action-buttons { flex-direction: column; } 
            .btn { width: 100%; justify-content: center; } 

        }
    
        /* 3-Panel Layout: Left (3 inch), Middle (preview), Right (2 inch) */
        .editor-main-container {
            display: flex;
            gap: 15px;
            width: 100%;
            max-width: 100%;
            margin: 0;
            padding: 0;
        }
        
        .left-toolbar-panel {
            width: 228px; /* 3 inches at 96 DPI */
            min-width: 228px;
            max-width: 228px;
            background: #fff;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--box-shadow);
            overflow-y: auto;
            max-height: calc(100vh - 200px);
        }
        
        .middle-preview-panel {
            flex: 1;
            min-width: 0;
            display: flex;
            flex-direction: column;
            background: #fff;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--box-shadow);
        }
        
        .right-tools-panel {
            width: 152px; /* 2 inches at 96 DPI */
            min-width: 152px;
            max-width: 152px;
            background: #fff;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--box-shadow);
            overflow-y: auto;
            max-height: calc(100vh - 200px);
        }
        
        .toolbar-section {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .toolbar-section:last-child {
            border-bottom: none;
        }
        
        .toolbar-section-title {
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--primary);
            text-transform: uppercase;
            margin-bottom: 12px;
            letter-spacing: 0.5px;
        }
        
        .toolbar-btn {
            width: 100%;
            padding: 10px 12px;
            margin-bottom: 8px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            background: #fff;
            color: var(--dark);
            font-size: 0.9rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .toolbar-btn:hover {
            background: var(--primary);
            color: #fff;
            border-color: var(--primary);
        }
        
        .toolbar-btn.active {
            background: var(--primary);
            color: #fff;
            border-color: var(--primary);
        }
        
        .toolbar-btn i {
            font-size: 1rem;
        }
        
        .toolbar-select, .toolbar-input {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            background: #fff;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }
        
        .color-picker-wrapper {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .color-picker-wrapper input[type="color"] {
            width: 50px;
            height: 40px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
        }
        
        .highlight-colors {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 10px;
        }
        
        .highlight-color-btn {
            width: 100%;
            height: 35px;
            border: 2px solid transparent;
            border-radius: 6px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .highlight-color-btn.active {
            border-color: var(--dark);
            transform: scale(1.1);
        }
        
        /* Hide old ribbon, use new panels */
        .ribbon {
            display: none;
        }
        
        @media (max-width: 1200px) {
            .editor-main-container {
                flex-direction: column;
            }
            .left-toolbar-panel, .right-tools-panel {
                width: 100%;
                max-width: 100%;
                min-width: 100%;
            }
        }

    </style>
<link href="css/header.css" rel="stylesheet"/>
<link href="css/theme-modern.css" rel="stylesheet"/>
        <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "Advanced PDF Editor Online",
      "description": "Advanced PDF editor online with real-time editing, full A4 preview, text editing, image insertion, OCR, and professional editing tools. Edit PDF files online free without installation.",
      "url": "https://easyjpgtopdf.com/edit-pdf-preview.html",
      "applicationCategory": "UtilityApplication",
      "operatingSystem": "Any",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "featureList": [
        "Edit PDF text online",
        "Add images to PDF",
        "OCR text recognition",
        "Real-time PDF editing",
        "Full A4 preview",
        "No software installation required"
      ],
      "inLanguage": "en-US",
      "isPartOf": {
        "@type": "WebSite",
        "name": "easyjpgtopdf",
        "url": "https://easyjpgtopdf.com"
      },
      "publisher": {
        "@type": "Organization",
        "name": "easyjpgtopdf",
        "url": "https://easyjpgtopdf.com"
      },
      "author": {
        "@type": "Person",
        "name": "Riyaz Mohammad"
      }
    }
    </script>
</head>
<body>
<header>
        <div class="container">
            <nav class="navbar">
                <a href="index.html" class="logo"><img src="images/logo.png" alt="Logo" style="height:54px;"></a>
                <div class="nav-links">
                    <div class="dropdown">
                        <a href="#">Convert to PDF <i class="fas fa-chevron-down"></i></a>
                        <div class="dropdown-content">
                            <a href="jpg-to-pdf.html">JPG to PDF</a>
                            <a href="word-to-pdf.html">Word to PDF</a>
                            <a href="excel-to-pdf.html">Excel to PDF</a>
                            <a href="ppt-to-pdf.html">PowerPoint to PDF</a>
                        </div>
                    </div>
                    <div class="dropdown">
                        <a href="#">Convert from PDF <i class="fas fa-chevron-down"></i></a>
                        <div class="dropdown-content">
                            <a href="pdf-to-jpg.html">PDF to JPG</a>
                            <a href="pdf-to-word.html">PDF to Word</a>
                            <a href="pdf-to-excel.html">PDF to Excel</a>
                            <a href="pdf-to-ppt.html">PDF to PowerPoint</a>
                        </div>
                    </div>
                    <div class="dropdown">
                        <a href="#">Pdf Editor <i class="fas fa-chevron-down"></i></a>
                        <div class="dropdown-content">
                            <a href="merge-pdf.html">Merge PDF</a>
                            <a href="split-pdf.html">Split PDF</a>
                            <a href="compress-pdf.html">Compress PDF</a>
                            <a href="edit-pdf.html">Pdf Editor</a>
                            <a href="protect-pdf.html">Protect PDF</a>
                            <a href="unlock-pdf.html">Unlock PDF</a>
                            <a href="watermark-pdf.html">Watermark PDF</a>
                            <a href="crop-pdf.html">Crop PDF</a>
                            <a href="add-page-numbers.html">Add Page Numbers</a>
                        </div>
                    </div>
                    <div class="dropdown">
                        <a href="#">Image Tools <i class="fas fa-chevron-down"></i></a>
                        <div class="dropdown-content">
                            <a href="image-repair.html">AI Image Repair</a>
                            <a href="image-compressor.html">Image Compressor</a>
                            <a href="image-resizer.html">Image Resizer</a>
                            <a href="image-editor.html">Image Editor</a>
                            <a href="background-remover.html">Image Background Remover</a>
                            <a href="ocr-image.html">OCR Image</a>
                            <a href="image-watermark.html">Image Watermark Tool</a>
                        </div>
                    </div>
                    <div class="dropdown">
                        <a href="#">Other Tools <i class="fas fa-chevron-down"></i></a>
                        <div class="dropdown-content">
                            <a href="resume-maker.html">Resume Maker</a>
                            <a href="biodata-maker.html">Marrige Biodata-Data Maker</a>
                            <a href="ai-image-generator.html">AI Image Generator</a>
                            <a href="marriage-card.html">Marriage Card</a>
                            <a href="excel-unlocker/" target="_blank">Excel Unlocker</a>
                            <a href="protect-excel.html">Protect Excel Sheet</a>
                        </div>
                    </div>
                    <div class="dropdown">
                        <a href="#">More <i class="fas fa-chevron-down"></i></a>
                        <div class="dropdown-content">
                            <a href="pricing.html">Pricing</a>
                            <a href="blog.html">Blog/Articles</a>

                        </div>
                    </div>
                </div>
                
                <div id="user-menu" class="user-menu" data-open="false">
                    <button id="user-menu-toggle" class="user-menu-toggle" type="button" aria-haspopup="true" aria-expanded="false" aria-label="Account menu">
                        <span class="user-initial" aria-hidden="true">U</span>
                        <i class="fas fa-chevron-down" aria-hidden="true"></i>
                    </button>
                    <div class="user-dropdown" id="user-dropdown" hidden>
                        <a href="dashboard.html#dashboard-overview" data-user-nav="dashboard-overview"><i class="fas fa-user-circle"></i> Account Dashboard</a>
                        <a href="dashboard.html#dashboard-billing" data-user-nav="dashboard-billing"><i class="fas fa-file-invoice"></i> Billing Details</a>
                        <a href="dashboard.html#dashboard-payments" data-user-nav="dashboard-payments"><i class="fas fa-wallet"></i> Payment History</a>
                        <a href="dashboard.html#dashboard-orders" data-user-nav="dashboard-orders"><i class="fas fa-clipboard-list"></i> Orders &amp; Subscriptions</a>
                        <a href="accounts.html#login"><i class="fas fa-user-cog"></i> Account Center</a>
                        <button type="button" id="logout-button" class="dropdown-logout"><i class="fas fa-sign-out-alt"></i> Sign out</button>
                    </div>
                </div>
            </nav>
        </div>
    </header>

        <nav aria-label="Breadcrumb" style="padding: 15px 0; background: #f8f9ff; border-bottom: 1px solid #e2e6ff;">
        <div class="container" style="max-width: 1200px; margin: 0 auto; padding: 0 24px;">
            <ol style="list-style: none; display: flex; flex-wrap: wrap; gap: 10px; margin: 0; padding: 0; align-items: center;">
                <li><a href="index.html" style="color: #4361ee; text-decoration: none; font-weight: 500; transition: color 0.3s;" onmouseover="this.style.color='#3a0ca3'" onmouseout="this.style.color='#4361ee'">Home</a></li>
                <li><span style="margin: 0 8px; color: #9ca3af;">|</span></li>
                <li><a href="login.html" style="color: #56607a; font-weight: 500; text-decoration: none; transition: color 0.3s;" onmouseover="this.style.color='#4361ee'" onmouseout="this.style.color='#56607a'">Sign In</a></li>
                <li><span style="margin: 0 8px; color: #9ca3af;">|</span></li>
                <li><a href="signup.html" style="color: #56607a; font-weight: 500; text-decoration: none; transition: color 0.3s;" onmouseover="this.style.color='#4361ee'" onmouseout="this.style.color='#56607a'">Signup</a></li>
            </ol>
        </div>
    </nav>

<div class="container page-wrap">
<div class="editor-header">
<h1>Advanced PDF Editor Online - Edit PDF Files with Real-Time Preview</h1>
<p>Edit PDF files online for free with our advanced PDF editor tool. Real-time editing, full A4 preview, text editing, image insertion, OCR support, and professional editing tools - all without software installation. Best free online PDF editor 2024.</p>
</div>
<div class="editor-card">
<div class="file-info" id="file-info" style="display: block;">
<div class="file-details">
<div class="file-icon"><i class="fas fa-file-pdf"></i></div>
<div class="file-text">
<h4 id="file-name">Loading PDF...</h4>
<p id="file-size">Please wait</p>
</div>
</div>
</div>
<h2 style="text-align: center; font-size: 1.8rem; color: var(--primary); margin: 30px 0 20px; font-weight: 700;">Real-Time PDF Editing Features</h2>

<div class="editor-main-container">
<!-- Left Toolbar Panel (3 inch) -->
<div class="left-toolbar-panel">
<div class="toolbar-section">
<div class="toolbar-section-title"><i class="fas fa-mouse-pointer"></i> Tools</div>
<button class="toolbar-btn active" id="select-tool" title="Select Text">
<i class="fas fa-mouse-pointer"></i>
<span>Select</span>
</button>
<button class="toolbar-btn" id="text-tool" title="Add Text">
<i class="fas fa-font"></i>
<span>Add Text</span>
</button>
<button class="toolbar-btn" id="highlight-tool" title="Highlight">
<i class="fas fa-highlighter"></i>
<span>Highlight</span>
</button>
<button class="toolbar-btn" id="ocr-region-btn" title="OCR Region">
<i class="fas fa-vector-square"></i>
<span>OCR Region</span>
</button>
</div>

<div class="toolbar-section">
<div class="toolbar-section-title"><i class="fas fa-palette"></i> Font</div>
<select class="toolbar-select" id="tb-font-family">
<option>Inter</option>
<option>Roboto</option>
<option>Open Sans</option>
<option>Lato</option>
<option>Poppins</option>
<option>Montserrat</option>
<option>Source Sans 3</option>
<option>Noto Sans</option>
<option>PT Sans</option>
<option>PT Serif</option>
<option>Merriweather</option>
<option>Georgia</option>
<option>Verdana</option>
<option>Courier New</option>
<option>Times New Roman</option>
<option selected>Arial</option>
</select>
<select class="toolbar-select" id="tb-font-size">
<option>10</option>
<option>12</option>
<option selected>14</option>
<option>16</option>
<option>18</option>
<option>24</option>
<option>32</option>
</select>
</div>

<div class="toolbar-section">
<div class="toolbar-section-title"><i class="fas fa-paint-brush"></i> Color</div>
<div class="color-picker-wrapper">
<input type="color" id="tb-color" value="#111827" title="Text Color"/>
<select class="toolbar-select" id="tb-color-preset" style="flex: 1;">
<option value="#111827">Black</option>
<option value="#ff0000">Red</option>
<option value="#0057ff">Blue</option>
<option value="#00a650">Green</option>
<option value="#ff8c00">Orange</option>
<option value="#800080">Purple</option>
<option value="#808080">Gray</option>
<option value="#ffff00">Yellow</option>
</select>
</div>
</div>

<div class="toolbar-section">
<div class="toolbar-section-title"><i class="fas fa-text-height"></i> Style</div>
<button class="toolbar-btn" id="tb-bold" title="Bold">
<i class="fas fa-bold"></i>
<span>Bold</span>
</button>
<button class="toolbar-btn" id="tb-italic" title="Italic">
<i class="fas fa-italic"></i>
<span>Italic</span>
</button>
<button class="toolbar-btn" id="tb-underline" title="Underline">
<i class="fas fa-underline"></i>
<span>Underline</span>
</button>
</div>

<div class="toolbar-section">
<div class="toolbar-section-title"><i class="fas fa-align-left"></i> Align</div>
<button class="toolbar-btn" id="tb-align-left" title="Align Left">
<i class="fas fa-align-left"></i>
<span>Left</span>
</button>
<button class="toolbar-btn" id="tb-align-center" title="Align Center">
<i class="fas fa-align-center"></i>
<span>Center</span>
</button>
<button class="toolbar-btn" id="tb-align-right" title="Align Right">
<i class="fas fa-align-right"></i>
<span>Right</span>
</button>
</div>

<div class="toolbar-section">
<div class="toolbar-section-title"><i class="fas fa-magic"></i> Highlight Colors</div>
<div class="highlight-colors">
<div class="highlight-color-btn active" data-color="#FFFF00" style="background-color: #FFFF00;" title="Yellow"></div>
<div class="highlight-color-btn" data-color="#00FF00" style="background-color: #00FF00;" title="Green"></div>
<div class="highlight-color-btn" data-color="#00FFFF" style="background-color: #00FFFF;" title="Cyan"></div>
<div class="highlight-color-btn" data-color="#FF00FF" style="background-color: #FF00FF;" title="Magenta"></div>
<div class="highlight-color-btn" data-color="#FFA500" style="background-color: #FFA500;" title="Orange"></div>
<div class="highlight-color-btn" data-color="#FFC0CB" style="background-color: #FFC0CB;" title="Pink"></div>
</div>
</div>

<div class="toolbar-section">
<div class="toolbar-section-title"><i class="fas fa-language"></i> OCR Language</div>
<select class="toolbar-select" id="ocr-lang">
<option selected value="eng">English</option>
<option value="hin">Hindi</option>
<option value="ben">Bengali</option>
<option value="guj">Gujarati</option>
<option value="mar">Marathi</option>
<option value="pan">Punjabi</option>
<option value="tam">Tamil</option>
<option value="tel">Telugu</option>
<option value="kan">Kannada</option>
<option value="mal">Malayalam</option>
<option value="urd">Urdu</option>
<option value="eng+hin">English + Hindi</option>
</select>
<label style="display: flex; align-items: center; gap: 8px; color: var(--dark); margin-top: 8px; font-size: 0.85rem;">
<input id="ocr-auto" type="checkbox" style="width: 18px; height: 18px; cursor: pointer;"/>
<span>Auto OCR each page</span>
</label>
</div>
</div>

<!-- Middle Preview Panel -->
<div class="middle-preview-panel">
<div class="preview-container">
<div class="preview-area">
<div class="a4-preview" id="a4-preview">
<canvas id="pdf-canvas"></canvas>
<canvas id="overlay-canvas"></canvas>
<div id="text-layer"></div>
</div>
</div>
<div class="page-navigation">
<button class="page-btn" id="prev-page"><i class="fas fa-chevron-left"></i></button>
<span class="page-info">Page <span id="page-num">1</span> of <span id="page-count">1</span></span>
<button class="page-btn" id="next-page"><i class="fas fa-chevron-right"></i></button>
</div>
</div>

<!-- Right Tools Panel (2 inch) -->
<div class="right-tools-panel">
<div class="toolbar-section">
<div class="toolbar-section-title"><i class="fas fa-undo"></i> Edit</div>
<button class="toolbar-btn" id="tb-undo" title="Undo">
<i class="fas fa-undo"></i>
<span>Undo</span>
</button>
<button class="toolbar-btn" id="tb-redo" title="Redo">
<i class="fas fa-redo"></i>
<span>Redo</span>
</button>
<button class="toolbar-btn" id="tb-clear" title="Clear All">
<i class="fas fa-trash"></i>
<span>Clear</span>
</button>
</div>

<div class="toolbar-section">
<div class="toolbar-section-title"><i class="fas fa-image"></i> Insert</div>
<button class="toolbar-btn" id="tb-insert-image" title="Insert Image">
<i class="fas fa-image"></i>
<span>Image</span>
</button>
<input accept="image/*" id="img-file-input" style="display:none" type="file"/>
<label class="toolbar-section-title" for="tb-image-scale" style="margin-top: 10px; display: block; font-size: 0.8rem;">Image Scale</label>
<input id="tb-image-scale" max="300" min="10" style="width:100%; margin-top: 5px;" type="range" value="100"/>
<span id="image-scale-value" style="font-size: 0.8rem; color: var(--gray);">100%</span>
</div>

<div class="toolbar-section">
<div class="toolbar-section-title"><i class="fas fa-download"></i> Save</div>
<button class="toolbar-btn btn-primary" disabled id="save-btn" style="background: var(--primary); color: #fff; width: 100%;">
<i class="fas fa-download"></i>
<span>Save PDF</span>
</button>
<button class="toolbar-btn" disabled id="save-ocr-only-btn" style="width: 100%; margin-top: 8px;">
<i class="fas fa-file-export"></i>
<span>OCR Only</span>
</button>
<button class="toolbar-btn" disabled id="save-selectable-btn" style="width: 100%; margin-top: 8px;" title="Embed fonts">
<i class="fas fa-file-signature"></i>
<span>Selectable</span>
</button>
</div>

<div class="toolbar-section">
<div class="toolbar-section-title"><i class="fas fa-search"></i> Zoom</div>
<button class="toolbar-btn" id="zoom-out" title="Zoom Out">
<i class="fas fa-search-minus"></i>
<span>Zoom Out</span>
</button>
<button class="toolbar-btn" id="zoom-in" title="Zoom In">
<i class="fas fa-search-plus"></i>
<span>Zoom In</span>
</button>
<button class="toolbar-btn" id="zoom-fit" title="Fit to Width">
<i class="fas fa-expand"></i>
<span>Fit Width</span>
</button>
<span class="zoom-label" id="zoom-pct" style="display: block; text-align: center; margin-top: 10px; font-weight: 600; color: var(--primary);">100%</span>
</div>

<div class="toolbar-section">
<div class="toolbar-section-title"><i class="fas fa-file"></i> File</div>
<button class="toolbar-btn" id="new-file-btn" style="width: 100%;">
<i class="fas fa-file"></i>
<span>New File</span>
</button>
</div>
</div>

</div>
</div>
</div>
<div class="progress-container" id="progress-container">
<div class="progress-bar">
<div class="progress" id="progress-bar"></div>
</div>
<div class="progress-text" id="progress-text">Loading PDF...</div>
</div>
<div class="loading" id="loading">
<div class="loading-spinner"></div>
<p>Processing your PDF file...</p>
</div>
<div class="success-message message" id="success-message">
<i class="fas fa-check-circle"></i> Your PDF has been successfully edited!
            </div>
<div class="error-message message" id="error-message">
<i class="fas fa-exclamation-circle"></i> <span id="error-text">An error occurred during processing</span>
</div>
<div class="action-buttons">
<button class="btn btn-secondary" id="new-file-btn">
<i class="fas fa-file"></i> New File
                </button>
</div>
</div>
<div class="features">
<div class="feature-card">
<div class="feature-icon"><i class="fas fa-edit"></i></div>
<h3>Direct Text Editing</h3>
<p>Click and edit text directly on the PDF with real-time preview</p>
</div>
<div class="feature-card">
<div class="feature-icon"><i class="fas fa-palette"></i></div>
<h3>Font Customization</h3>
<p>Change font family, size, color and apply highlights to text</p>
</div>
<div class="feature-card">
<div class="feature-icon"><i class="fas fa-text-height"></i></div>
<h3>Add New Text</h3>
<p>Insert new text anywhere on the PDF document</p>
</div>
<div class="feature-card">
<div class="feature-icon"><i class="fas fa-shield-alt"></i></div>
<h3>Secure &amp; Private</h3>
<p>Your files stay in your browser - no server uploads</p>
</div>
</div>
</div>
<!-- Context Menu -->
<div class="context-menu" id="context-menu">
<div class="context-menu-item" id="edit-text">Edit Text</div>
<div class="context-menu-item" id="change-font">Change Font</div>
<div class="context-menu-item" id="change-color">Change Color</div>
<div class="context-menu-item" id="highlight-text">Highlight</div>
<div class="context-menu-item" id="remove-text">Remove Text</div>
</div>
<script>
        const STABLE_MODE = false; // enable full tools, including Insert Image
        // Set PDF.js worker path
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
        
        // DOM elements
        const uploadArea = document.getElementById('upload-area'); // May be null in preview page
        const fileInput = document.getElementById('file-input'); // May be null in preview page
        const fileInfo = document.getElementById('file-info');
        const fileName = document.getElementById('file-name');
        const fileSize = document.getElementById('file-size');
        const editorSection = document.getElementById('editor-section');
        const pdfCanvas = document.getElementById('pdf-canvas');
        const overlayCanvas = document.getElementById('overlay-canvas');
        const textLayer = document.getElementById('text-layer');
        const a4Preview = document.getElementById('a4-preview');
        const zoomInBtn = document.getElementById('zoom-in');
        const zoomOutBtn = document.getElementById('zoom-out');
        const zoomFitBtn = document.getElementById('zoom-fit');
        const zoomPct = document.getElementById('zoom-pct');
        // Top edit toolbar refs
        const tbAddText = document.getElementById('tb-add-text');
        const tbFontFamily = document.getElementById('tb-font-family');
        const tbFontSize = document.getElementById('tb-font-size');
        const tbColor = document.getElementById('tb-color');
        const tbColorPreset = document.getElementById('tb-color-preset');
        const tbBold = document.getElementById('tb-bold');
        const tbItalic = document.getElementById('tb-italic');
        const tbUnderline = document.getElementById('tb-underline');
        const tbAlignLeft = document.getElementById('tb-align-left');
        const tbAlignCenter = document.getElementById('tb-align-center');
        const tbAlignRight = document.getElementById('tb-align-right');
        const highlightBtns = document.querySelectorAll('.highlight-btn');
        const prevPageBtn = document.getElementById('prev-page');
        const nextPageBtn = document.getElementById('next-page');
        const pageNum = document.getElementById('page-num');
        const pageCount = document.getElementById('page-count');
        const saveBtn = document.getElementById('save-btn');
        const saveOcrOnlyBtn = document.getElementById('save-ocr-only-btn');
        const saveSelectableBtn = document.getElementById('save-selectable-btn');
        const newFileBtn = document.getElementById('new-file-btn');
        const addFontInput = document.getElementById('add-font-input');
        // Image controls
        const tbInsertImage = document.getElementById('tb-insert-image');
        const imgFileInput = document.getElementById('img-file-input');
        const tbImageScale = document.getElementById('tb-image-scale');
        const progressContainer = document.getElementById('progress-container');
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');
        const loading = document.getElementById('loading');
        const successMessage = document.getElementById('success-message');
        const errorMessage = document.getElementById('error-message');
        const errorText = document.getElementById('error-text');
        const contextMenu = document.getElementById('context-menu');
        // OCR controls
        const ocrLang = document.getElementById('ocr-lang');
        const ocrAuto = document.getElementById('ocr-auto');
        
        // Tool elements
        const selectTool = document.getElementById('select-tool');
        const textTool = document.getElementById('text-tool');
        const highlightTool = document.getElementById('highlight-tool');
        const colorPicker = document.getElementById('color-picker');
        const fontSizeSelect = document.getElementById('font-size');
        const fontFamilySelect = document.getElementById('font-family');
        // Left panel action buttons
        const undoBtn = document.getElementById('undo-btn');
        const redoBtn = document.getElementById('redo-btn');
        const clearBtn = document.getElementById('clear-btn');
        
        const ocrBtn = document.getElementById('ocr-btn');
        const ocrRegionBtn = document.getElementById('ocr-region-btn');
        
        // PDF state
        let pdfDoc = null;
        let currentPage = 1;
        let currentScale = 1.0;
        let currentFile = null;
        let textAnnotations = [];
        let annotationHistory = [];
        let redoHistory = [];
        let activeTool = 'select';
        let ctx, overlayCtx;
        let uiZoom = 1;
        let selectedTextElement = null;
        let highlightColor = '#FFFF00';
        let lastRenderMetrics = { xOffset:0, yOffset:0, scale:1, pageWidth:595, pageHeight:842 };
        const embeddedFonts = {}; // key: family(lowercase) or filename -> {name, data}
        let lastExtractedOverlayCount = 0; // overlays created from PDF.js text extraction for current page
        
        // Initialize
        function init() {
            // Ensure canvases and contexts are ready early
            if (!ctx && pdfCanvas) ctx = pdfCanvas.getContext('2d');
            if (!overlayCtx && overlayCanvas) overlayCtx = overlayCanvas.getContext('2d');
            
            // Auto-load PDF from IndexedDB or blob URL
            autoLoadPDF();
            
            // Tool event listeners (Left Panel)
            if(selectTool) selectTool.addEventListener('click', () => setActiveTool('select'));
            if(textTool) textTool.addEventListener('click', () => setActiveTool('text'));
            if(highlightTool) highlightTool.addEventListener('click', () => setActiveTool('highlight'));
            if(ocrRegionBtn) ocrRegionBtn.addEventListener('click', enableOcrRegionMode);
            
            // Font controls (Left Panel)
            if(tbFontFamily) tbFontFamily.addEventListener('change', ()=>{ const el=getCurrentTextEl(); if(el){ el.style.fontFamily = tbFontFamily.value; saveTextAnnotation(el); updateMask(el);} });
            if(tbFontSize) tbFontSize.addEventListener('change', ()=>{ const el=getCurrentTextEl(); if(el){ el.style.fontSize = tbFontSize.value + 'px'; saveTextAnnotation(el); updateMask(el);} });
            if(tbColor) tbColor.addEventListener('input', ()=>{ const el=getCurrentTextEl(); if(el){ el.style.color = tbColor.value; saveTextAnnotation(el); }});
            if(tbColorPreset) tbColorPreset.addEventListener('change', ()=>{ const v = tbColorPreset.value; if(tbColor) tbColor.value = v; const el=getCurrentTextEl(); if(el){ el.style.color = v; saveTextAnnotation(el); }});
            if(tbBold) tbBold.addEventListener('click', ()=>{ const el=getCurrentTextEl(); if(el){ const w=getComputedStyle(el).fontWeight; el.style.fontWeight = (w==='700'||w==='bold')?'400':'700'; saveTextAnnotation(el); updateMask(el);} });
            if(tbItalic) tbItalic.addEventListener('click', ()=>{ const el=getCurrentTextEl(); if(el){ const s=getComputedStyle(el).fontStyle; el.style.fontStyle = (s==='italic')?'normal':'italic'; saveTextAnnotation(el); updateMask(el);} });
            if(tbUnderline) tbUnderline.addEventListener('click', ()=>{ const el=getCurrentTextEl(); if(el){ const d=getComputedStyle(el).textDecorationLine; el.style.textDecoration = (d.includes('underline'))?'none':'underline'; saveTextAnnotation(el); updateMask(el);} });
            if(tbAlignLeft) tbAlignLeft.addEventListener('click', ()=>{ if(selectedTextElement){ selectedTextElement.style.textAlign='left'; saveTextAnnotation(selectedTextElement);} });
            if(tbAlignCenter) tbAlignCenter.addEventListener('click', ()=>{ if(selectedTextElement){ selectedTextElement.style.textAlign='center'; saveTextAnnotation(selectedTextElement);} });
            if(tbAlignRight) tbAlignRight.addEventListener('click', ()=>{ if(selectedTextElement){ selectedTextElement.style.textAlign='right'; saveTextAnnotation(selectedTextElement);} });
            
            // Highlight colors (Left Panel)
            if(highlightColorBtns && highlightColorBtns.length > 0) {
                highlightColorBtns.forEach(btn => {
                    btn.addEventListener('click', () => {
                        highlightColorBtns.forEach(b => b.classList.remove('active'));
                        btn.classList.add('active');
                        highlightColor = btn.dataset.color || '#FFFF00';
                        const el = getCurrentTextEl();
                        if(el){ el.style.backgroundColor = highlightColor; saveTextAnnotation(el); updateMask(el); }
                    });
                });
            }
            
            // Right Panel - Edit buttons
            if(undoBtn) undoBtn.addEventListener('click', undo);
            if(redoBtn) redoBtn.addEventListener('click', redo);
            if(clearBtn) clearBtn.addEventListener('click', clearAnnotations);
            
            // Right Panel - Insert Image
            if(tbInsertImage) tbInsertImage.addEventListener('click', ()=>{ if(imgFileInput) imgFileInput.click(); });
            if(imgFileInput) imgFileInput.addEventListener('change', (e)=>{ if(typeof onImageChosen==='function') onImageChosen(e); });
            if(tbImageScale) {
                tbImageScale.addEventListener('input', ()=>{
                    if(imageScaleValue) imageScaleValue.textContent = tbImageScale.value + '%';
                    if(typeof onImageScaleChange==='function') onImageScaleChange();
                });
            }
            
            // Right Panel - Save buttons
            if(saveBtn) saveBtn.addEventListener('click', savePDF);
            if(saveOcrOnlyBtn) saveOcrOnlyBtn.addEventListener('click', saveOCROnlyPDF);
            if(saveSelectableBtn) saveSelectableBtn.addEventListener('click', saveSelectablePDF);
            if(newFileBtn) newFileBtn.addEventListener('click', resetEditor);
            
            // Zoom controls (Right Panel)
            if(zoomInBtn) zoomInBtn.addEventListener('click', ()=> setUiZoom(uiZoom + 0.1));
            if(zoomOutBtn) zoomOutBtn.addEventListener('click', ()=> setUiZoom(uiZoom - 0.1));
            if(zoomFitBtn) zoomFitBtn.addEventListener('click', fitPreviewToWidth);
            window.addEventListener('resize', ()=>{ if(zoomFitBtn) fitPreviewToWidth(); });
            
            // Page navigation
            if(prevPageBtn) prevPageBtn.addEventListener('click', prevPage);
            if(nextPageBtn) nextPageBtn.addEventListener('click', nextPage);

            // Custom Font Upload -> store for selectable export and apply in UI list
            if(addFontInput){
                addFontInput.addEventListener('change', async (e)=>{
                    try{
                        const f = e.target.files && e.target.files[0];
                        if(!f) return;
                        const buf = await f.arrayBuffer();
                        // Derive a family name from filename (without extension)
                        const name = (f.name||'custom').replace(/\.[^.]+$/,'');
                        const key = name.trim().toLowerCase();
                        embeddedFonts[key] = { name, data: new Uint8Array(buf) };
                        // Add to font family dropdowns if present
                        if(tbFontFamily){
                            const opt = document.createElement('option');
                            opt.textContent = name; opt.value = name;
                            tbFontFamily.appendChild(opt);
                            tbFontFamily.value = name;
                        }
                        if(fontFamilySelect){
                            const opt2 = document.createElement('option');
                            opt2.textContent = name; opt2.value = name;
                            fontFamilySelect.appendChild(opt2);
                            fontFamilySelect.value = name;
                        }
                        // Prefer this font for new text overlays
                        if(tbFontFamily) tbFontFamily.dispatchEvent(new Event('change'));
                    }catch(err){ console.error('Font add failed', err); showError('Failed to add font'); }
                    finally{ addFontInput.value = ''; }
                });
            }

            // Page navigation
            prevPageBtn.addEventListener('click', prevPage);
            nextPageBtn.addEventListener('click', nextPage);
            // OCR - ocrRegionBtn already handled above in init()
            
            // Canvas setup
            ctx = pdfCanvas.getContext('2d');
            overlayCtx = overlayCanvas.getContext('2d');
            
            // Set A4 dimensions (595x842 pixels at 72 DPI)
            pdfCanvas.width = 595;
            pdfCanvas.height = 842;
            overlayCanvas.width = 595;
            overlayCanvas.height = 842;
            // Zoom controls
            if(zoomInBtn) zoomInBtn.addEventListener('click', ()=> setUiZoom(uiZoom + 0.1));
            if(zoomOutBtn) zoomOutBtn.addEventListener('click', ()=> setUiZoom(uiZoom - 0.1));
            if(zoomFitBtn) zoomFitBtn.addEventListener('click', fitPreviewToWidth);
            window.addEventListener('resize', ()=>{ if(zoomFitBtn) fitPreviewToWidth(); });
            // Edit toolbar actions
            // Helper to get current target element (editing or selected)
            function getCurrentTextEl(){
                return selectedTextElement || document.querySelector('.editable-text.editing') || document.querySelector('.editable-text.selected');
            }
            if(tbAddText) tbAddText.addEventListener('click', ()=> setActiveTool('text'));
            if(tbFontFamily) tbFontFamily.addEventListener('change', ()=>{ const el=getCurrentTextEl(); if(el){ el.style.fontFamily = tbFontFamily.value; saveTextAnnotation(el); updateMask(el);} });
            if(tbFontSize) tbFontSize.addEventListener('change', ()=>{ const el=getCurrentTextEl(); if(el){ el.style.fontSize = tbFontSize.value + 'px'; saveTextAnnotation(el); updateMask(el);} });
            if(tbColor) tbColor.addEventListener('input', ()=>{ const el=getCurrentTextEl(); if(el){ el.style.color = tbColor.value; saveTextAnnotation(el); }});
            if(tbColorPreset) tbColorPreset.addEventListener('change', ()=>{ const v = tbColorPreset.value; if(tbColor) tbColor.value = v; const el=getCurrentTextEl(); if(el){ el.style.color = v; saveTextAnnotation(el); }});
            if(tbBold) tbBold.addEventListener('click', ()=>{ const el=getCurrentTextEl(); if(el){ const w=getComputedStyle(el).fontWeight; el.style.fontWeight = (w==='700'||w==='bold')?'400':'700'; saveTextAnnotation(el); updateMask(el);} });
            if(tbItalic) tbItalic.addEventListener('click', ()=>{ const el=getCurrentTextEl(); if(el){ const s=getComputedStyle(el).fontStyle; el.style.fontStyle = (s==='italic')?'normal':'italic'; saveTextAnnotation(el); updateMask(el);} });
            if(tbUnderline) tbUnderline.addEventListener('click', ()=>{ const el=getCurrentTextEl(); if(el){ const d=getComputedStyle(el).textDecorationLine; el.style.textDecoration = (d.includes('underline'))?'none':'underline'; saveTextAnnotation(el); updateMask(el);} });
            if(tbAlignLeft) tbAlignLeft.addEventListener('click', ()=>{ if(selectedTextElement){ selectedTextElement.style.textAlign='left'; saveTextAnnotation(selectedTextElement);} });
            if(tbAlignCenter) tbAlignCenter.addEventListener('click', ()=>{ if(selectedTextElement){ selectedTextElement.style.textAlign='center'; saveTextAnnotation(selectedTextElement);} });
            if(tbAlignRight) tbAlignRight.addEventListener('click', ()=>{ if(selectedTextElement){ selectedTextElement.style.textAlign='right'; saveTextAnnotation(selectedTextElement);} });
            
            // Highlight color buttons (left panel)  set active color and apply immediately if a text element is selected/editing
            highlightBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    highlightBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    highlightColor = btn.dataset.color;
                    const el=getCurrentTextEl();
                    if(el){ el.style.backgroundColor = highlightColor; saveTextAnnotation(el); updateMask(el); }
                });
            });
            
            // Context menu event listeners (guard for null)
            const cmEdit = document.getElementById('edit-text');
            const cmFont = document.getElementById('change-font');
            const cmColor = document.getElementById('change-color');
            const cmHighlight = document.getElementById('highlight-text');
            const cmRemove = document.getElementById('remove-text');
            if(cmEdit) cmEdit.addEventListener('click', editSelectedText);
            if(cmFont) cmFont.addEventListener('click', changeSelectedFont);
            if(cmColor) cmColor.addEventListener('click', changeSelectedColor);
            if(cmHighlight) cmHighlight.addEventListener('click', highlightSelectedText);
            if(cmRemove) cmRemove.addEventListener('click', removeSelectedText);
            
            // Close context menu when clicking elsewhere
            document.addEventListener('click', (e) => {
                if (!contextMenu.contains(e.target)) {
                    contextMenu.style.display = 'none';
                }
            });
            
            // Set initial tool
            setActiveTool('select');
        }
        
        // Handle file upload
        function handleFile(file) {
            console.log("File selected:", file);
            
            // Validate file type
            if (file.type !== 'application/pdf' && !file.name.toLowerCase().endsWith('.pdf')) {
                showError('Please select a valid PDF file');
                return;
            }
            
            // Check file size
            if (file.size > 50 * 1024 * 1024) {
                if(!confirm('This file is larger than 50MB. It may be slow to load. Continue?')){ 
                    return; 
                }
            }
            
            // Store file data and redirect to preview page
            const reader = new FileReader();
            reader.onload = function(e) {
                // Use IndexedDB for large files (better than sessionStorage)
                const request = indexedDB.open('PDFEditorDB', 1);
                request.onerror = function() {
                    // Fallback: use blob URL if IndexedDB fails
                    const blob = new Blob([e.target.result], { type: 'application/pdf' });
                    const url = URL.createObjectURL(blob);
                    sessionStorage.setItem('pdfFileURL', url);
                    sessionStorage.setItem('pdfFileName', file.name);
                    sessionStorage.setItem('pdfFileSize', file.size.toString());
                    window.location.href = 'edit-pdf-preview.html';
                };
                request.onsuccess = function() {
                    const db = request.result;
                    const transaction = db.transaction(['pdfFiles'], 'readwrite');
                    const store = transaction.objectStore('pdfFiles');
                    const fileData = {
                        name: file.name,
                        size: file.size,
                        type: file.type,
                        data: e.target.result,
                        timestamp: Date.now()
                    };
                    store.put(fileData, 'current');
                    transaction.oncomplete = function() {
                        window.location.href = 'edit-pdf-preview.html';
                    };
                    transaction.onerror = function() {
                        // Fallback to blob URL if transaction fails
                        const blob = new Blob([e.target.result], { type: 'application/pdf' });
                        const url = URL.createObjectURL(blob);
                        sessionStorage.setItem('pdfFileURL', url);
                        sessionStorage.setItem('pdfFileName', file.name);
                        sessionStorage.setItem('pdfFileSize', file.size.toString());
                        window.location.href = 'edit-pdf-preview.html';
                    };
                };
                request.onupgradeneeded = function() {
                    const db = request.result;
                    if (!db.objectStoreNames.contains('pdfFiles')) {
                        db.createObjectStore('pdfFiles');
                    }
                };
            };
            reader.onerror = function() {
                showError('Error reading file. Please try again.');
            };
            reader.readAsArrayBuffer(file);
        }
        
        // Auto-load PDF from IndexedDB or blob URL
        async function autoLoadPDF() {
            progressContainer.style.display = 'block';
            updateProgress(5, 'Loading PDF from storage...');
            
            try {
                // Try IndexedDB first
                const request = indexedDB.open('PDFEditorDB', 1);
                request.onerror = function() {
                    // Fallback to blob URL
                    loadFromBlobURL();
                };
                request.onsuccess = function() {
                    const db = request.result;
                    if (!db.objectStoreNames.contains('pdfFiles')) {
                        // No IndexedDB store, try blob URL
                        loadFromBlobURL();
                        return;
                    }
                    const transaction = db.transaction(['pdfFiles'], 'readonly');
                    const store = transaction.objectStore('pdfFiles');
                    
                    // Get all records and use the latest one (highest ID)
                    const getAllRequest = store.getAll();
                    getAllRequest.onsuccess = function() {
                        const allFiles = getAllRequest.result;
                        if (allFiles && allFiles.length > 0) {
                            // Sort by ID (or timestamp) and get the latest
                            const latestFile = allFiles.sort((a, b) => {
                                const idA = a.id || a.timestamp || 0;
                                const idB = b.id || b.timestamp || 0;
                                return idB - idA;
                            })[0];
                            
                            if (latestFile && latestFile.data) {
                                updateProgress(20, 'PDF found in storage...');
                                // Create File object from stored data
                                const blob = new Blob([latestFile.data], { type: 'application/pdf' });
                                const file = new File([blob], latestFile.name || 'document.pdf', { type: 'application/pdf' });
                                currentFile = file;
                                fileName.textContent = latestFile.name || 'document.pdf';
                                fileSize.textContent = formatFileSize(latestFile.size || 0);
                                fileInfo.style.display = 'block';
                                loadPDF(file);
                                return;
                            }
                        }
                        // No data found, try blob URL
                        loadFromBlobURL();
                    };
                    getAllRequest.onerror = function() {
                        loadFromBlobURL();
                    };
                };
                request.onupgradeneeded = function() {
                    // Database doesn't exist, try blob URL
                    loadFromBlobURL();
                };
            } catch (error) {
                console.error('Error loading from IndexedDB:', error);
                loadFromBlobURL();
            }
        }
        
        // Load PDF from blob URL (fallback)
        function loadFromBlobURL() {
            const blobURL = sessionStorage.getItem('pdfFileURL');
            const fileNameStr = sessionStorage.getItem('pdfFileName') || 'document.pdf';
            const fileSizeStr = sessionStorage.getItem('pdfFileSize') || '0';
            
            if (blobURL) {
                updateProgress(20, 'Loading PDF from URL...');
                // Fetch blob and create File object
                fetch(blobURL)
                    .then(response => response.blob())
                    .then(blob => {
                        const file = new File([blob], fileNameStr, { type: 'application/pdf' });
                        currentFile = file;
                        fileName.textContent = fileNameStr;
                        fileSize.textContent = formatFileSize(parseInt(fileSizeStr));
                        fileInfo.style.display = 'block';
                        loadPDF(file);
                    })
                    .catch(error => {
                        console.error('Error loading from blob URL:', error);
                        progressContainer.style.display = 'none';
                        showError('Failed to load PDF. Please upload a file from the main editor page.');
                    });
            } else {
                progressContainer.style.display = 'none';
                showError('No PDF file found. Please upload a file from the main editor page.');
            }
        }
        
        // Load PDF document
        function loadPDF(file) {
            progressContainer.style.display = 'block';
            updateProgress(10, 'Loading PDF...');
            
            const fileReader = new FileReader();
            
            fileReader.onload = function() {
                const typedArray = new Uint8Array(this.result);
                
                // Use pdfjsLib from the global scope
                // If opened via file:// protocol, disable worker (browser may block cross-origin worker)
                try{
                    if(location && location.protocol === 'file:'){
                        pdfjsLib.GlobalWorkerOptions.workerSrc = null; // ensure no remote worker
                    }else{
                        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
                    }
                }catch(_){ }
                const docOpts = (location && location.protocol === 'file:') ? { data: typedArray, disableWorker: true } : { data: typedArray };
                pdfjsLib.getDocument(docOpts).promise.then(function(pdf) {
                    pdfDoc = pdf;
                    pageCount.textContent = pdf.numPages;
                    updateProgress(50, 'Rendering PDF...');
                    
                    // Render first page
                    renderPage(currentPage);
                    
                    // Show editor section
                    editorSection.style.display = 'block';
                    saveBtn.disabled = false;
                    if(saveOcrOnlyBtn) saveOcrOnlyBtn.disabled = false;
                    updateProgress(100, 'PDF loaded successfully');
                    
                    setTimeout(() => {
                        progressContainer.style.display = 'none';
                    }, 1000);
                    
                }).catch(function(error) {
                    console.error('Error loading PDF:', error);
                    showError('Failed to load PDF. If you opened this page from your disk (file://), please try again or run with a local server.');
                    progressContainer.style.display = 'none';
                });
            };
            
            fileReader.onerror = function() {
                console.error('Error reading file');
                showError('Error reading file. Please try again.');
                progressContainer.style.display = 'none';
            };
            
            fileReader.readAsArrayBuffer(file);
        }
        
        // Render PDF page
        function renderPage(pageNum) {
            if (!pdfDoc) return;
            // Ensure contexts exist
            if (!ctx && pdfCanvas) ctx = pdfCanvas.getContext('2d');
            if (!overlayCtx && overlayCanvas) overlayCtx = overlayCanvas.getContext('2d');
            if (!ctx) { console.error('Canvas context not ready'); showError('Preview not ready. Please retry upload.'); return; }
            pdfDoc.getPage(pageNum).then(function(page) {
                const viewport = page.getViewport({ scale: 1.0 });
                const scaleX = 595 / viewport.width;
                const scaleY = 842 / viewport.height;
                currentScale = Math.min(scaleX, scaleY);
                const scaledViewport = page.getViewport({ scale: currentScale });
                // Prepare target canvases
                pdfCanvas.width = 595; pdfCanvas.height = 842;
                overlayCanvas.width = 595; overlayCanvas.height = 842;
                // re-acquire contexts after size change (some browsers drop state)
                if (pdfCanvas) ctx = pdfCanvas.getContext('2d');
                if (overlayCanvas) overlayCtx = overlayCanvas.getContext('2d');
                if (!ctx) { console.error('Canvas context not ready after resize'); showError('Preview not ready. Please retry upload.'); return; }
                const xOffset = (595 - scaledViewport.width) / 2;
                const yOffset = (842 - scaledViewport.height) / 2;
                lastRenderMetrics = { xOffset, yOffset, scale: currentScale, pageWidth: scaledViewport.width, pageHeight: scaledViewport.height };
                // Clear base/overlay to white background
                ctx.setTransform(1,0,0,1,0,0);
                ctx.clearRect(0,0,pdfCanvas.width,pdfCanvas.height);
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0,0,pdfCanvas.width,pdfCanvas.height);
                if(overlayCtx){ overlayCtx.clearRect(0,0,overlayCanvas.width, overlayCanvas.height); }
                // Render into an offscreen canvas to avoid transform issues
                const off = document.createElement('canvas');
                off.width = Math.ceil(scaledViewport.width);
                off.height = Math.ceil(scaledViewport.height);
                const offctx = off.getContext('2d');
                const task = page.render({ canvasContext: offctx, viewport: scaledViewport });
                task.promise.then(function(){
                    // Blit to A4 canvas centered
                    ctx.drawImage(off, Math.round(xOffset), Math.round(yOffset));
                    document.getElementById('page-num').textContent = currentPage;
                    // Build editable text overlays from PDF content (OCR fallback if none)
                    lastExtractedOverlayCount = 0;
                    extractTextContent(page, xOffset, yOffset, currentScale);
                    renderTextAnnotations();
                    fitPreviewToWidth();
                    // If no selectable text was found (likely scanned PDF), fallback to OCR automatically
                    if(lastExtractedOverlayCount === 0){
                        runOcrOnCurrentPage();
                    } else if(ocrAuto && ocrAuto.checked){
                        runOcrOnCurrentPage();
                    }
                }).catch(function(err){
                    console.error('PDF render (offscreen) error:', err);
                    showError('Failed to render PDF page.');
                });
            }).catch(function(err){
                console.error('PDF getPage error:', err);
                showError('Failed to load PDF page.');
            });
        }

        // Save selectable PDF by embedding fonts and writing text via pdf-lib
        async function saveSelectablePDF(){
            if(!pdfDoc || !currentFile) return;
            loading.style.display = 'block'; hideMessages();
            try{
                const fileBytes = await currentFile.arrayBuffer();
                const pdfDocW = await PDFLib.PDFDocument.load(fileBytes);
                const page = pdfDocW.getPage(currentPage-1);
                if(!page){ throw new Error('Page not found'); }
                // Prepare font cache in this doc
                const fontCache = {};
                async function getFontForFamily(family){
                    if(!family) family = 'Arial';
                    const key = family.split(',')[0].trim().replace(/"/g,'').toLowerCase();
                    if(fontCache[key]) return fontCache[key];
                    // Try embedded custom
                    if(embeddedFonts[key]){
                        fontCache[key] = await pdfDocW.embedFont(embeddedFonts[key].data, { subset:true });
                        return fontCache[key];
                    }
                    // Fallback map
                    const std = PDFLib.StandardFonts;
                    const pref = key.includes('times')?std.TimesRoman: key.includes('courier')?std.Courier: std.Helvetica;
                    fontCache[key] = await pdfDocW.embedFont(pref);
                    return fontCache[key];
                }
                // Write each editable text (await fonts and draw in order)
                const nodes = Array.from(textLayer.querySelectorAll('.editable-text'));
                const { xOffset, yOffset, scale } = lastRenderMetrics;
                const ph = page.getHeight();
                for(const el of nodes){
                    const left = parseFloat(el.style.left)||0;
                    const top = parseFloat(el.style.top)||0;
                    const fs = parseFloat(el.style.fontSize)||14;
                    const fam = (el.style.fontFamily||'Helvetica');
                    const col = el.style.color || '#000000';
                    const lines = (el.textContent||'').split('\n');
                    const pdfX = (left - xOffset)/scale;
                    const yTop = (top - yOffset)/scale;
                    const baseY = ph - (yTop + fs/scale);
                    const rgb = hexToRgb01(col);
                    const font = await getFontForFamily(fam);
                    const sizePt = fs/scale;
                    for(let idx=0; idx<lines.length; idx++){
                        const line = lines[idx];
                        const y = baseY + (lines.length-1-idx)*(fs*1.2/scale);
                        page.drawText(line, { x: pdfX, y, font, size: sizePt, color: PDFLib.rgb(rgb.r, rgb.g, rgb.b) });
                    }
                }
                const outBytes = await pdfDocW.save();
                const blob = new Blob([outBytes], { type:'application/pdf' });
                const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
                a.download = 'selectable-' + (currentFile.name.replace(/\.pdf$/i,'') || 'document') + '.pdf'; a.click();
                loading.style.display = 'none'; successMessage.style.display = 'block';
            }catch(err){
                console.error(err);
                loading.style.display = 'none'; showError('Selectable save failed.');
            }
        }

        function hexToRgb01(hex){
            const m = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex||'#000000');
            if(!m) return {r:0,g:0,b:0};
            return { r: parseInt(m[1],16)/255, g: parseInt(m[2],16)/255, b: parseInt(m[3],16)/255 };
        }
        
        // Extract text content from PDF for editing
        function extractTextContent(page, xOffset, yOffset, scale) {
            textLayer.innerHTML = '';
            page.getTextContent().then(function(textContent) {
                const items = textContent.items || [];
                if(!items.length){ lastExtractedOverlayCount = 0; return; }
                items.forEach(function(textItem) {
                    const tx = xOffset + (textItem.transform[4] * scale);
                    const ty = 842 - (yOffset + (textItem.transform[5] * scale));
                    
                    // Create editable text element
                    const textEl = document.createElement('div');
                    textEl.className = 'editable-text';
                    textEl.textContent = textItem.str;
                    textEl.style.left = tx + 'px';
                    textEl.style.top = (ty - 15) + 'px'; // Adjust for text height
                    textEl.style.fontSize = (textItem.height * scale) + 'px';
                    textEl.style.color = '#000000';
                    textEl.style.fontFamily = 'Noto Sans, Arial, sans-serif';
                    textEl.style.cursor = 'text';
                    textEl.tabIndex = 0;
                    
                    // Store original properties
                    textEl.dataset.originalText = textItem.str;
                    textEl.dataset.originalFont = textItem.fontName;
                    textEl.dataset.originalSize = (textItem.height * scale);
                    textEl.dataset.originalX = tx;
                    textEl.dataset.originalY = ty;
                    
                    // Add event listeners
                    textEl.addEventListener('dblclick', function(e) {
                        e.stopPropagation();
                        makeTextEditable(textEl, e);
                    });
                    
                    textEl.addEventListener('contextmenu', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        showContextMenu(e, textEl);
                    });
                    
                    textEl.addEventListener('click', function(e) {
                        e.stopPropagation();
                        selectTextElement(textEl);
                        // Enter edit mode on single click for faster editing
                        makeTextEditable(textEl, e);
                    });
                    
                    textLayer.appendChild(textEl);
                    lastExtractedOverlayCount++;
                });
            });
        }
        
        // Make text element editable (contentEditable inline)
        function makeTextEditable(textEl, clickEvent) {
            document.querySelectorAll('.editable-text.selected').forEach(el => {
                el.classList.remove('selected', 'editing');
                el.contentEditable = 'false';
            });
            textEl.classList.add('selected', 'editing');
            selectedTextElement = textEl;
            textEl.contentEditable = 'true';
            // place caret at click position if possible, otherwise at end
            const sel = window.getSelection();
            sel.removeAllRanges();
            let range = document.createRange();
            try{
                if(clickEvent && document.caretRangeFromPoint){
                    const r = document.caretRangeFromPoint(clickEvent.clientX, clickEvent.clientY);
                    if(r){ range = r; }
                    else { range.selectNodeContents(textEl); range.collapse(false); }
                } else if(clickEvent && document.caretPositionFromPoint){
                    const pos = document.caretPositionFromPoint(clickEvent.clientX, clickEvent.clientY);
                    if(pos){ range.setStart(pos.offsetNode, pos.offset); range.collapse(true); }
                    else { range.selectNodeContents(textEl); range.collapse(false); }
                } else {
                    range.selectNodeContents(textEl); range.collapse(false);
                }
            }catch(_){ range.selectNodeContents(textEl); range.collapse(false); }
            sel.addRange(range);
            textEl.focus();
            // stop propagation to avoid page click handlers
            textEl.addEventListener('keydown', (e)=>{
                // allow natural typing/backspace/delete; prevent bubbling for navigation keys
                e.stopPropagation();
            });
            // ensure underlying mask to hide original canvas text
            ensureMask(textEl);
            textEl.addEventListener('input', ()=> updateMask(textEl));
            textEl.addEventListener('blur', ()=>{
                textEl.classList.remove('editing');
                textEl.contentEditable = 'false';
                saveTextAnnotation(textEl);
            }, { once: true });
        }
        
        // Finish editing text no longer needed (handled on blur)
        
        // Save text annotation
        function saveTextAnnotation(textEl) {
            const annotation = {
                type: 'text',
                text: textEl.textContent,
                x: parseFloat(textEl.style.left),
                y: parseFloat(textEl.style.top),
                fontSize: parseFloat(textEl.style.fontSize),
                fontFamily: textEl.style.fontFamily || 'Arial',
                color: textEl.style.color,
                page: currentPage,
                timestamp: Date.now()
            };
            
            addAnnotation(annotation);
        }
        
        // Show context menu for text element
        function showContextMenu(e, textEl) {
            e.preventDefault();
            selectedTextElement = textEl;
            
            contextMenu.style.left = e.pageX + 'px';
            contextMenu.style.top = e.pageY + 'px';
            contextMenu.style.display = 'block';
        }
        
        // Edit selected text
        function editSelectedText() {
            if (selectedTextElement) {
                makeTextEditable(selectedTextElement);
                contextMenu.style.display = 'none';
            }
        }

        // Save OCR-Only (no background image), Unicode-safe by rasterizing text via Canvas
        async function saveOCROnlyPDF(){
            if (!pdfDoc || !currentFile) return;
            loading.style.display = 'block';
            hideMessages();
            try{
                // Build an offscreen canvas with white background
                const w = 595, h = 842;
                const out = document.createElement('canvas'); out.width = w; out.height = h;
                const octx = out.getContext('2d');
                octx.fillStyle = '#FFFFFF';
                octx.fillRect(0,0,w,h);
                // Draw text overlays using browser font stack (Unicode-friendly)
                const nodes = Array.from(textLayer.querySelectorAll('.editable-text'));
                nodes.forEach(el => {
                    const left = parseFloat(el.style.left)||0;
                    const top = parseFloat(el.style.top)||0;
                    const fs = parseFloat(el.style.fontSize)||14;
                    const fam = el.style.fontFamily || 'Noto Sans, Arial';
                    const col = el.style.color || '#000';
                    const cs = getComputedStyle(el);
                    const fw = cs.fontWeight;
                    const it = cs.fontStyle;
                    octx.fillStyle = col;
                    octx.textBaseline = 'top';
                    octx.font = `${it==='italic'?'italic ':''}${(fw==='700'||fw==='bold')?'bold ':''}${fs}px ${fam}`;
                    const lines = (el.textContent||'').split('\n');
                    let y = top; const lh = fs*1.2;
                    lines.forEach(line=>{ octx.fillText(line, left, y); y += lh; });
                });
                // Draw overlay images
                const imgs = Array.from(textLayer.querySelectorAll('.overlay-image'));
                await Promise.all(imgs.map(el=> new Promise((res)=>{ const im = new Image(); im.onload=()=>{ const left=parseFloat(el.style.left)||0; const top=parseFloat(el.style.top)||0; const wv=parseFloat(el.style.width)||im.naturalWidth; const hv=im.naturalHeight*(wv/im.naturalWidth); octx.drawImage(im, left, top, wv, hv); res(); }; im.src = el.src; })));
                // Export to PDF as a single image
                const imgData = out.toDataURL('image/png');
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF({ unit:'pt', format:[w,h], compress:true });
                doc.addImage(imgData, 'PNG', 0, 0, w, h);
                const fname = 'ocr-only-' + (currentFile.name.replace(/\.pdf$/i,'') || 'document') + '.pdf';
                doc.save(fname);
                loading.style.display = 'none';
                successMessage.style.display = 'block';
            }catch(err){
                console.error(err);
                loading.style.display = 'none';
                showError('Save failed.');
            }
        }

        // Open a clean OCR-only editor in a new tab/window (no background shadow)
        function openCleanOcrEditor(){
            if(!pdfDoc){ showError('Please upload a PDF first'); return; }
            const img = pdfCanvas.toDataURL('image/png');
            const w = window.open('about:blank', '_blank');
            if(!w){ showError('Popup blocked. Please allow popups for this site.'); return; }
            const d = w.document; d.open();
            d.write('<!DOCTYPE html><html><head><meta charset="utf-8"><title>Advanced PDF Editor Online - Edit PDF Files with Real-Time Preview | easyjpgtopdf</title>
    <meta name="description" content="Advanced PDF editor online with real-time editing, full A4 preview, text editing, image insertion, OCR, and professional editing tools. Edit PDF files online free without installation.">
    <meta name="keywords" content="advanced pdf editor online, pdf editor online free, edit pdf online, free pdf editor, online pdf editor, edit pdf files online, pdf editor tool, edit pdf documents, pdf editor software, edit pdf text, pdf editor free online, best pdf editor online, edit pdf online free no download, pdf editor website, edit pdf online tool, free online pdf editor, real-time pdf editor">
    <link rel="stylesheet" href="css/footer.css"></link>');
            d.write('<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"></link>');
            d.write('<style>body{margin:16px;background:#f5f7ff;font-family:Segoe UI,Tahoma,Arial,sans-serif}.toolbar select,.toolbar input[type=color]{padding:6px 8px;border:1px solid #ddd;border-radius:8px;background:#fff}.btn{display:inline-flex;align-items:center;gap:6px;padding:8px 12px;border:1px solid #ddd;border-radius:8px;background:#fff;cursor:pointer}.page{width:595px;min-height:842px;background:#fff;box-shadow:0 4px 12px rgba(0,0,0,.12);margin:0 auto;position:relative}#text-layer{position:absolute;inset:0}.editable-text{position:absolute;cursor:text;padding:2px 4px;border:1px dashed transparent;user-select:text;white-space:pre-wrap;z-index:2}.editable-text.selected{border-color:#4361ee;background:rgba(67,97,238,.08)}.editable-text.editing{border:2px solid #4361ee;background:#fff;z-index:3;outline:none}</style>');
            d.write('    

    <link rel="stylesheet" href="css/header.css"></link>
    <link rel="stylesheet" href="css/theme-modern.css"></link>
        <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "Advanced PDF Editor Online",
      "description": "Advanced PDF editor online with real-time editing, full A4 preview, text editing, image insertion, OCR, and professional editing tools. Edit PDF files online free without installation.",
      "url": "https://easyjpgtopdf.com/edit-pdf-preview.html",
      "applicationCategory": "UtilityApplication",
      "operatingSystem": "Any",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "featureList": [
        "Edit PDF text online",
        "Add images to PDF",
        "OCR text recognition",
        "Real-time PDF editing",
        "Full A4 preview",
        "No software installation required"
      ],
      "inLanguage": "en-US",
      "isPartOf": {
        "@type": "WebSite",
        "name": "easyjpgtopdf",
        "url": "https://easyjpgtopdf.com"
      },
      "publisher": {
        "@type": "Organization",
        "name": "easyjpgtopdf",
        "url": "https://easyjpgtopdf.com"
      },
      "author": {
        "@type": "Person",
        "name": "Riyaz Mohammad"
      }
    }
    </script>
</head><body>');
            d.write('<div class="toolbar">'
              + '<select id="ff"><option>Inter</option><option>Roboto</option><option>Open Sans</option><option>Lato</option><option>Poppins</option><option>Montserrat</option><option>Source Sans 3</option><option>Noto Sans</option><option>PT Sans</option><option>PT Serif</option><option>Merriweather</option><option>Georgia</option><option>Verdana</option><option>Courier New</option><option>Times New Roman</option><option selected>Arial</option></select>'
              + '<select id="fs"><option>10</option><option>12</option><option selected>14</option><option>16</option><option>18</option><option>24</option><option>32</option></select>'
              + '<input id="tc" type="color" value="#111827" title="Text Color"></input>'
              + '<button id="bBold" class="btn" title="Bold"><i class="fas fa-bold"></i></button>'
              + '<button id="bItalic" class="btn" title="Italic"><i class="fas fa-italic"></i></button>'
              + '<button id="bUnderline" class="btn" title="Underline"><i class="fas fa-underline"></i></button>'
              + '<button id="bSave" class="btn" title="Save"><i class="fas fa-download"></i> Save</button>'
              + '</div>');
            d.write('<div class="page"><div id="text-layer"></div></div>');
            d.write('
    </script>
    
    <section class="how-to-guide" style="margin: 40px 0; padding: 40px; background: white; border-radius: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
        <h2 style="font-size: 2rem; color: #4361ee; margin-bottom: 30px; text-align: center;">
            <i class="fas fa-book-open" style="margin-right: 10px;"></i>
            How to Use Advanced PDF Editor Online - Edit PDF Files Online Free
        </h2>
        <div class="steps-container" style="max-width: 800px; margin: 0 auto;">
            <ol style="list-style: none; padding: 0; counter-reset: step-counter;">

                <li style="counter-increment: step-counter; margin-bottom: 25px; padding: 20px; background: #f8f9ff; border-radius: 12px; border-left: 4px solid #4361ee; position: relative; padding-left: 60px;">
                    <span style="position: absolute; left: 15px; top: 20px; background: #4361ee; color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.1rem;">
                        1
                    </span>
                    <p style="font-size: 1.1rem; color: #0b1630; line-height: 1.6; margin: 0;">
                        Upload the PDF file you want to edit
                    </p>
                </li>

                <li style="counter-increment: step-counter; margin-bottom: 25px; padding: 20px; background: #f8f9ff; border-radius: 12px; border-left: 4px solid #4361ee; position: relative; padding-left: 60px;">
                    <span style="position: absolute; left: 15px; top: 20px; background: #4361ee; color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.1rem;">
                        2
                    </span>
                    <p style="font-size: 1.1rem; color: #0b1630; line-height: 1.6; margin: 0;">
                        Use the editing tools to add or modify content
                    </p>
                </li>

                <li style="counter-increment: step-counter; margin-bottom: 25px; padding: 20px; background: #f8f9ff; border-radius: 12px; border-left: 4px solid #4361ee; position: relative; padding-left: 60px;">
                    <span style="position: absolute; left: 15px; top: 20px; background: #4361ee; color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.1rem;">
                        3
                    </span>
                    <p style="font-size: 1.1rem; color: #0b1630; line-height: 1.6; margin: 0;">
                        Add text, images, shapes, or annotations
                    </p>
                </li>

                <li style="counter-increment: step-counter; margin-bottom: 25px; padding: 20px; background: #f8f9ff; border-radius: 12px; border-left: 4px solid #4361ee; position: relative; padding-left: 60px;">
                    <span style="position: absolute; left: 15px; top: 20px; background: #4361ee; color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.1rem;">
                        4
                    </span>
                    <p style="font-size: 1.1rem; color: #0b1630; line-height: 1.6; margin: 0;">
                        Preview your changes in real-time
                    </p>
                </li>

                <li style="counter-increment: step-counter; margin-bottom: 25px; padding: 20px; background: #f8f9ff; border-radius: 12px; border-left: 4px solid #4361ee; position: relative; padding-left: 60px;">
                    <span style="position: absolute; left: 15px; top: 20px; background: #4361ee; color: white; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.1rem;">
                        5
                    </span>
                    <p style="font-size: 1.1rem; color: #0b1630; line-height: 1.6; margin: 0;">
                        Download your edited PDF
                    </p>
                </li>

            </ol>
        </div>
    </section>

    <section 
    <section class="related-tools" style="margin: 40px 0; padding: 40px; background: white; border-radius: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
        <h2 style="font-size: 2rem; color: #4361ee; margin-bottom: 30px; text-align: center;">
            <i class="fas fa-tools" style="margin-right: 10px;"></i>
            Related PDF Tools - Edit, Convert, and Manage PDF Files Online
        </h2>
        <div class="tools-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">

            <a href="watermark-pdf.html" style="display: block; padding: 20px; background: #f8f9ff; border-radius: 12px; text-decoration: none; text-align: center; transition: transform 0.3s, box-shadow 0.3s; border: 2px solid transparent;" 
               onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 8px 16px rgba(67,97,238,0.2)'; this.style.borderColor='#4361ee';"
               onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; this.style.borderColor='transparent';">
                <i class="fas fa-file-alt" style="font-size: 2rem; color: #4361ee; margin-bottom: 10px;"></i>
                <h3 style="font-size: 1.1rem; color: #0b1630; margin: 0;">Watermark Pdf</h3>
            </a>

            <a href="protect-pdf.html" style="display: block; padding: 20px; background: #f8f9ff; border-radius: 12px; text-decoration: none; text-align: center; transition: transform 0.3s, box-shadow 0.3s; border: 2px solid transparent;" 
               onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 8px 16px rgba(67,97,238,0.2)'; this.style.borderColor='#4361ee';"
               onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; this.style.borderColor='transparent';">
                <i class="fas fa-file-alt" style="font-size: 2rem; color: #4361ee; margin-bottom: 10px;"></i>
                <h3 style="font-size: 1.1rem; color: #0b1630; margin: 0;">Protect Pdf</h3>
            </a>

            <a href="add-page-numbers.html" style="display: block; padding: 20px; background: #f8f9ff; border-radius: 12px; text-decoration: none; text-align: center; transition: transform 0.3s, box-shadow 0.3s; border: 2px solid transparent;" 
               onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 8px 16px rgba(67,97,238,0.2)'; this.style.borderColor='#4361ee';"
               onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; this.style.borderColor='transparent';">
                <i class="fas fa-file-alt" style="font-size: 2rem; color: #4361ee; margin-bottom: 10px;"></i>
                <h3 style="font-size: 1.1rem; color: #0b1630; margin: 0;">Add Page Numbers</h3>
            </a>

        </div>
    </section>

    <section class="faq-section" style="margin: 40px 0; padding: 40px; background: #f8f9ff; border-radius: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
        <h2 style="font-size: 2rem; color: #4361ee; margin-bottom: 30px; text-align: center;">
            <i class="fas fa-question-circle" style="margin-right: 10px;"></i>
            Frequently Asked Questions
        </h2>
        <div class="faq-container" style="max-width: 800px; margin: 0 auto;">

            <div class="faq-item" style="margin-bottom: 20px; padding: 20px; background: white; border-radius: 12px; border-left: 4px solid #4361ee; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                <h3 style="font-size: 1.2rem; color: #0b1630; margin-bottom: 10px; cursor: pointer; display: flex; align-items: center;" onclick="toggleFaq(this)">
                    <i class="fas fa-chevron-right" style="color: #4361ee; margin-right: 10px; transition: transform 0.3s;"></i>
                    Can I edit PDFs without Adobe?
                </h3>
                <div class="faq-answer" style="font-size: 1rem; color: #56607a; line-height: 1.6; margin-top: 10px; display: none; padding-left: 30px;">
                    Yes! Our online PDF editor works in any browser without requiring software installation.
                </div>
            </div>

            <div class="faq-item" style="margin-bottom: 20px; padding: 20px; background: white; border-radius: 12px; border-left: 4px solid #4361ee; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                <h3 style="font-size: 1.2rem; color: #0b1630; margin-bottom: 10px; cursor: pointer; display: flex; align-items: center;" onclick="toggleFaq(this)">
                    <i class="fas fa-chevron-right" style="color: #4361ee; margin-right: 10px; transition: transform 0.3s;"></i>
                    What editing features are available?
                </h3>
                <div class="faq-answer" style="font-size: 1rem; color: #56607a; line-height: 1.6; margin-top: 10px; display: none; padding-left: 30px;">
                    You can add text, images, annotations, highlight, draw shapes, and more. All editing is done online.
                </div>
            </div>

            <div class="faq-item" style="margin-bottom: 20px; padding: 20px; background: white; border-radius: 12px; border-left: 4px solid #4361ee; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                <h3 style="font-size: 1.2rem; color: #0b1630; margin-bottom: 10px; cursor: pointer; display: flex; align-items: center;" onclick="toggleFaq(this)">
                    <i class="fas fa-chevron-right" style="color: #4361ee; margin-right: 10px; transition: transform 0.3s;"></i>
                    Will formatting be preserved?
                </h3>
                <div class="faq-answer" style="font-size: 1rem; color: #56607a; line-height: 1.6; margin-top: 10px; display: none; padding-left: 30px;">
                    Yes, our editor maintains all original formatting, fonts, and layout while allowing edits.
                </div>
            </div>

            <div class="faq-item" style="margin-bottom: 20px; padding: 20px; background: white; border-radius: 12px; border-left: 4px solid #4361ee; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                <h3 style="font-size: 1.2rem; color: #0b1630; margin-bottom: 10px; cursor: pointer; display: flex; align-items: center;" onclick="toggleFaq(this)">
                    <i class="fas fa-chevron-right" style="color: #4361ee; margin-right: 10px; transition: transform 0.3s;"></i>
                    Can I undo changes?
                </h3>
                <div class="faq-answer" style="font-size: 1rem; color: #56607a; line-height: 1.6; margin-top: 10px; display: none; padding-left: 30px;">
                    Yes, our editor includes undo/redo functionality for easy editing.
                </div>
            </div>

            <div class="faq-item" style="margin-bottom: 20px; padding: 20px; background: white; border-radius: 12px; border-left: 4px solid #4361ee; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                <h3 style="font-size: 1.2rem; color: #0b1630; margin-bottom: 10px; cursor: pointer; display: flex; align-items: center;" onclick="toggleFaq(this)">
                    <i class="fas fa-chevron-right" style="color: #4361ee; margin-right: 10px; transition: transform 0.3s;"></i>
                    Is there a file size limit?
                </h3>
                <div class="faq-answer" style="font-size: 1rem; color: #56607a; line-height: 1.6; margin-top: 10px; display: none; padding-left: 30px;">
                    Free users can edit PDFs up to 10MB. Premium users can edit files up to 100MB.
                </div>
            </div>

        </div>
    </section>
    
    <script>
    function toggleFaq(element) {
        const answer = element.nextElementSibling;
        const icon = element.querySelector('i');
        const isOpen = answer.style.display === 'block';
        
        answer.style.display = isOpen ? 'none' : 'block';
        icon.style.transform = isOpen ? 'rotate(0deg)' : 'rotate(90deg)';
    }
    </script>

    <div class="trust-badges" style="text-align: center; padding: 20px; background: linear-gradient(135deg, #f8f9ff, #ffffff); border-radius: 12px; margin: 30px 0; border: 2px solid #e2e6ff;">
        <div style="display: flex; justify-content: center; align-items: center; gap: 40px; flex-wrap: wrap;">
            <div style="display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-shield-alt" style="font-size: 2rem; color: #4361ee;"></i>
                <div style="text-align: left;">
                    <div style="color: #0b1630; font-weight: 600; font-size: 1.1rem;">SSL Secured</div>
                    <div style="color: #56607a; font-size: 0.9rem;">256-bit Encryption</div>
                </div>
            </div>
            <div style="display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-lock" style="font-size: 2rem; color: #4361ee;"></i>
                <div style="text-align: left;">
                    <div style="color: #0b1630; font-weight: 600; font-size: 1.1rem;">100% Secure</div>
                    <div style="color: #56607a; font-size: 0.9rem;">Files Auto-Deleted</div>
                </div>
            </div>
            
        </div>
    </div>
<footer>
        <div class="container footer-inner">
            <div class="footer-company-links">
                <span>Company</span>
                <a href="index.html#about">About Us</a>
                <a href="index.html#contact">Contact</a>
                <a href="pricing.html">Pricing</a>
                <a href="privacy-policy.html">Privacy Policy</a>
                <a href="terms-of-service.html">Terms of Service</a>
                <a href="dmca-en.html">DMCA</a>
                <a href="blog.html">Blog</a>
            </div>
            <p class="footer-brand-line">&copy; easyjpgtopdf &mdash; Free PDF &amp; Image Tools for everyone. All rights reserved.</p>
            <p class="footer-credits">
                Thanks to Font Awesome, Google Fonts, jsPDF, pdf.js, pdf-lib, Mammoth, Tesseract.js, IMG.LY, Firebase, Unsplash photographers, and every open-source contributor powering this site.
                <a href="attributions.html">See full acknowledgements</a>.
            </p>
        </div>
    </footer>
</body>
</html>