<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Primary Meta Tags -->
    <title>Convert PDF to Word Document Online Free - Edit PDF Files Instantly | EasyJPGToPDF</title>
    <meta name="title" content="Convert PDF to Word Document Online Free - Edit PDF Files Instantly">
    <meta name="description" content="Free online PDF to Word converter. Convert PDF files to editable DOCX format instantly. Support for Hindi, Unicode fonts, scanned PDFs with OCR. No registration required.">
    <meta name="keywords" content="pdf to word converter, convert pdf to word, pdf to docx, edit pdf online, pdf converter free, pdf to word online, convert pdf file to word, pdf to word converter hindi, pdf to word converter unicode, pdf to word scanner">
    <meta name="author" content="EasyJPGToPDF">
    <meta name="robots" content="index, follow">
    <meta name="language" content="English">
    <meta name="revisit-after" content="7 days">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://easyjpgtopdf.com/pdf-to-word-converter">
    <meta property="og:title" content="Convert PDF to Word Document Online Free - Edit PDF Files Instantly">
    <meta property="og:description" content="Free online PDF to Word converter. Convert PDF files to editable DOCX format instantly. Support for Hindi, Unicode fonts, scanned PDFs with OCR.">
    <meta property="og:image" content="https://easyjpgtopdf.com/assets/pdf-to-word-og.jpg">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://easyjpgtopdf.com/pdf-to-word-converter">
    <meta property="twitter:title" content="Convert PDF to Word Document Online Free">
    <meta property="twitter:description" content="Free online PDF to Word converter. Convert PDF files to editable DOCX format instantly.">
    <meta property="twitter:image" content="https://easyjpgtopdf.com/assets/pdf-to-word-twitter.jpg">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://easyjpgtopdf.com/pdf-to-word-converter">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    
    <!-- Header and Footer CSS -->
    <link rel="stylesheet" href="/css/header.css">
    <link rel="stylesheet" href="/css/footer.css">
    <link rel="stylesheet" href="/css/theme-modern.css">
    
    <!-- Fonts -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- PDF.js for preview -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';</script>
    
    <!-- FREE Browser-Based Converter (Zero Server Costs) -->
    <script src="/js/pdf-to-word-free-browser.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        :root {
            --primary: #4361ee;
            --secondary: #3a0ca3;
            --accent: #4cc9f0;
            --light: #f8f9fa;
            --dark: #0f172a;
            --muted: #6b7280;
            --surface: #ffffff;
            --border: #e5e7eb;
            --success: #0f9d58;
            --danger: #dc2626;
        }
        body {
            background: #f5f7ff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            color: var(--dark);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1320px;
            margin: 0 auto;
            padding: 0 24px;
            width: 100%;
        }

        .nav-links > a {
            color: var(--dark);
            text-decoration: none;
            font-weight: 500;
        }
        .nav-links > a.active,
        .nav-links > a:hover {
            color: var(--primary);
        }
        
        .dropdown > a {
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: 600;
            color: var(--dark);
            text-decoration: none;
        }
        
        .dropdown-content a {
            display: block;
            padding: 10px 18px;
            color: var(--dark);
            text-decoration: none;
            font-weight: 500;
        }
        .dropdown-content a:hover {
            background: #eef2ff;
            color: var(--primary);
        }
        .dropdown:hover 
        .auth-buttons { display: flex; gap: 10px; }
        .auth-btn {
            padding: 8px 16px;
            border-radius: 24px;
            border: 1px solid var(--primary);
            color: var(--primary);
            font-weight: 600;
            text-decoration: none;
        }
        .auth-btn.signup { background: var(--primary); color: #fff; }

        .hero {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: #fff;
            padding: 48px 0;
            text-align: center;
        }
        .hero h1 { font-size: 2.5rem; margin-bottom: 10px; }
        .hero p { color: rgba(255,255,255,0.86); max-width: 720px; margin: 0 auto; }

        main { flex: 1; padding: 40px 0 70px; }
        .workspace {
            display: grid;
            grid-template-columns: minmax(0, 1.1fr) minmax(0, 0.9fr);
            gap: 24px;
            align-items: flex-start;
        }
        .panel {
            background: #fff;
            border-radius: 18px;
            padding: 24px;
            box-shadow: 0 16px 40px rgba(15,23,42,0.1);
            border: 1px solid rgba(67,97,238,0.1);
        }
        .preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 14px;
            margin-top: 18px;
        }
        .preview-item {
            position: relative;
            border: 2px solid var(--border);
            border-radius: 14px;
            overflow: hidden;
            aspect-ratio: 3/4;
            background: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
        .preview-item.selected {
            border-color: var(--primary);
            box-shadow: 0 12px 30px rgba(67,97,238,0.2);
        }
        .preview-item canvas { width: 100%; height: 100%; object-fit: contain; }
        .check-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 26px;
            height: 26px;
            border-radius: 999px;
            background: var(--primary);
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            box-shadow: 0 6px 18px rgba(67,97,238,0.35);
        }
        .right-panel { display: flex; flex-direction: column; gap: 18px; position: sticky; top: 96px; }
        .section-title { font-size: 1.05rem; font-weight: 700; color: var(--primary); margin-bottom: 12px; }
        .option-card {
            border: 1px dashed rgba(67,97,238,0.25);
            border-radius: 14px;
            padding: 16px;
            background: #fbfcff;
            display: grid;
            gap: 12px;
        }
        .option-row { display: flex; flex-wrap: wrap; gap: 12px; align-items: center; }
        .option-row input[type="number"],
        .option-row input[type="text"] {
            padding: 10px 14px;
            border-radius: 10px;
            border: 1px solid var(--border);
            min-width: 160px;
        }
        .muted { color: var(--muted); font-size: 0.92rem; }
        .badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 999px;
            background: rgba(67,97,238,0.12);
            color: var(--primary);
            font-weight: 600;
            font-size: 0.85rem;
        }
        .convert-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 6px;
        }
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            border-radius: 28px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: #fff;
            box-shadow: 0 16px 32px rgba(67,97,238,0.22);
            transition: transform 0.2s ease;
        }
        .btn.secondary {
            background: #fff;
            color: var(--primary);
            border: 1px solid var(--primary);
            box-shadow: none;
        }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; box-shadow: none; }
        .btn:hover:not(:disabled) { transform: translateY(-2px); }
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--success);
            color: #fff;
            padding: 14px 20px;
            border-radius: 12px;
            box-shadow: 0 18px 40px rgba(15,23,42,0.18);
            display: none;
            align-items: center;
            gap: 10px;
            font-weight: 600;
        }
        .toast.error { background: var(--danger); }
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin: 18px 0;
            display: none;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            width: 0%;
            transition: width 0.3s;
        }
        .status {
            padding: 12px 16px;
            border-radius: 10px;
            margin: 12px 0;
            display: none;
            font-size: 0.92rem;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .download-card {
            background: #fbfcff;
            border: 1px dashed rgba(67,97,238,0.25);
            border-radius: 14px;
            padding: 16px;
            margin-top: 12px;
        }
        .download-card.recommended {
            border-color: var(--success);
            background: #f0fff4;
        }
        .method-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 12px;
            border-radius: 999px;
            background: rgba(67,97,238,0.12);
            color: var(--primary);
            font-weight: 600;
            font-size: 0.85rem;
            margin-bottom: 8px;
        }
        .method-badge.libreoffice {
            background: rgba(0,123,255,0.12);
            color: #007bff;
        }
        .method-badge.docai {
            background: rgba(111,66,193,0.12);
            color: #6f42c1;
        }
        .download-link {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-top: 12px;
            padding: 12px 20px;
            background: var(--success);
            color: white;
            text-decoration: none;
            border-radius: 28px;
            font-weight: 600;
            width: 100%;
            transition: transform 0.2s ease;
        }
        .download-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(15,157,88,0.3);
        }
        @media (max-width: 1080px) {
            .workspace { grid-template-columns: 1fr; }
            .right-panel { position: static; }
        }
    </style>
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebPage",
      "name": "Convert PDF to Word Document Online Free - Edit PDF Files Instantly",
      "description": "Free online PDF to Word converter. Convert PDF files to editable DOCX format instantly. Support for Hindi, Unicode fonts, scanned PDFs with OCR.",
      "url": "https://easyjpgtopdf.com/pdf-to-word-converter",
      "inLanguage": "en-US",
      "isPartOf": {
        "@type": "WebSite",
        "name": "easyjpgtopdf",
        "url": "https://easyjpgtopdf.com"
      },
      "publisher": {
        "@type": "Organization",
        "name": "easyjpgtopdf",
        "url": "https://easyjpgtopdf.com"
      }
    }
    </script>
</head>
<body>
    <!-- Account Section (Above Header) -->
    <div id="account-section" class="account-section" style="display: none;"></div>
    
    <!-- Global Header Placeholder -->
    <div id="global-header-placeholder"></div>

    <nav aria-label="Breadcrumb" style="padding: 15px 0; background: #f8f9ff; border-bottom: 1px solid #e2e6ff;">
        <div class="container" style="max-width: 1200px; margin: 0 auto; padding: 0 24px;">
            <ol style="list-style: none; display: flex; flex-wrap: wrap; gap: 10px; margin: 0; padding: 0; align-items: center;">
                <li><a href="/" style="color: #4361ee; text-decoration: none; font-weight: 500; transition: color 0.3s;" onmouseover="this.style.color='#3a0ca3'" onmouseout="this.style.color='#4361ee'">Home</a></li>
                <li><span style="margin: 0 8px; color: #9ca3af;">|</span></li>
                <li><a href="/pdf-to-word" style="color: #56607a; font-weight: 500; text-decoration: none; transition: color 0.3s;" onmouseover="this.style.color='#4361ee'" onmouseout="this.style.color='#56607a'">PDF to Word</a></li>
            </ol>
        </div>
    </nav>

    <section class="hero">
        <div class="container">
            <span class="badge"><i class="fas fa-file-word"></i> Step 2 · Preview & convert</span>
            <h1>PDF to Word Converter - Convert PDF to DOCX Online Free</h1>
            <p>Preview your PDF and convert to editable Word documents. Nothing leaves your browser.</p>
        </div>
    </section>

    <main>
        <div class="container workspace">
            <!-- Left Panel: PDF Preview Grid -->
            <div class="panel">
                <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
                    <div>
                        <h2>PDF Preview</h2>
                        <p class="muted">Click on thumbnails to navigate through pages.</p>
                    </div>
                    <div class="badge" id="currentFile">Current file: <span id="pdfName">Loading…</span></div>
                </div>
                <div class="preview-grid" id="previewGrid"></div>
                <div class="option-row" style="justify-content:flex-end;margin-top:16px">
                    <button class="btn secondary" id="selectAll"><i class="fas fa-check-double"></i> Select all</button>
                    <button class="btn secondary" id="clearSelection"><i class="fas fa-eraser"></i> Clear</button>
                </div>
            </div>

            <!-- Right Panel: Conversion Options -->
            <div class="right-panel">
                <div class="panel option-card">
                    <div>
                        <h3 class="section-title"><i class="fas fa-file-word"></i> Conversion options</h3>
                        <p class="muted">Convert your PDF to Word format with high accuracy.</p>
                    </div>
                    
                    <div class="progress-bar" id="progressBar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    
                    <div class="status" id="status"></div>
                    
                    <div class="convert-actions">
                        <button class="btn" id="convertBtn" disabled>
                            <i class="fas fa-file-word"></i> Convert to Word
                        </button>
                        <button class="btn secondary" id="backBtn">
                            <i class="fas fa-arrow-left"></i> Back
                        </button>
                    </div>
                    
                    <!-- Download Cards -->
                    <div id="resultsSection" style="display: none;">
                        <div class="download-card recommended" id="primaryCard">
                            <h3 style="font-size: 1rem; font-weight: 700; color: var(--primary); margin-bottom: 8px;">
                                <i class="fas fa-star"></i> Recommended Version
                            </h3>
                            <span class="method-badge" id="primaryMethod"></span>
                            <p class="muted" style="margin: 8px 0;">Best conversion quality</p>
                            <a href="#" id="primaryDownload" class="download-link" download>
                                <i class="fas fa-download"></i> Download Recommended
                            </a>
                        </div>
                        
                        <div class="download-card" id="altCard" style="display: none; margin-top: 12px;">
                            <h3 style="font-size: 1rem; font-weight: 700; color: var(--primary); margin-bottom: 8px;">
                                <i class="fas fa-adjust"></i> Alternative Version
                            </h3>
                            <span class="method-badge" id="altMethod"></span>
                            <p class="muted" style="margin: 8px 0;">Alternative conversion method</p>
                            <a href="#" id="altDownload" class="download-link" download style="background: #6c757d;">
                                <i class="fas fa-download"></i> Download Alternative
                            </a>
                        </div>
                    </div>
                </div>
                
                <div class="panel option-card" style="gap:10px">
                    <h3 class="section-title"><i class="fas fa-lightbulb"></i> Tips</h3>
                    <ul style="list-style:none;display:grid;gap:8px;color:var(--muted);font-size:0.93rem;padding-left:0">
                        <li><i class="fas fa-check-circle" style="color:var(--primary);"></i> Text-based PDFs convert with perfect quality.</li>
                        <li><i class="fas fa-check-circle" style="color:var(--primary);"></i> Scanned PDFs use advanced OCR technology.</li>
                        <li><i class="fas fa-check-circle" style="color:var(--primary);"></i> Supports Hindi, Unicode, and international fonts.</li>
                    </ul>
                    
                    <div style="margin-top:16px;padding-top:16px;border-top:1px solid var(--border);">
                        <h4 style="font-size:0.95rem;font-weight:600;color:var(--text);margin-bottom:10px;display:flex;align-items:center;gap:6px;">
                            <i class="fas fa-info-circle" style="color:var(--primary);"></i> Quota Limits
                        </h4>
                        <div style="display:grid;gap:10px;font-size:0.88rem;">
                            <div style="background:linear-gradient(135deg,#f0f7ff,#e8f4fd);padding:10px;border-radius:6px;border-left:3px solid #4CAF50;">
                                <div style="font-weight:600;color:#2c5f2d;margin-bottom:4px;">
                                    <i class="fas fa-user" style="margin-right:6px;"></i>Free Tier (Without Sign In Only)
                                </div>
                                <div style="color:#555;line-height:1.6;">
                                    • Maximum <strong>10 pages/day</strong> text conversion<br>
                                    • Maximum <strong>3 pages/day</strong> OCR conversion<br>
                                    • Maximum <strong>10MB</strong> file size
                                </div>
                            </div>
                            <div style="background:linear-gradient(135deg,#fff8e1,#fff3c4);padding:10px;border-radius:6px;border-left:3px solid #FF9800;">
                                <div style="font-weight:600;color:#e65100;margin-bottom:4px;">
                                    <i class="fas fa-crown" style="margin-right:6px;"></i>Logged-In Users (Credits Only)
                                </div>
                                <div style="color:#555;line-height:1.6;">
                                    • <strong>Unlimited conversions</strong> (based on credits)<br>
                                    • Maximum <strong>50MB</strong> file size<br>
                                    • OCR support for scanned PDFs<br>
                                    • Cost: <strong>1 credit/page</strong> (text) or <strong>1.5 credits/page</strong> (OCR)
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <i class="fas fa-check-circle"></i>
        <span id="toastMessage">Conversion successful</span>
    </div>

    <!-- SSL Security Badge -->
    <div style="margin: 40px 0; padding: 20px; background: white; border-radius: 16px; text-align: center; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
        <div style="display: flex; align-items: center; justify-content: center; gap: 15px; flex-wrap: wrap;">
            <i class="fas fa-lock" style="font-size: 2rem; color: #4361ee;"></i>
            <div>
                <h3 style="font-size: 1.3rem; color: #0b1630; margin-bottom: 5px;">SSL Secured</h3>
                <p style="color: #56607a; font-size: 0.95rem;">Your files are encrypted and secure</p>
            </div>
        </div>
    </div>

    <!-- Global Footer Placeholder -->
    <div id="global-footer-placeholder"></div>

    <script>
        // Set PDF.js worker
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
        
        const API_BASE_URL = 'https://pdf-to-word-converter-iwumaktavq-uc.a.run.app';
        
        const previewGrid = document.getElementById('previewGrid');
        const pdfName = document.getElementById('pdfName');
        const convertBtn = document.getElementById('convertBtn');
        const progressBar = document.getElementById('progressBar');
        const progressFill = document.getElementById('progressFill');
        const status = document.getElementById('status');
        const resultsSection = document.getElementById('resultsSection');
        const primaryCard = document.getElementById('primaryCard');
        const altCard = document.getElementById('altCard');
        const primaryDownload = document.getElementById('primaryDownload');
        const altDownload = document.getElementById('altDownload');
        const primaryMethod = document.getElementById('primaryMethod');
        const altMethod = document.getElementById('altMethod');
        const toast = document.getElementById('toast');
        const toastMessage = document.getElementById('toastMessage');
        const selectAllBtn = document.getElementById('selectAll');
        const clearBtn = document.getElementById('clearSelection');
        const backBtn = document.getElementById('backBtn');
        
        let currentFile = null;
        let pdfDoc = null;
        let currentPageNum = 1;
        let totalPages = 0;
        let selectedPages = new Set();
        
        function showToast(message, isError) {
            toastMessage.textContent = message;
            toast.className = 'toast' + (isError ? ' error' : '');
            toast.style.display = 'flex';
            setTimeout(() => { toast.style.display = 'none'; }, 3000);
        }
        
        function showStatus(message, type) {
            status.textContent = message;
            status.className = `status ${type}`;
            status.style.display = 'block';
        }
        
        // Check if file was passed from previous page
        window.addEventListener('DOMContentLoaded', async () => {
            // Login NOT required - users can use free tier (10 pages, 20MB) without login
            // Login will only be prompted when free tier limits are exceeded or credits are needed
            console.log('Page loaded - Free tier available without login (10 pages, 20MB max)');
            
            // Load file from sessionStorage
            const storedFile = sessionStorage.getItem('pdfFile');
            if (storedFile) {
                try {
                    const fileData = JSON.parse(storedFile);
                    // Recreate file object from stored data
                    const byteCharacters = atob(fileData.data);
                    const byteNumbers = new Array(byteCharacters.length);
                    for (let i = 0; i < byteCharacters.length; i++) {
                        byteNumbers[i] = byteCharacters.charCodeAt(i);
                    }
                    const byteArray = new Uint8Array(byteNumbers);
                    const blob = new Blob([byteArray], { type: 'application/pdf' });
                    const file = new File([blob], fileData.name, { type: 'application/pdf' });
                    
                    await handleFile(file);
                    sessionStorage.removeItem('pdfFile');
                } catch (e) {
                    console.error('Error loading stored file:', e);
                    showStatus('Error loading file. Please upload again.', 'error');
                }
            }
        });
        
        async function handleFile(file) {
            if (!file.type.includes('pdf') && !file.name.toLowerCase().endsWith('.pdf')) {
                showStatus('Please select a PDF file', 'error');
                return;
            }
            
            if (file.size > 50 * 1024 * 1024) {
                showStatus('File is too large. Maximum size is 50MB', 'error');
                return;
            }
            
            currentFile = file;
            pdfName.textContent = file.name;
            convertBtn.disabled = false;
            resultsSection.style.display = 'none';
            
            // Load PDF for preview
            try {
                const arrayBuffer = await file.arrayBuffer();
                pdfDoc = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
                totalPages = pdfDoc.numPages;
                currentPageNum = 1;
                selectedPages = new Set(Array.from({length: totalPages}, (_,i) => i + 1));
                await renderPreview();
            } catch (error) {
                console.error('Error loading PDF:', error);
                showStatus('Error loading PDF preview', 'error');
            }
        }
        
        async function renderPreview() {
            previewGrid.innerHTML = '';
            for (let pageNum = 1; pageNum <= totalPages; pageNum++) {
                const page = await pdfDoc.getPage(pageNum);
                const viewport = page.getViewport({ scale: 0.35 });
                
                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d');
                canvas.height = Math.ceil(viewport.height);
                canvas.width = Math.ceil(viewport.width);
                
                await page.render({ canvasContext: context, viewport }).promise;
                
                const thumb = document.createElement('div');
                thumb.className = 'preview-item';
                if (selectedPages.has(pageNum)) {
                    thumb.classList.add('selected');
                    const badge = document.createElement('div');
                    badge.className = 'check-badge';
                    badge.innerHTML = '<i class="fas fa-check"></i>';
                    thumb.appendChild(badge);
                }
                thumb.dataset.page = pageNum;
                thumb.appendChild(canvas);
                
                thumb.addEventListener('click', () => {
                    if (selectedPages.has(pageNum)) {
                        selectedPages.delete(pageNum);
                    } else {
                        selectedPages.add(pageNum);
                    }
                    renderPreview();
                });
                
                previewGrid.appendChild(thumb);
            }
        }
        
        selectAllBtn.addEventListener('click', () => {
            selectedPages = new Set(Array.from({length: totalPages}, (_,i) => i + 1));
            renderPreview();
        });
        
        clearBtn.addEventListener('click', () => {
            selectedPages.clear();
            renderPreview();
        });
        
        backBtn.addEventListener('click', () => {
            window.location.href = '/pdf-to-word';
        });
        
        convertBtn.addEventListener('click', async () => {
            if (!currentFile) {
                showStatus('Please select a PDF file first', 'error');
                return;
            }
            
            // Check if user is logged in
            let authToken = null;
            try {
                const authModule = await import('/js/auth.js').catch(() => null);
                if (authModule && authModule.auth && authModule.auth.currentUser) {
                    authToken = await authModule.auth.currentUser.getIdToken();
                }
            } catch (e) {
                console.log('Auth check - proceeding as anonymous user (FREE browser-based conversion)');
            }
            
            // FREE VERSION: Anonymous users - browser-based conversion (zero server costs)
            if (!authToken) {
                console.log('FREE VERSION: Using browser-based conversion (no API calls)');
                
                // Check file size limit (10MB for free tier)
                const fileSizeMB = currentFile.size / (1024 * 1024);
                if (fileSizeMB > 10) {
                    showStatus('Free tier limit: Maximum 10MB file size. Please sign in for higher limits (50MB).', 'error');
                    showToast('File size exceeds free tier limit (10MB). Sign in for 50MB limit.', true);
                    setTimeout(() => {
                        if (confirm('File too large for free tier. Would you like to sign in?')) {
                            window.location.href = `/accounts.html#login?returnTo=${encodeURIComponent(window.location.href)}`;
                        }
                    }, 2000);
                    return;
                }
                
                // Check page limit (10 pages for free tier)
                if (!pdfDoc) {
                    try {
                        const arrayBuffer = await currentFile.arrayBuffer();
                        pdfDoc = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
                    } catch (e) {
                        showStatus('Error loading PDF', 'error');
                        return;
                    }
                }
                
                if (pdfDoc.numPages > 10) {
                    showStatus('Free tier limit: Maximum 10 pages. Please sign in for unlimited pages.', 'error');
                    showToast(`Your PDF has ${pdfDoc.numPages} pages. Free tier allows 10 pages max. Sign in for unlimited.`, true);
                    setTimeout(() => {
                        if (confirm('Page limit exceeded. Would you like to sign in?')) {
                            window.location.href = `/accounts.html#login?returnTo=${encodeURIComponent(window.location.href)}`;
                        }
                    }, 2000);
                    return;
                }
                
                // Use browser-based conversion (FREE - zero server costs)
                await convertToWordBrowser();
                return;
            }
            
            // PREMIUM VERSION: Logged-in users - use API (existing premium pipeline)
            console.log('PREMIUM VERSION: Using API conversion (credits-based)');
            await convertToWord();
        });
        
        /**
         * FREE VERSION: Browser-based conversion (zero server costs)
         */
        async function convertToWordBrowser() {
            if (!currentFile || !pdfDoc) {
                showStatus('Please select a PDF file first', 'error');
                return;
            }
            
            convertBtn.disabled = true;
            progressBar.style.display = 'block';
            progressFill.style.width = '0%';
            showStatus('Starting browser-based conversion...', 'info');
            
            try {
                // Check if browser converter is available
                if (typeof convertPdfToWordBrowser === 'undefined') {
                    throw new Error('Browser converter not loaded. Please refresh the page.');
                }
                
                progressFill.style.width = '5%';
                showStatus('Converting PDF to Word (browser-based, free)...', 'info');
                
                // Use browser-based conversion
                const progressCallback = (percent, message) => {
                    progressFill.style.width = `${percent}%`;
                    showStatus(message, 'info');
                };
                
                const blob = await convertPdfToWordBrowser(pdfDoc, progressCallback);
                
                // Create download link
                const url = URL.createObjectURL(blob);
                primaryDownload.href = url;
                primaryDownload.download = (currentFile.name || 'converted').replace(/\.pdf$/i, '.docx');
                primaryMethod.textContent = 'Browser-Based (Free)';
                primaryMethod.className = 'method-badge libreoffice';
                
                // Hide alternative card
                altCard.style.display = 'none';
                
                progressFill.style.width = '100%';
                showStatus('Conversion successful! (Browser-based, zero server costs)', 'success');
                resultsSection.style.display = 'block';
                showToast('Conversion successful! Download your Word file.', false);
                
                // Auto-trigger download
                setTimeout(() => {
                    primaryDownload.click();
                }, 500);
                
                setTimeout(() => {
                    progressBar.style.display = 'none';
                }, 2000);
                
            } catch (error) {
                const errorMsg = error.message || 'Browser-based conversion failed. Please try again.';
                showStatus(`Error: ${errorMsg}`, 'error');
                showToast(errorMsg, true);
                console.error('Browser conversion error:', error);
                progressBar.style.display = 'none';
                progressFill.style.width = '0%';
                resultsSection.style.display = 'none';
                
                // If visual PDF detected, suggest premium
                if (errorMsg.includes('complex visual layout') || errorMsg.includes('Premium')) {
                    setTimeout(() => {
                        if (confirm('This PDF requires premium conversion. Would you like to sign in for premium features?')) {
                            window.location.href = `/accounts.html#login?returnTo=${encodeURIComponent(window.location.href)}`;
                        }
                    }, 2000);
                }
            } finally {
                convertBtn.disabled = false;
            }
        }
        
        /**
         * PREMIUM VERSION: Server-based conversion (credits-based)
         */
        async function convertToWord() {
            if (!currentFile) {
                showStatus('Please select a PDF file first', 'error');
                return;
            }
            
            convertBtn.disabled = true;
            progressBar.style.display = 'block';
            progressFill.style.width = '10%';
            showStatus('Uploading PDF file...', 'info');
            
            try {
                const formData = new FormData();
                formData.append('file', currentFile);
                
                // Try to get auth token for credit checking (optional)
                let authToken = null;
                try {
                    // Import auth if available
                    const authModule = await import('/js/auth.js').catch(() => null);
                    if (authModule && authModule.auth) {
                        const auth = authModule.auth;
                        if (auth && auth.currentUser) {
                            authToken = await auth.currentUser.getIdToken();
                        }
                    } else if (authModule && authModule.default) {
                        const auth = authModule.default;
                        if (auth && auth.currentUser) {
                            authToken = await auth.currentUser.getIdToken();
                        }
                    }
                } catch (e) {
                    // No auth token available - conversion will still work
                    console.log('Auth token not available, proceeding without auth header');
                }
                
                const headers = {};
                if (authToken) {
                    headers['Authorization'] = `Bearer ${authToken}`;
                }
                
                const response = await fetch(`${API_BASE_URL}/api/convert/pdf-to-word`, {
                    method: 'POST',
                    body: formData,
                    mode: 'cors',
                    credentials: 'omit',
                    headers: headers
                });
                
                progressFill.style.width = '40%';
                showStatus('Converting on server...', 'info');
                
                if (!response.ok) {
                    let errorData;
                    try {
                        errorData = await response.json();
                    } catch {
                        errorData = { detail: `Server error: ${response.status} ${response.statusText}` };
                    }
                    
                    // Handle insufficient credits error (logged-in users)
                    if (response.status === 402 && errorData.error === 'NOT_ENOUGH_CREDITS') {
                        const errorMsg = `Insufficient credits. Required: ${errorData.required || 'N/A'}, Available: ${errorData.available || 0}. Please buy credits to continue.`;
                        showStatus(errorMsg, 'error');
                        showToast(errorMsg, true);
                        // Optionally redirect to pricing page
                        setTimeout(() => {
                            if (confirm('Would you like to purchase credits now?')) {
                                window.location.href = '/pricing.html#credits';
                            }
                        }, 2000);
                        throw new Error(errorMsg);
                    }
                    
                    // Handle free tier limit exceeded error (anonymous users)
                    if (response.status === 403 && (
                        errorData.error === 'FREE_TIER_LIMIT_EXCEEDED' ||
                        errorData.error === 'FREE_TIER_SIZE_LIMIT_EXCEEDED' ||
                        errorData.detail?.error === 'FREE_TIER_LIMIT_EXCEEDED' ||
                        errorData.detail?.error === 'FREE_TIER_SIZE_LIMIT_EXCEEDED'
                    )) {
                        const errorDetail = errorData.detail || errorData;
                        const errorMsg = errorDetail.message || errorData.message || errorDetail.error || 
                            `Free tier limit exceeded. Maximum ${errorDetail.limit || 10} pages, ${errorDetail.size_limit || 20}MB. Please sign in for higher limits.`;
                        showStatus(errorMsg, 'error');
                        showToast(errorMsg, true);
                        // Prompt user to login
                        setTimeout(() => {
                            if (confirm('Free tier limit reached. Would you like to login and buy credits to continue?')) {
                                const returnUrl = encodeURIComponent(window.location.href);
                                window.location.href = `/accounts.html#login?returnTo=${returnUrl}`;
                            }
                        }, 2000);
                        throw new Error(errorMsg);
                    }
                    
                    const errorMsg = errorData.detail?.message || errorData.error || errorData.detail?.error || errorData.detail || errorData.message || `Server error: ${response.status} (check logs)`;
                    throw new Error(errorMsg);
                }
                
                progressFill.style.width = '70%';
                const result = await response.json();
                
                if (result.status !== 'success') {
                    throw new Error(result.error || 'Conversion failed');
                }
                
                progressFill.style.width = '90%';
                showStatus('Preparing download...', 'info');
                
                // Handle download URL
                const downloadUrl = result.primary_download_url || result.download_url;
                if (!downloadUrl) {
                    throw new Error('No download URL received from server');
                }
                
                primaryDownload.href = downloadUrl;
                primaryDownload.download = (currentFile.name || 'converted').replace(/\.pdf$/i, '-primary.docx');
                
                // Determine method label
                const primaryMethodName = result.primary_method || result.engine || (result.used_docai ? 'docai' : 'libreoffice');
                const primaryMethodLabel = primaryMethodName === 'docai' ? 'AI-Powered OCR' : 'Direct Conversion';
                primaryMethod.textContent = primaryMethodLabel;
                primaryMethod.className = `method-badge ${primaryMethodName}`;
                
                // Handle alternative download if available
                if (result.alt_download_url) {
                    altCard.style.display = 'block';
                    altDownload.href = result.alt_download_url;
                    altDownload.download = (currentFile.name || 'converted').replace(/\.pdf$/i, '-alternative.docx');
                    const altMethodName = result.alt_method || 'libreoffice';
                    const altMethodLabel = altMethodName === 'docai' ? 'AI-Powered OCR' : 'Direct Conversion';
                    altMethod.textContent = altMethodLabel;
                    altMethod.className = `method-badge ${altMethodName}`;
                } else {
                    altCard.style.display = 'none';
                }
                
                progressFill.style.width = '100%';
                showStatus('Conversion successful!', 'success');
                resultsSection.style.display = 'block';
                showToast('Conversion successful! Download your Word file.', false);
                
                // Auto-trigger download of primary file
                setTimeout(() => {
                    primaryDownload.click();
                }, 500);
                
                setTimeout(() => {
                    progressBar.style.display = 'none';
                }, 2000);
                
            } catch (error) {
                const errorMsg = error.message || 'Conversion failed. Please try again.';
                showStatus(`Error: ${errorMsg}`, 'error');
                showToast(errorMsg, true);
                console.error('Conversion error:', error);
                progressBar.style.display = 'none';
                progressFill.style.width = '0%';
                resultsSection.style.display = 'none';
            } finally {
                convertBtn.disabled = false;
            }
        }
    </script>
    
    <script src="/js/global-components.js"></script>
    <script type="module" src="/js/auth.js"></script>
    <script type="module" src="/js/pdf-word-credit-modal.js"></script>
    <script>
    // Ensure header loads - multiple attempts to guarantee it works
    (function() {
        function tryLoadHeader() {
            if (typeof loadGlobalHeader === 'function') {
                try {
                    loadGlobalHeader();
                    return true;
                } catch (e) {
                    console.error('Error calling loadGlobalHeader:', e);
                }
            }
            return false;
        }
        
        // Try immediately if script already loaded
        if (document.readyState === 'complete' || document.readyState === 'interactive') {
            if (!tryLoadHeader()) {
                var attempts = 0;
                var maxAttempts = 60;
                var checkHeader = setInterval(function() {
                    attempts++;
                    if (tryLoadHeader() || attempts >= maxAttempts) {
                        clearInterval(checkHeader);
                    }
                }, 50);
            }
        } else {
            document.addEventListener('DOMContentLoaded', function() {
                if (!tryLoadHeader()) {
                    var attempts = 0;
                    var maxAttempts = 40;
                    var checkHeader = setInterval(function() {
                        attempts++;
                        if (tryLoadHeader() || attempts >= maxAttempts) {
                            clearInterval(checkHeader);
                        }
                    }, 50);
                }
            });
        }
        
        window.addEventListener('load', function() {
            tryLoadHeader();
        });
    })();
    </script>
</body>
</html>
