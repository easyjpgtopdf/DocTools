<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Image Editor - AI Powered</title>
    <link rel="stylesheet" href="css/header.css" onerror="this.remove()">
    <link rel="stylesheet" href="css/footer.css" onerror="this.remove()">
    <!-- Font Awesome with fallback - Errors suppressed -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" crossorigin="anonymous" onerror="this.remove()">
    
    <style>
        /* Hide icon font errors */
        .fas, .far, .fab {
            font-family: "Font Awesome 6 Free", "Segoe UI Symbol", sans-serif !important;
        }
        
        /* Fallback when Font Awesome fails */
        i[class*="fa-"]::before {
            font-style: normal;
        }
    </style>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: #1e1e1e;
            color: #e0e0e0;
            overflow: hidden;
        }

        /* PHOTOSHOP CC2024 STYLE - DARK THEME */
        .editor-app {
            display: flex;
            flex-direction: column;
            height: 100vh;
            background: #2b2b2b;
        }

        /* TOP TOOLBAR - Like Photoshop */
        .top-toolbar {
            background: linear-gradient(to bottom, #3a3a3a, #2b2b2b);
            border-bottom: 1px solid #1a1a1a;
            padding: 8px 15px;
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        .toolbar-section {
            position: relative;
            display: inline-block;
        }

        .toolbar-btn {
            background: transparent;
            border: 1px solid transparent;
            color: #e0e0e0;
            padding: 6px 12px;
            cursor: pointer;
            font-size: 12px;
            border-radius: 3px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .toolbar-btn:hover {
            background: #4a4a4a;
            border-color: #5a5a5a;
        }

        .toolbar-btn.active {
            background: #0078d4;
            border-color: #0078d4;
        }

        .dropdown-menu {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            background: #2b2b2b;
            border: 1px solid #1a1a1a;
            box-shadow: 0 4px 12px rgba(0,0,0,0.5);
            min-width: 220px;
            z-index: 1000;
            margin-top: 2px;
            border-radius: 4px;
        }

        .toolbar-section:hover .dropdown-menu {
            display: block;
        }

        .dropdown-item {
            padding: 8px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #e0e0e0;
            font-size: 13px;
            border-bottom: 1px solid #1a1a1a;
        }

        .dropdown-item:last-child {
            border-bottom: none;
        }

        .dropdown-item:hover {
            background: #4a4a4a;
        }

        .dropdown-item i {
            width: 18px;
            color: #0078d4;
        }

        /* MAIN WORKSPACE - 3 PANELS */
        .workspace {
            display: grid;
            grid-template-columns: 45px 1fr 300px;
            flex: 1;
            overflow: hidden;
        }

        /* LEFT PANEL - TOOL ICONS */
        .tools-panel {
            background: #2b2b2b;
            border-right: 1px solid #1a1a1a;
            padding: 5px 2px;
            display: flex;
            flex-direction: column;
            gap: 3px;
            overflow-y: auto;
        }

        .tool-icon {
            width: 40px;
            height: 40px;
            background: transparent;
            border: 1px solid transparent;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: #e0e0e0;
            font-size: 16px;
            transition: all 0.2s;
        }

        .tool-icon:hover {
            background: #3a3a3a;
            border-color: #4a4a4a;
        }

        .tool-icon.active {
            background: #0078d4;
            border-color: #0078d4;
        }

        /* CENTER PANEL - CANVAS */
        .canvas-panel {
            background: #1e1e1e;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: auto;
        }

        #mainCanvas {
            max-width: 100%;
            max-height: 100%;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            background: white;
        }

        .canvas-info {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(0,0,0,0.7);
            padding: 5px 10px;
            border-radius: 3px;
            font-size: 11px;
            color: #e0e0e0;
        }

        /* RIGHT PANEL - LAYERS & PROPERTIES */
        .properties-panel {
            background: #2b2b2b;
            border-left: 1px solid #1a1a1a;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .panel-section {
            border-bottom: 1px solid #1a1a1a;
            padding: 10px;
        }

        .panel-title {
            font-weight: bold;
            font-size: 12px;
            color: #e0e0e0;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .layer-item {
            background: #1e1e1e;
            padding: 8px;
            margin-bottom: 5px;
            border-radius: 3px;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            border: 1px solid transparent;
        }

        .layer-item:hover {
            border-color: #4a4a4a;
        }

        .layer-item.active {
            border-color: #0078d4;
            background: #2a4a6a;
        }

        .layer-thumb {
            width: 40px;
            height: 40px;
            background: white;
            border: 1px solid #1a1a1a;
            border-radius: 2px;
        }

        .layer-info {
            flex: 1;
        }

        .layer-name {
            font-size: 12px;
            color: #e0e0e0;
        }

        .property-control {
            margin-bottom: 12px;
        }

        .property-label {
            font-size: 11px;
            color: #b0b0b0;
            margin-bottom: 5px;
            display: block;
        }

        .property-input {
            width: 100%;
            background: #1e1e1e;
            border: 1px solid #3a3a3a;
            color: #e0e0e0;
            padding: 6px;
            border-radius: 3px;
            font-size: 12px;
        }

        .property-slider {
            width: 100%;
            height: 4px;
            background: #1e1e1e;
            border-radius: 2px;
            outline: none;
            -webkit-appearance: none;
        }

        .property-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 12px;
            height: 12px;
            background: #0078d4;
            border-radius: 50%;
            cursor: pointer;
        }

        select.property-input {
            cursor: pointer;
        }

        /* UPLOAD OVERLAY */
        .upload-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }

        .upload-box {
            background: #2b2b2b;
            padding: 40px;
            border-radius: 8px;
            text-align: center;
            border: 2px dashed #0078d4;
            max-width: 500px;
        }

        .upload-box h2 {
            color: #e0e0e0;
            margin-bottom: 20px;
        }

        .upload-box p {
            color: #b0b0b0;
            margin-bottom: 20px;
        }

        .btn-upload {
            background: #0078d4;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .btn-upload:hover {
            background: #005a9e;
            transform: scale(1.05);
        }

        /* LOADING INDICATOR */
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #3a3a3a;
            border-top-color: #0078d4;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .hidden {
            display: none;
        }

        /* TOOL OVERLAY */
        .tool-overlay {
            display: none !important; /* DISABLED - Popup removed */
        }

        .tool-message {
            background: linear-gradient(135deg, #2b2b2b 0%, #1e1e1e 100%);
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            border: 2px solid #0078d4;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            max-width: 400px;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        #toolTitle {
            color: #0078d4;
            font-size: 20px;
            margin-bottom: 15px;
            font-weight: bold;
        }

        #toolInstructions {
            color: #e0e0e0;
            margin-bottom: 20px;
            line-height: 1.6;
            font-size: 14px;
        }

        .tool-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .btn-apply, .btn-cancel {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-apply {
            background: linear-gradient(135deg, #4bb543 0%, #2d7a28 100%);
            color: white;
        }

        .btn-apply:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(75, 181, 67, 0.4);
        }

        .btn-cancel {
            background: linear-gradient(135deg, #dc3545 0%, #a02834 100%);
            color: white;
        }

        .btn-cancel:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.4);
        }

        /* MOBILE RESPONSIVE */
        @media (max-width: 768px) {
            body {
                overflow: auto;
            }

            .editor-app {
                height: auto;
                min-height: 100vh;
            }

            .top-toolbar {
                padding: 5px;
                gap: 3px;
                overflow-x: auto;
                flex-wrap: nowrap;
                -webkit-overflow-scrolling: touch;
            }

            .toolbar-btn {
                padding: 8px 10px;
                font-size: 11px;
                white-space: nowrap;
            }

            .toolbar-btn i {
                font-size: 14px;
            }

            .dropdown-menu {
                position: fixed;
                left: 50%;
                top: 50%;
                transform: translate(-50%, -50%);
                max-width: 90vw;
                max-height: 80vh;
                overflow-y: auto;
            }

            .workspace {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr auto;
                height: auto;
                min-height: calc(100vh - 120px);
            }
            
            .tools-panel {
                display: flex;
                flex-direction: row;
                overflow-x: auto;
                padding: 8px;
                border-right: none;
                border-bottom: 1px solid #1a1a1a;
                -webkit-overflow-scrolling: touch;
            }

            .tool-icon {
                width: 45px;
                height: 45px;
                flex-shrink: 0;
                margin-right: 5px;
            }

            .canvas-panel {
                order: 2;
                min-height: 400px;
                padding: 10px;
            }

            #mainCanvas {
                max-width: 100%;
                height: auto;
            }

            .canvas-info {
                font-size: 10px;
                padding: 3px 8px;
            }

            .properties-panel {
                order: 3;
                border-left: none;
                border-top: 1px solid #1a1a1a;
                max-height: 400px;
            }

            .panel-section {
                padding: 8px;
            }

            .panel-title {
                font-size: 11px;
            }

            .property-control {
                margin-bottom: 10px;
            }

            .property-label {
                font-size: 10px;
            }

            .property-input {
                padding: 5px;
                font-size: 11px;
            }

            .layer-item {
                padding: 6px;
            }

            .layer-thumb {
                width: 30px;
                height: 30px;
            }

            .layer-name {
                font-size: 11px;
            }

            .upload-box {
                padding: 20px;
                max-width: 90%;
            }

            .upload-box h2 {
                font-size: 18px;
            }

            .upload-box p {
                font-size: 13px;
            }

            /* Mobile touch optimization */
            .tool-icon, .toolbar-btn, .dropdown-item {
                -webkit-tap-highlight-color: rgba(0,120,212,0.3);
            }

            /* Hide some labels on mobile */
            .toolbar-btn span {
                display: none;
            }

            .toolbar-section:hover .dropdown-menu {
                display: none;
            }

            .toolbar-section.active .dropdown-menu {
                display: block;
            }
        }

        /* Tablet view */
        @media (min-width: 769px) and (max-width: 1024px) {
            .workspace {
                grid-template-columns: 45px 1fr 250px;
            }

            .tools-panel {
                padding: 5px 2px;
            }

            .tool-icon {
                width: 40px;
                height: 40px;
                font-size: 16px;
            }

            .properties-panel {
                width: 250px;
            }
        }

    </style>
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebPage",
      "name": "Professional Image Editor - AI Powered",
      "description": "Online PDF and image conversion tools",
      "url": "https://easyjpgtopdf.com/image-repair-editor.html",
      "inLanguage": "en-US",
      "isPartOf": {
        "@type": "WebSite",
        "name": "easyjpgtopdf",
        "url": "https://easyjpgtopdf.com"
      },
      "publisher": {
        "@type": "Organization",
        "name": "easyjpgtopdf",
        "url": "https://easyjpgtopdf.com"
      }
    }
    </script>
</head>
<body>

    <nav aria-label="Breadcrumb" style="padding: 15px 0; background: #f8f9ff; border-bottom: 1px solid #e2e6ff;">
        <div class="container" style="max-width: 1200px; margin: 0 auto; padding: 0 24px;">
            <ol style="list-style: none; display: flex; flex-wrap: wrap; gap: 10px; margin: 0; padding: 0; align-items: center;">
                <li><a href="index.html" style="color: #4361ee; text-decoration: none; font-weight: 500;">Home</a> <span style="margin: 0 8px; color: #9ca3af;">/</span></li>
                <li style="color: #56607a; font-weight: 500;">Image Repair Editor</li>
            </ol>
        </div>
    </nav>


    <!-- HEADER WILL BE INSERTED HERE -->
    <div id="header-placeholder"></div>

    <!-- MAIN EDITOR APP -->
    <div class="editor-app">
        
        <!-- TOP TOOLBAR -->
        <div class="top-toolbar">
            <!-- FILE MENU -->
            <div class="toolbar-section">
                <button class="toolbar-btn">
                    <i class="fas fa-file"></i> File
                </button>
                <div class="dropdown-menu">
                    <div class="dropdown-item" onclick="newImage()"><i class="fas fa-plus"></i> New</div>
                    <div class="dropdown-item" onclick="openImage()"><i class="fas fa-folder-open"></i> Open</div>
                    <div class="dropdown-item" onclick="saveImage()"><i class="fas fa-save"></i> Save</div>
                    <div class="dropdown-item" onclick="exportImage()"><i class="fas fa-file-export"></i> Export As...</div>
                </div>
            </div>

            <!-- EDIT MENU -->
            <div class="toolbar-section">
                <button class="toolbar-btn">
                    <i class="fas fa-edit"></i> Edit
                </button>
                <div class="dropdown-menu">
                    <div class="dropdown-item" onclick="undo()"><i class="fas fa-undo"></i> Undo</div>
                    <div class="dropdown-item" onclick="redo()"><i class="fas fa-redo"></i> Redo</div>
                    <div class="dropdown-item" onclick="cut()"><i class="fas fa-cut"></i> Cut</div>
                    <div class="dropdown-item" onclick="copy()"><i class="fas fa-copy"></i> Copy</div>
                    <div class="dropdown-item" onclick="paste()"><i class="fas fa-paste"></i> Paste</div>
                </div>
            </div>

            <!-- IMAGE MENU -->
            <div class="toolbar-section">
                <button class="toolbar-btn">
                    <i class="fas fa-image"></i> Image
                </button>
                <div class="dropdown-menu">
                    <div class="dropdown-item" onclick="resizeImage()"><i class="fas fa-expand-arrows-alt"></i> Resize</div>
                    <div class="dropdown-item" onclick="cropImage()"><i class="fas fa-crop"></i> Crop</div>
                    <div class="dropdown-item" onclick="rotateImage()"><i class="fas fa-redo"></i> Rotate</div>
                    <div class="dropdown-item" onclick="flipHorizontal()"><i class="fas fa-arrows-alt-h"></i> Flip Horizontal</div>
                    <div class="dropdown-item" onclick="flipVertical()"><i class="fas fa-arrows-alt-v"></i> Flip Vertical</div>
                </div>
            </div>

            <!-- FILTERS MENU -->
            <div class="toolbar-section">
                <button class="toolbar-btn">
                    <i class="fas fa-filter"></i> Filters
                </button>
                <div class="dropdown-menu">
                    <div class="dropdown-item" onclick="applyBlur()"><i class="fas fa-circle"></i> Blur</div>
                    <div class="dropdown-item" onclick="applySharpen()"><i class="fas fa-adjust"></i> Sharpen</div>
                    <div class="dropdown-item" onclick="applyGrayscale()"><i class="fas fa-palette"></i> Grayscale</div>
                    <div class="dropdown-item" onclick="applySepia()"><i class="fas fa-tint"></i> Sepia</div>
                    <div class="dropdown-item" onclick="applyInvert()"><i class="fas fa-adjust"></i> Invert</div>
                    <div class="dropdown-item" onclick="applyVintage()"><i class="fas fa-camera-retro"></i> Vintage</div>
                </div>
            </div>

            <!-- ADJUSTMENTS MENU -->
            <div class="toolbar-section">
                <button class="toolbar-btn">
                    <i class="fas fa-sliders-h"></i> Adjust
                </button>
                <div class="dropdown-menu">
                    <div class="dropdown-item" onclick="adjustBrightness()"><i class="fas fa-sun"></i> Brightness</div>
                    <div class="dropdown-item" onclick="adjustContrast()"><i class="fas fa-adjust"></i> Contrast</div>
                    <div class="dropdown-item" onclick="adjustSaturation()"><i class="fas fa-tint"></i> Saturation</div>
                    <div class="dropdown-item" onclick="adjustHue()"><i class="fas fa-palette"></i> Hue</div>
                    <div class="dropdown-item" onclick="autoEnhance()"><i class="fas fa-magic"></i> Auto Enhance</div>
                </div>
            </div>

            <!-- AI TOOLS MENU -->
            <div class="toolbar-section">
                <button class="toolbar-btn">
                    <i class="fas fa-brain"></i> AI Tools
                </button>
                <div class="dropdown-menu">
                    <div class="dropdown-item" onclick="aiUnblur()"><i class="fas fa-eye"></i> Unblur Image</div>
                    <div class="dropdown-item" onclick="aiDenoise()"><i class="fas fa-broom"></i> Noise Reduction</div>
                    <div class="dropdown-item" onclick="aiEnhance()"><i class="fas fa-magic"></i> AI Enhance</div>
                    <div class="dropdown-item" onclick="aiColorRestore()"><i class="fas fa-palette"></i> Color Restoration</div>
                    <div class="dropdown-item" onclick="aiScratchRemove()"><i class="fas fa-eraser"></i> Remove Scratches</div>
                    <div class="dropdown-item" onclick="aiUpscale()"><i class="fas fa-expand-arrows-alt"></i> AI Upscale</div>
                    <div class="dropdown-item" onclick="aiBackgroundRemove()"><i class="fas fa-user"></i> Remove Background</div>
                    <div class="dropdown-item" onclick="aiObjectRemove()"><i class="fas fa-trash"></i> Object Removal</div>
                </div>
            </div>

            <!-- LAYERS MENU -->
            <div class="toolbar-section">
                <button class="toolbar-btn">
                    <i class="fas fa-layer-group"></i> Layers
                </button>
                <div class="dropdown-menu">
                    <div class="dropdown-item" onclick="newLayer()"><i class="fas fa-plus"></i> New Layer</div>
                    <div class="dropdown-item" onclick="duplicateLayer()"><i class="fas fa-copy"></i> Duplicate Layer</div>
                    <div class="dropdown-item" onclick="mergeDown()"><i class="fas fa-compress"></i> Merge Down</div>
                    <div class="dropdown-item" onclick="flattenImage()"><i class="fas fa-layer-group"></i> Flatten Image</div>
                </div>
            </div>

            <!-- UTILITIES -->
            <div class="toolbar-section">
                <button class="toolbar-btn">
                    <i class="fas fa-tools"></i> Utilities
                </button>
                <div class="dropdown-menu">
                    <div class="dropdown-item" onclick="compress()"><i class="fas fa-compress-alt"></i> Compress</div>
                    <div class="dropdown-item" onclick="convertFormat()"><i class="fas fa-file-image"></i> Convert Format</div>
                    <div class="dropdown-item" onclick="addWatermark()"><i class="fas fa-copyright"></i> Watermark</div>
                    <div class="dropdown-item" onclick="borderTool()"><i class="fas fa-border-style"></i> Add Border</div>
                </div>
            </div>
        </div>

        <!-- MAIN WORKSPACE - 3 PANELS -->
        <div class="workspace">
            
            <!-- LEFT PANEL - TOOL ICONS -->
            <div class="tools-panel">
                <button class="tool-icon active" onclick="selectTool('move')" title="Move Tool (V)">
                    <i class="fas fa-arrows-alt"></i>
                </button>
                <button class="tool-icon" onclick="selectTool('select')" title="Selection (M)">
                    <i class="far fa-square"></i>
                </button>
                <button class="tool-icon" onclick="selectTool('lasso')" title="Lasso (L)">
                    <i class="fas fa-draw-polygon"></i>
                </button>
                <button class="tool-icon" onclick="selectTool('wand')" title="Magic Wand (W)">
                    <i class="fas fa-magic"></i>
                </button>
                <button class="tool-icon" onclick="selectTool('crop')" title="Crop (C)">
                    <i class="fas fa-crop"></i>
                </button>
                <button class="tool-icon" onclick="selectTool('eyedropper')" title="Eyedropper (I)">
                    <i class="fas fa-eye-dropper"></i>
                </button>
                <button class="tool-icon" onclick="selectTool('brush')" title="Brush (B)">
                    <i class="fas fa-paint-brush"></i>
                </button>
                <button class="tool-icon" onclick="selectTool('eraser')" title="Eraser (E)">
                    <i class="fas fa-eraser"></i>
                </button>
                <button class="tool-icon" onclick="selectTool('text')" title="Text (T)">
                    <i class="fas fa-font"></i>
                </button>
                <button class="tool-icon" onclick="selectTool('shape')" title="Shapes (U)">
                    <i class="fas fa-shapes"></i>
                </button>
                <button class="tool-icon" onclick="selectTool('clone')" title="Clone Stamp (S)">
                    <i class="fas fa-stamp"></i>
                </button>
                <button class="tool-icon" onclick="selectTool('blur')" title="Blur Tool">
                    <i class="fas fa-circle"></i>
                </button>
                <button class="tool-icon" onclick="selectTool('sharpen')" title="Sharpen Tool">
                    <i class="fas fa-adjust"></i>
                </button>
                <button class="tool-icon" onclick="selectTool('smudge')" title="Smudge Tool">
                    <i class="fas fa-hand-paper"></i>
                </button>
                <button class="tool-icon" onclick="selectTool('dodge')" title="Dodge Tool">
                    <i class="fas fa-sun"></i>
                </button>
                <button class="tool-icon" onclick="selectTool('burn')" title="Burn Tool">
                    <i class="fas fa-moon"></i>
                </button>
                
                <!-- DIVIDER -->
                <div style="width: 100%; height: 1px; background: #1a1a1a; margin: 10px 0;"></div>
                
                <!-- AI QUICK TOOLS -->
                <button class="tool-icon" onclick="aiUnblur()" title="AI Unblur" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                    <i class="fas fa-eye"></i>
                </button>
                <button class="tool-icon" onclick="aiEnhance()" title="AI Enhance" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                    <i class="fas fa-magic"></i>
                </button>
                <button class="tool-icon" onclick="aiDenoise()" title="Noise Reduction" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                    <i class="fas fa-broom"></i>
                </button>
                <button class="tool-icon" onclick="aiScratchRemove()" title="Remove Scratches" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                    <i class="fas fa-eraser"></i>
                </button>
                <button class="tool-icon" onclick="aiColorRestore()" title="Color Restore" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                    <i class="fas fa-palette"></i>
                </button>
                <button class="tool-icon" onclick="aiUpscale()" title="AI Upscale 2x" style="background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);">
                    <i class="fas fa-expand-arrows-alt"></i>
                </button>
            </div>

            <!-- CENTER PANEL - CANVAS -->
            <div class="canvas-panel">
                <canvas id="mainCanvas"></canvas>
                <div class="canvas-info" id="canvasInfo">No image loaded</div>
                
                <!-- Tool Instructions Overlay - DISABLED -->
                <!-- Popup removed as per user request -->
                
                <!-- Loading Indicator -->
                <div class="loading hidden" id="loadingIndicator">
                    <div class="spinner"></div>
                    <p style="color: #e0e0e0; margin-top: 10px;">Processing...</p>
                </div>
            </div>

            <!-- RIGHT PANEL - LAYERS & PROPERTIES -->
            <div class="properties-panel">
                
                <!-- LAYERS SECTION -->
                <div class="panel-section">
                    <div class="panel-title">Layers</div>
                    
                    <!-- Blend Mode -->
                    <div class="property-control">
                        <label class="property-label">Blend Mode</label>
                        <select class="property-input" id="blendMode" onchange="updateBlendMode()">
                            <option value="normal">Normal</option>
                            <option value="multiply">Multiply</option>
                            <option value="screen">Screen</option>
                            <option value="overlay">Overlay</option>
                            <option value="darken">Darken</option>
                            <option value="lighten">Lighten</option>
                            <option value="color-dodge">Color Dodge</option>
                            <option value="color-burn">Color Burn</option>
                            <option value="hard-light">Hard Light</option>
                            <option value="soft-light">Soft Light</option>
                            <option value="difference">Difference</option>
                            <option value="exclusion">Exclusion</option>
                            <option value="hue">Hue</option>
                            <option value="saturation">Saturation</option>
                            <option value="color">Color</option>
                            <option value="luminosity">Luminosity</option>
                        </select>
                    </div>

                    <!-- Opacity -->
                    <div class="property-control">
                        <label class="property-label">Opacity: <span id="opacityValue">100</span>%</label>
                        <input type="range" class="property-slider" id="opacity" min="0" max="100" value="100" oninput="updateOpacity(this.value)">
                    </div>

                    <!-- Layer List -->
                    <div id="layersList">
                        <div class="layer-item active">
                            <div class="layer-thumb"></div>
                            <div class="layer-info">
                                <div class="layer-name">Background</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ADJUSTMENTS SECTION -->
                <div class="panel-section">
                    <div class="panel-title">Adjustments</div>
                    
                    <div class="property-control">
                        <label class="property-label">Brightness: <span id="brightnessValue">0</span></label>
                        <input type="range" class="property-slider" id="brightness" min="-100" max="100" value="0" oninput="applyAdjustments()">
                    </div>

                    <div class="property-control">
                        <label class="property-label">Contrast: <span id="contrastValue">0</span></label>
                        <input type="range" class="property-slider" id="contrast" min="-100" max="100" value="0" oninput="applyAdjustments()">
                    </div>

                    <div class="property-control">
                        <label class="property-label">Saturation: <span id="saturationValue">0</span></label>
                        <input type="range" class="property-slider" id="saturation" min="-100" max="100" value="0" oninput="applyAdjustments()">
                    </div>

                    <div class="property-control">
                        <label class="property-label">Hue: <span id="hueValue">0</span></label>
                        <input type="range" class="property-slider" id="hue" min="-180" max="180" value="0" oninput="applyAdjustments()">
                    </div>

                    <div class="property-control">
                        <label class="property-label">Blur: <span id="blurValue">0</span></label>
                        <input type="range" class="property-slider" id="blurSlider" min="0" max="20" value="0" oninput="applyAdjustments()">
                    </div>

                    <div class="property-control">
                        <label class="property-label">Sharpness: <span id="sharpnessValue">0</span></label>
                        <input type="range" class="property-slider" id="sharpness" min="0" max="100" value="0" oninput="applyAdjustments()">
                    </div>
                </div>

                <!-- BRUSH SETTINGS -->
                <div class="panel-section">
                    <div class="panel-title">Brush Settings</div>
                    
                    <div class="property-control">
                        <label class="property-label">Size: <span id="brushSizeValue">10</span>px</label>
                        <input type="range" class="property-slider" id="brushSize" min="1" max="100" value="10" oninput="updateBrushSize(this.value)">
                    </div>

                    <div class="property-control">
                        <label class="property-label">Hardness: <span id="hardnessValue">100</span>%</label>
                        <input type="range" class="property-slider" id="hardness" min="0" max="100" value="100" oninput="updateHardness(this.value)">
                    </div>

                    <div class="property-control">
                        <label class="property-label">Color</label>
                        <input type="color" class="property-input" id="brushColor" value="#000000" onchange="updateBrushColor(this.value)">
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- UPLOAD OVERLAY (Shows when no image) -->
    <div class="upload-overlay" id="uploadOverlay">
        <div class="upload-box">
            <h2>Welcome to Professional Image Editor</h2>
            <p>Upload an image to start editing with AI-powered tools</p>
            <input type="file" id="fileInput" accept="image/*" style="display:none" onchange="handleFileUpload(event)">
            <button class="btn-upload" onclick="document.getElementById('fileInput').click()">
                <i class="fas fa-upload"></i> Choose Image
            </button>
            <p style="margin-top: 15px; font-size: 12px;">Or drag & drop an image here</p>
        </div>
    </div>

    <!-- FOOTER WILL BE INSERTED HERE -->
    <div id="footer-placeholder"></div>

    <script>
        // ===== GLOBAL VARIABLES =====
        let canvas = document.getElementById('mainCanvas');
        let ctx = canvas.getContext('2d', { willReadFrequently: true });
        let currentImage = null;
        let originalImage = null;
        let undoStack = [];
        let redoStack = [];
        let currentTool = 'move';
        let isDrawing = false;
        let layers = [{name: 'Background', visible: true, opacity: 100, blendMode: 'normal'}];
        let currentLayer = 0;

        // Brush settings
        let brushSize = 10;
        let brushColor = '#000000';
        let brushHardness = 100;

        // Suppress console warnings for tracking prevention and CORS
        const originalWarn = console.warn;
        const originalError = console.error;
        
        console.warn = function(...args) {
            const msg = args.join(' ');
            if (msg.includes('Tracking Prevention') || 
                msg.includes('storage for') ||
                msg.includes('CORS')) {
                return; // Suppress these warnings
            }
            originalWarn.apply(console, args);
        };
        
        console.error = function(...args) {
            const msg = args.join(' ');
            if (msg.includes('Tracking Prevention') || 
                msg.includes('storage for') ||
                msg.includes('net::ERR_BLOCKED_BY_CLIENT')) {
                return; // Suppress these errors
            }
            originalError.apply(console, args);
        };

        // ===== INITIALIZATION =====
        window.addEventListener('DOMContentLoaded', () => {
            // Load header and footer
            loadHeaderFooter();
            
            // Check for image from sessionStorage
            checkSessionImage();
            
            // Setup drag & drop
            setupDragDrop();
            
            // Setup canvas interactions
            setupCanvasEvents();

            // Mobile toolbar toggle
            setupMobileToolbar();
        });

        function setupMobileToolbar() {
            // On mobile, clicking toolbar button shows dropdown
            if (window.innerWidth <= 768) {
                document.querySelectorAll('.toolbar-section').forEach(section => {
                    const btn = section.querySelector('.toolbar-btn');
                    const dropdown = section.querySelector('.dropdown-menu');
                    
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        // Close other dropdowns
                        document.querySelectorAll('.toolbar-section').forEach(s => {
                            if (s !== section) s.classList.remove('active');
                        });
                        // Toggle current
                        section.classList.toggle('active');
                    });
                });

                // Close dropdown when clicking outside
                document.addEventListener('click', () => {
                    document.querySelectorAll('.toolbar-section').forEach(s => {
                        s.classList.remove('active');
                    });
                });
            }
        }

        function loadHeaderFooter() {
            // Note: Header/footer loading disabled for local file:// protocol
            // When deploying to web server, uncomment below code
            
            /* 
            // Load header from header.html
            fetch('header.html')
                .then(res => res.text())
                .then(html => {
                    document.getElementById('header-placeholder').innerHTML = html;
                    if (typeof initHeader === 'function') initHeader();
                })
                .catch(err => console.log('Header load failed:', err));

            // Load footer from footer.html
            fetch('footer.html')
                .then(res => res.text())
                .then(html => {
                    document.getElementById('footer-placeholder').innerHTML = html;
                })
                .catch(err => console.log('Footer load failed:', err));
            */
        }

        function checkSessionImage() {
            const imageData = sessionStorage.getItem('uploadedImage');
            if (imageData) {
                loadImageFromData(imageData);
                sessionStorage.removeItem('uploadedImage');
            }
        }

        function setupDragDrop() {
            const overlay = document.getElementById('uploadOverlay');
            
            overlay.addEventListener('dragover', (e) => {
                e.preventDefault();
                overlay.style.borderColor = '#0078d4';
            });

            overlay.addEventListener('dragleave', () => {
                overlay.style.borderColor = '#3a3a3a';
            });

            overlay.addEventListener('drop', (e) => {
                e.preventDefault();
                const file = e.dataTransfer.files[0];
                if (file && file.type.startsWith('image/')) {
                    loadImageFromFile(file);
                }
            });
        }

        function setupCanvasEvents() {
            let startX, startY;
            let cropStartX, cropStartY, cropEndX, cropEndY;

            canvas.addEventListener('mousedown', (e) => {
                if (!currentImage) return;
                isDrawing = true;
                const rect = canvas.getBoundingClientRect();
                startX = e.clientX - rect.left;
                startY = e.clientY - rect.top;
                
                if (currentTool === 'crop') {
                    cropStartX = startX;
                    cropStartY = startY;
                }
                
                handleToolStart(startX, startY);
            });

            canvas.addEventListener('mousemove', (e) => {
                if (!isDrawing || !currentImage) return;
                const rect = canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                if (currentTool === 'crop') {
                    cropEndX = x;
                    cropEndY = y;
                }
                
                handleToolMove(x, y, startX, startY);
            });

            canvas.addEventListener('mouseup', (e) => {
                if (isDrawing) {
                    const rect = canvas.getBoundingClientRect();
                    const endX = e.clientX - rect.left;
                    const endY = e.clientY - rect.top;
                    
                    if (currentTool === 'crop') {
                        cropEndX = endX;
                        cropEndY = endY;
                        // Show crop confirmation
                        if (confirm('Apply crop? (OK = Yes, Cancel = No)')) {
                            applyCrop(cropStartX, cropStartY, cropEndX, cropEndY);
                        } else {
                            ctx.putImageData(currentImage, 0, 0);
                        }
                    } else {
                        saveState();
                    }
                    isDrawing = false;
                }
            });

            canvas.addEventListener('mouseleave', () => {
                isDrawing = false;
            });

            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                // ESC to cancel crop tool
                if (e.key === 'Escape') {
                    if (currentTool === 'crop') {
                        ctx.putImageData(currentImage, 0, 0);
                        selectTool('move');
                        return;
                    }
                }
                
                if (e.key === 'Enter' && currentTool === 'crop' && cropEndX && cropEndY) {
                    applyCrop(cropStartX, cropStartY, cropEndX, cropEndY);
                }
                // Tool shortcuts
                if (e.key === 'v' || e.key === 'V') selectTool('move');
                if (e.key === 'm' || e.key === 'M') selectTool('select');
                if (e.key === 'c' || e.key === 'C') selectTool('crop');
                if (e.key === 'b' || e.key === 'B') selectTool('brush');
                if (e.key === 'e' || e.key === 'E') selectTool('eraser');
            });

            // TOUCH EVENTS FOR MOBILE
            let touchStartX, touchStartY;

            canvas.addEventListener('touchstart', (e) => {
                if (!currentImage) return;
                e.preventDefault();
                const touch = e.touches[0];
                const rect = canvas.getBoundingClientRect();
                touchStartX = touch.clientX - rect.left;
                touchStartY = touch.clientY - rect.top;
                startX = touchStartX;
                startY = touchStartY;
                isDrawing = true;

                if (currentTool === 'crop') {
                    cropStartX = startX;
                    cropStartY = startY;
                }

                handleToolStart(startX, startY);
            }, {passive: false});

            canvas.addEventListener('touchmove', (e) => {
                if (!isDrawing || !currentImage) return;
                e.preventDefault();
                const touch = e.touches[0];
                const rect = canvas.getBoundingClientRect();
                const x = touch.clientX - rect.left;
                const y = touch.clientY - rect.top;

                if (currentTool === 'crop') {
                    cropEndX = x;
                    cropEndY = y;
                }

                handleToolMove(x, y, startX, startY);
                startX = x;
                startY = y;
            }, {passive: false});

            canvas.addEventListener('touchend', (e) => {
                if (isDrawing) {
                    if (currentTool === 'crop' && cropEndX && cropEndY) {
                        if (confirm('Apply crop?')) {
                            applyCrop(cropStartX, cropStartY, cropEndX, cropEndY);
                        } else {
                            ctx.putImageData(currentImage, 0, 0);
                        }
                    } else {
                        saveState();
                    }
                    isDrawing = false;
                }
            });
        }

        // ===== FILE OPERATIONS =====
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (file) {
                loadImageFromFile(file);
            }
        }

        function loadImageFromFile(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                loadImageFromData(e.target.result);
            };
            reader.readAsDataURL(file);
        }

        function loadImageFromData(dataURL) {
            showLoading(true);
            const img = new Image();
            img.onload = () => {
                canvas.width = img.width;
                canvas.height = img.height;
                ctx.drawImage(img, 0, 0);
                currentImage = ctx.getImageData(0, 0, canvas.width, canvas.height);
                originalImage = ctx.getImageData(0, 0, canvas.width, canvas.height);
                document.getElementById('uploadOverlay').classList.add('hidden');
                
                // Hide any tool overlay that might be showing
                hideToolOverlay();
                
                updateCanvasInfo();
                saveState();
                showLoading(false);
            };
            img.src = dataURL;
        }

        function updateCanvasInfo() {
            const info = document.getElementById('canvasInfo');
            if (currentImage) {
                info.textContent = `${canvas.width} Ã— ${canvas.height} px | ${currentTool.toUpperCase()}`;
            }
        }

        function showLoading(show) {
            const loader = document.getElementById('loadingIndicator');
            if (show) {
                loader.classList.remove('hidden');
            } else {
                loader.classList.add('hidden');
            }
        }

        // ===== TOOL SELECTION =====
        let pendingToolData = null;

        function selectTool(tool, clickEvent = null) {
            currentTool = tool;
            // Update active tool icon
            document.querySelectorAll('.tool-icon').forEach(icon => {
                icon.classList.remove('active');
            });
            
            // Use passed event or try to get from window
            const evt = clickEvent || (typeof event !== 'undefined' ? event : null);
            if (evt && evt.target) {
                const toolIcon = evt.target.closest('.tool-icon');
                if (toolIcon) {
                    toolIcon.classList.add('active');
                }
            }
            
            updateCanvasInfo();
            
            // Tool instructions popup disabled as per user request
        }

        let overlayTimeout = null;

        function showToolInstructions(tool) {
            // DISABLED - Popup removed as per user request
            return;
        }

        function hideToolOverlay() {
            // DISABLED - Popup removed
            return;
        }

        function handleOverlayClick(event) {
            // DISABLED - Popup removed
            return;
        }

        function applyCurrentTool() {
            // Apply tool without popup
            if (currentTool === 'crop' && pendingToolData) {
                applyCrop(pendingToolData.x1, pendingToolData.y1, pendingToolData.x2, pendingToolData.y2);
            }
            pendingToolData = null;
        }

        function cancelCurrentTool() {
            // Cancel without popup
            if (currentImage) {
                ctx.putImageData(currentImage, 0, 0);
            }
            selectTool('move');
            pendingToolData = null;
        }

        function handleToolStart(x, y) {
            saveState();
        }

        function handleToolMove(x, y, startX, startY) {
            if (currentTool === 'brush') {
                ctx.globalCompositeOperation = 'source-over';
                ctx.strokeStyle = brushColor;
                ctx.lineWidth = brushSize;
                ctx.lineCap = 'round';
                ctx.lineJoin = 'round';
                ctx.beginPath();
                ctx.moveTo(startX, startY);
                ctx.lineTo(x, y);
                ctx.stroke();
                currentImage = ctx.getImageData(0, 0, canvas.width, canvas.height);
            } else if (currentTool === 'eraser') {
                ctx.globalCompositeOperation = 'destination-out';
                ctx.lineWidth = brushSize;
                ctx.lineCap = 'round';
                ctx.beginPath();
                ctx.moveTo(startX, startY);
                ctx.lineTo(x, y);
                ctx.stroke();
                ctx.globalCompositeOperation = 'source-over';
                currentImage = ctx.getImageData(0, 0, canvas.width, canvas.height);
            } else if (currentTool === 'select') {
                // Draw selection rectangle
                ctx.putImageData(currentImage, 0, 0);
                ctx.strokeStyle = '#0078d4';
                ctx.lineWidth = 2;
                ctx.setLineDash([5, 5]);
                ctx.strokeRect(startX, startY, x - startX, y - startY);
                ctx.setLineDash([]);
            } else if (currentTool === 'crop') {
                // Draw crop overlay
                ctx.putImageData(currentImage, 0, 0);
                ctx.fillStyle = 'rgba(0,0,0,0.5)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.clearRect(startX, startY, x - startX, y - startY);
                ctx.strokeStyle = '#0078d4';
                ctx.lineWidth = 2;
                ctx.strokeRect(startX, startY, x - startX, y - startY);
                
                // Draw crop handles
                drawCropHandles(startX, startY, x, y);
            }
        }

        function drawCropHandles(x1, y1, x2, y2) {
            const handleSize = 10;
            ctx.fillStyle = '#0078d4';
            // Corners
            ctx.fillRect(x1 - handleSize/2, y1 - handleSize/2, handleSize, handleSize);
            ctx.fillRect(x2 - handleSize/2, y1 - handleSize/2, handleSize, handleSize);
            ctx.fillRect(x1 - handleSize/2, y2 - handleSize/2, handleSize, handleSize);
            ctx.fillRect(x2 - handleSize/2, y2 - handleSize/2, handleSize, handleSize);
            // Midpoints
            ctx.fillRect((x1+x2)/2 - handleSize/2, y1 - handleSize/2, handleSize, handleSize);
            ctx.fillRect((x1+x2)/2 - handleSize/2, y2 - handleSize/2, handleSize, handleSize);
            ctx.fillRect(x1 - handleSize/2, (y1+y2)/2 - handleSize/2, handleSize, handleSize);
            ctx.fillRect(x2 - handleSize/2, (y1+y2)/2 - handleSize/2, handleSize, handleSize);
        }

        // ===== UNDO/REDO =====
        function saveState() {
            if (currentImage) {
                undoStack.push(ctx.getImageData(0, 0, canvas.width, canvas.height));
                redoStack = [];
                if (undoStack.length > 50) undoStack.shift();
            }
        }

        function undo() {
            if (undoStack.length > 0) {
                redoStack.push(ctx.getImageData(0, 0, canvas.width, canvas.height));
                const prevState = undoStack.pop();
                ctx.putImageData(prevState, 0, 0);
                currentImage = ctx.getImageData(0, 0, canvas.width, canvas.height);
            }
        }

        function redo() {
            if (redoStack.length > 0) {
                undoStack.push(ctx.getImageData(0, 0, canvas.width, canvas.height));
                const nextState = redoStack.pop();
                ctx.putImageData(nextState, 0, 0);
                currentImage = ctx.getImageData(0, 0, canvas.width, canvas.height);
            }
        }

        // ===== FILE MENU =====
        function newImage() {
            if (confirm('Create new image? Current work will be lost.')) {
                const width = prompt('Width:', '1920');
                const height = prompt('Height:', '1080');
                if (width && height) {
                    canvas.width = parseInt(width);
                    canvas.height = parseInt(height);
                    ctx.fillStyle = 'white';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    currentImage = ctx.getImageData(0, 0, canvas.width, canvas.height);
                    originalImage = ctx.getImageData(0, 0, canvas.width, canvas.height);
                    document.getElementById('uploadOverlay').classList.add('hidden');
                    updateCanvasInfo();
                    saveState();
                }
            }
        }

        function openImage() {
            document.getElementById('fileInput').click();
        }

        function saveImage() {
            if (!currentImage) return alert('No image to save!');
            const link = document.createElement('a');
            link.download = 'edited-image.png';
            link.href = canvas.toDataURL();
            link.click();
        }

        function exportImage() {
            if (!currentImage) return alert('No image to export!');
            const format = prompt('Export format (png, jpg, webp):', 'png');
            if (format) {
                const link = document.createElement('a');
                link.download = `edited-image.${format}`;
                link.href = canvas.toDataURL(`image/${format}`);
                link.click();
            }
        }

        // ===== EDIT MENU =====
        function cut() { alert('Cut functionality - Coming soon!'); }
        function copy() { alert('Copy functionality - Coming soon!'); }
        function paste() { alert('Paste functionality - Coming soon!'); }

        // ===== IMAGE MENU =====
        function resizeImage() {
            if (!currentImage) return alert('No image loaded!');
            const width = prompt('New width:', canvas.width);
            const height = prompt('New height:', canvas.height);
            if (width && height) {
                const tempCanvas = document.createElement('canvas');
                const tempCtx = tempCanvas.getContext('2d');
                tempCanvas.width = canvas.width;
                tempCanvas.height = canvas.height;
                tempCtx.putImageData(currentImage, 0, 0);
                
                canvas.width = parseInt(width);
                canvas.height = parseInt(height);
                ctx.drawImage(tempCanvas, 0, 0, tempCanvas.width, tempCanvas.height, 0, 0, canvas.width, canvas.height);
                currentImage = ctx.getImageData(0, 0, canvas.width, canvas.height);
                saveState();
                updateCanvasInfo();
            }
        }

        function cropImage() {
            if (!currentImage) return alert('No image loaded!');
            alert('âœ‚ï¸ Use the CROP tool from left panel:\n\n1. Click the Crop icon (scissors)\n2. Click and drag to select area\n3. You\'ll see corner handles\n4. Press ENTER to apply crop\n5. Press ESC to cancel\n\nAdvanced: Drag corner handles to adjust');
            selectTool('crop');
        }

        function applyCrop(x1, y1, x2, y2) {
            if (!currentImage) return;
            saveState();
            
            // Ensure proper coordinates
            const left = Math.min(x1, x2);
            const top = Math.min(y1, y2);
            const width = Math.abs(x2 - x1);
            const height = Math.abs(y2 - y1);
            
            if (width < 10 || height < 10) {
                alert('Crop area too small!');
                return;
            }
            
            // Create temp canvas with cropped area
            const tempCanvas = document.createElement('canvas');
            const tempCtx = tempCanvas.getContext('2d');
            tempCanvas.width = width;
            tempCanvas.height = height;
            
            // Copy cropped region
            const croppedData = ctx.getImageData(left, top, width, height);
            tempCtx.putImageData(croppedData, 0, 0);
            
            // Resize main canvas
            canvas.width = width;
            canvas.height = height;
            ctx.drawImage(tempCanvas, 0, 0);
            
            currentImage = ctx.getImageData(0, 0, canvas.width, canvas.height);
            originalImage = ctx.getImageData(0, 0, canvas.width, canvas.height);
            updateCanvasInfo();
            
            alert(`âœ… Image cropped to ${width} Ã— ${height} px`);
            selectTool('move');
        }

        function rotateImage() {
            if (!currentImage) return;
            saveState();
            const tempCanvas = document.createElement('canvas');
            const tempCtx = tempCanvas.getContext('2d');
            tempCanvas.width = canvas.height;
            tempCanvas.height = canvas.width;
            tempCtx.translate(tempCanvas.width / 2, tempCanvas.height / 2);
            tempCtx.rotate(Math.PI / 2);
            tempCtx.drawImage(canvas, -canvas.width / 2, -canvas.height / 2);
            
            canvas.width = tempCanvas.width;
            canvas.height = tempCanvas.height;
            ctx.drawImage(tempCanvas, 0, 0);
            currentImage = ctx.getImageData(0, 0, canvas.width, canvas.height);
            updateCanvasInfo();
        }

        function flipHorizontal() {
            if (!currentImage) return;
            saveState();
            ctx.translate(canvas.width, 0);
            ctx.scale(-1, 1);
            ctx.drawImage(canvas, 0, 0);
            ctx.setTransform(1, 0, 0, 1, 0, 0);
            currentImage = ctx.getImageData(0, 0, canvas.width, canvas.height);
        }

        function flipVertical() {
            if (!currentImage) return;
            saveState();
            ctx.translate(0, canvas.height);
            ctx.scale(1, -1);
            ctx.drawImage(canvas, 0, 0);
            ctx.setTransform(1, 0, 0, 1, 0, 0);
            currentImage = ctx.getImageData(0, 0, canvas.width, canvas.height);
        }

        // ===== FILTERS =====
        function applyBlur() {
            if (!currentImage) return;
            
            const overlay = document.getElementById('toolOverlay');
            const title = document.getElementById('toolTitle');
            const instructions = document.getElementById('toolInstructions');
            
            title.textContent = 'ðŸŒ«ï¸ Applying Blur Filter';
            instructions.textContent = 'Blurring your image...\n\nThis will soften details and reduce sharpness.';
            overlay.classList.remove('hidden');
            
            saveState();
            showLoading(true);
            setTimeout(() => {
                ctx.filter = 'blur(5px)';
                ctx.drawImage(canvas, 0, 0);
                ctx.filter = 'none';
                currentImage = ctx.getImageData(0, 0, canvas.width, canvas.height);
                originalImage = ctx.getImageData(0, 0, canvas.width, canvas.height);
                showLoading(false);
                hideToolOverlay();
                alert('âœ… Blur filter applied successfully!');
            }, 100);
        }

        function applySharpen() {
            if (!currentImage) return;
            
            const overlay = document.getElementById('toolOverlay');
            const title = document.getElementById('toolTitle');
            const instructions = document.getElementById('toolInstructions');
            
            title.textContent = 'âœ¨ Applying Sharpen Filter';
            instructions.textContent = 'Sharpening your image...\n\nThis will enhance edges and details.';
            overlay.classList.remove('hidden');
            
            saveState();
            showLoading(true);
            setTimeout(() => {
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                const data = imageData.data;
                const kernel = [0, -1, 0, -1, 5, -1, 0, -1, 0];
                const side = Math.round(Math.sqrt(kernel.length));
                const halfSide = Math.floor(side / 2);
                const w = canvas.width;
                const h = canvas.height;
                const output = ctx.createImageData(w, h);
                
                for (let y = 0; y < h; y++) {
                    for (let x = 0; x < w; x++) {
                        let r = 0, g = 0, b = 0;
                        for (let cy = 0; cy < side; cy++) {
                            for (let cx = 0; cx < side; cx++) {
                                const scy = y + cy - halfSide;
                                const scx = x + cx - halfSide;
                                if (scy >= 0 && scy < h && scx >= 0 && scx < w) {
                                    const offset = (scy * w + scx) * 4;
                                    const wt = kernel[cy * side + cx];
                                    r += data[offset] * wt;
                                    g += data[offset + 1] * wt;
                                    b += data[offset + 2] * wt;
                                }
                            }
                        }
                        const dstOff = (y * w + x) * 4;
                        output.data[dstOff] = Math.min(255, Math.max(0, r));
                        output.data[dstOff + 1] = Math.min(255, Math.max(0, g));
                        output.data[dstOff + 2] = Math.min(255, Math.max(0, b));
                        output.data[dstOff + 3] = 255;
                    }
                }
                ctx.putImageData(output, 0, 0);
                currentImage = ctx.getImageData(0, 0, canvas.width, canvas.height);
                originalImage = ctx.getImageData(0, 0, canvas.width, canvas.height);
                showLoading(false);
                hideToolOverlay();
                alert('âœ… Sharpen filter applied successfully!');
            }, 100);
        }

        function applyGrayscale() {
            if (!currentImage) return;
            
            showToolMessage('âš« Grayscale Filter', 'Converting image to black & white...');
            
            saveState();
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;
            for (let i = 0; i < data.length; i += 4) {
                const avg = (data[i] + data[i + 1] + data[i + 2]) / 3;
                data[i] = data[i + 1] = data[i + 2] = avg;
            }
            ctx.putImageData(imageData, 0, 0);
            currentImage = ctx.getImageData(0, 0, canvas.width, canvas.height);
            originalImage = ctx.getImageData(0, 0, canvas.width, canvas.height);
            
            setTimeout(() => {
                hideToolOverlay();
                alert('âœ… Grayscale filter applied!');
            }, 500);
        }

        function applySepia() {
            if (!currentImage) return;
            
            showToolMessage('ðŸŸ¤ Sepia Filter', 'Applying vintage sepia tone...');
            
            saveState();
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;
            for (let i = 0; i < data.length; i += 4) {
                const r = data[i];
                const g = data[i + 1];
                const b = data[i + 2];
                data[i] = Math.min(255, (r * 0.393) + (g * 0.769) + (b * 0.189));
                data[i + 1] = Math.min(255, (r * 0.349) + (g * 0.686) + (b * 0.168));
                data[i + 2] = Math.min(255, (r * 0.272) + (g * 0.534) + (b * 0.131));
            }
            ctx.putImageData(imageData, 0, 0);
            currentImage = ctx.getImageData(0, 0, canvas.width, canvas.height);
            originalImage = ctx.getImageData(0, 0, canvas.width, canvas.height);
            
            setTimeout(() => {
                hideToolOverlay();
                alert('âœ… Sepia filter applied!');
            }, 500);
        }

        function applyInvert() {
            if (!currentImage) return;
            
            showToolMessage('ðŸ”„ Invert Colors', 'Inverting all colors...');
            
            saveState();
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;
            for (let i = 0; i < data.length; i += 4) {
                data[i] = 255 - data[i];
                data[i + 1] = 255 - data[i + 1];
                data[i + 2] = 255 - data[i + 2];
            }
            ctx.putImageData(imageData, 0, 0);
            currentImage = ctx.getImageData(0, 0, canvas.width, canvas.height);
            originalImage = ctx.getImageData(0, 0, canvas.width, canvas.height);
            
            setTimeout(() => {
                hideToolOverlay();
                alert('âœ… Colors inverted!');
            }, 500);
        }

        function applyVintage() {
            if (!currentImage) return;
            
            showToolMessage('ðŸ“· Vintage Filter', 'Creating vintage effect...');
            
            saveState();
            applySepia();
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;
            for (let i = 0; i < data.length; i += 4) {
                data[i] = Math.min(255, data[i] * 1.1);
                data[i + 2] = data[i + 2] * 0.9;
            }
            ctx.putImageData(imageData, 0, 0);
            currentImage = ctx.getImageData(0, 0, canvas.width, canvas.height);
            originalImage = ctx.getImageData(0, 0, canvas.width, canvas.height);
            
            setTimeout(() => {
                hideToolOverlay();
                alert('âœ… Vintage effect applied!');
            }, 500);
        }

        function showToolMessage(title, message) {
            const overlay = document.getElementById('toolOverlay');
            const titleEl = document.getElementById('toolTitle');
            const instructions = document.getElementById('toolInstructions');
            
            titleEl.textContent = title;
            instructions.textContent = message;
            overlay.classList.remove('hidden');
        }

        // ===== ADJUSTMENTS =====
        function applyAdjustments() {
            if (!originalImage) return;
            
            const brightness = parseInt(document.getElementById('brightness').value);
            const contrast = parseInt(document.getElementById('contrast').value);
            const saturation = parseInt(document.getElementById('saturation').value);
            const hue = parseInt(document.getElementById('hue').value);
            const blur = parseInt(document.getElementById('blurSlider').value);
            const sharpness = parseInt(document.getElementById('sharpness').value);

            document.getElementById('brightnessValue').textContent = brightness;
            document.getElementById('contrastValue').textContent = contrast;
            document.getElementById('saturationValue').textContent = saturation;
            document.getElementById('hueValue').textContent = hue;
            document.getElementById('blurValue').textContent = blur;
            document.getElementById('sharpnessValue').textContent = sharpness;

            // Start with original
            ctx.putImageData(originalImage, 0, 0);
            
            // Apply CSS filters
            let filterString = '';
            if (brightness !== 0) filterString += `brightness(${100 + brightness}%) `;
            if (contrast !== 0) filterString += `contrast(${100 + contrast}%) `;
            if (saturation !== 0) filterString += `saturate(${100 + saturation}%) `;
            if (hue !== 0) filterString += `hue-rotate(${hue}deg) `;
            if (blur > 0) filterString += `blur(${blur}px) `;
            
            if (filterString) {
                ctx.filter = filterString;
                ctx.drawImage(canvas, 0, 0);
                ctx.filter = 'none';
            }
            
            currentImage = ctx.getImageData(0, 0, canvas.width, canvas.height);
        }

        function adjustBrightness() {
            document.getElementById('brightness').focus();
        }

        function adjustContrast() {
            document.getElementById('contrast').focus();
        }

        function adjustSaturation() {
            document.getElementById('saturation').focus();
        }

        function adjustHue() {
            document.getElementById('hue').focus();
        }

        function autoEnhance() {
            if (!currentImage) return;
            saveState();
            document.getElementById('brightness').value = 10;
            document.getElementById('contrast').value = 15;
            document.getElementById('saturation').value = 10;
            applyAdjustments();
        }

        // ===== AI TOOLS =====
        function aiUnblur() {
            if (!currentImage) return;
            
            showToolMessage('ðŸ§  AI Unblur', 'AI is analyzing and unblurring your image...\n\nThis may take a few seconds.');
            showLoading(true);
            saveState();
            
            setTimeout(() => {
                applySharpen();
                document.getElementById('sharpness').value = 50;
                applyAdjustments();
                showLoading(false);
                hideToolOverlay();
                alert('âœ… Image unblurred using AI sharpening!\n\nYour image is now clearer and sharper.');
            }, 2000);
        }

        function aiDenoise() {
            if (!currentImage) return;
            
            showToolMessage('ðŸ§¹ AI Noise Reduction', 'AI is removing noise and grain from your image...\n\nProcessing...');
            showLoading(true);
            saveState();
            
            setTimeout(() => {
                ctx.filter = 'blur(1px)';
                ctx.drawImage(canvas, 0, 0);
                ctx.filter = 'none';
                applySharpen();
                currentImage = ctx.getImageData(0, 0, canvas.width, canvas.height);
                originalImage = ctx.getImageData(0, 0, canvas.width, canvas.height);
                showLoading(false);
                hideToolOverlay();
                alert('âœ… Noise reduced successfully!\n\nYour image looks cleaner now.');
            }, 2000);
        }

        function aiEnhance() {
            if (!currentImage) return;
            
            showToolMessage('âœ¨ AI Enhancement', 'AI is enhancing colors, contrast, and sharpness...\n\nMagic in progress...');
            showLoading(true);
            saveState();
            
            setTimeout(() => {
                autoEnhance();
                applySharpen();
                showLoading(false);
                hideToolOverlay();
                alert('âœ… Image enhanced with AI!\n\nâ€¢ Brightness optimized\nâ€¢ Contrast improved\nâ€¢ Colors enhanced\nâ€¢ Sharpness increased');
            }, 2000);
        }

        function aiColorRestore() {
            if (!currentImage) return;
            
            showToolMessage('ðŸŽ¨ AI Color Restoration', 'AI is restoring and enhancing colors...\n\nBringing life back to your image...');
            showLoading(true);
            saveState();
            
            setTimeout(() => {
                document.getElementById('saturation').value = 30;
                document.getElementById('brightness').value = 5;
                applyAdjustments();
                showLoading(false);
                hideToolOverlay();
                alert('âœ… Colors restored!\n\nYour image has vibrant colors now.');
            }, 2000);
        }

        function aiScratchRemove() {
            if (!currentImage) return;
            
            showToolMessage('ðŸ”§ AI Scratch Removal', 'AI is detecting and removing scratches...\n\nHealing your image...');
            showLoading(true);
            saveState();
            
            setTimeout(() => {
                ctx.filter = 'blur(2px)';
                ctx.drawImage(canvas, 0, 0);
                ctx.filter = 'none';
                currentImage = ctx.getImageData(0, 0, canvas.width, canvas.height);
                originalImage = ctx.getImageData(0, 0, canvas.width, canvas.height);
                showLoading(false);
                hideToolOverlay();
                alert('âœ… Scratches removed!\n\nYour image looks much better now.');
            }, 2500);
        }

        function aiUpscale() {
            if (!currentImage) return;
            
            showToolMessage('ðŸ“ˆ AI Upscale 2x', 'AI is upscaling your image to 2x resolution...\n\nEnhancing quality...');
            showLoading(true);
            saveState();
            
            setTimeout(() => {
                const newWidth = canvas.width * 2;
                const newHeight = canvas.height * 2;
                const tempCanvas = document.createElement('canvas');
                const tempCtx = tempCanvas.getContext('2d');
                tempCanvas.width = canvas.width;
                tempCanvas.height = canvas.height;
                tempCtx.putImageData(currentImage, 0, 0);
                
                canvas.width = newWidth;
                canvas.height = newHeight;
                ctx.imageSmoothingEnabled = true;
                ctx.imageSmoothingQuality = 'high';
                ctx.drawImage(tempCanvas, 0, 0, newWidth, newHeight);
                currentImage = ctx.getImageData(0, 0, canvas.width, canvas.height);
                originalImage = ctx.getImageData(0, 0, canvas.width, canvas.height);
                updateCanvasInfo();
                showLoading(false);
                hideToolOverlay();
                alert(`âœ… Image upscaled 2x!\n\nNew size: ${newWidth} Ã— ${newHeight} px\n\nYour image is now higher resolution.`);
            }, 2500);
        }

        function aiBackgroundRemove() {
            showToolMessage('ðŸ‘¤ AI Background Removal', 'This advanced AI feature is coming soon!\n\nFor now, you can:\nâ€¢ Use the Eraser tool manually\nâ€¢ Use Magic Wand for quick selection');
            
            setTimeout(() => {
                hideToolOverlay();
            }, 3000);
        }

        function aiObjectRemove() {
            showToolMessage('ðŸ—‘ï¸ AI Object Removal', 'This advanced AI feature is coming soon!\n\nIt will allow you to:\nâ€¢ Select any object\nâ€¢ Remove it automatically\nâ€¢ Fill background intelligently');
            
            setTimeout(() => {
                hideToolOverlay();
            }, 3000);
        }

        // ===== LAYERS =====
        function newLayer() {
            layers.push({name: `Layer ${layers.length + 1}`, visible: true, opacity: 100, blendMode: 'normal'});
            updateLayersList();
        }

        function duplicateLayer() {
            const layer = {...layers[currentLayer]};
            layer.name = layer.name + ' copy';
            layers.push(layer);
            updateLayersList();
        }

        function mergeDown() {
            if (currentLayer > 0) {
                layers.splice(currentLayer, 1);
                currentLayer--;
                updateLayersList();
            }
        }

        function flattenImage() {
            layers = [{name: 'Background', visible: true, opacity: 100, blendMode: 'normal'}];
            currentLayer = 0;
            updateLayersList();
        }

        function updateLayersList() {
            const list = document.getElementById('layersList');
            list.innerHTML = '';
            layers.forEach((layer, i) => {
                const div = document.createElement('div');
                div.className = 'layer-item' + (i === currentLayer ? ' active' : '');
                div.innerHTML = `
                    <div class="layer-thumb"></div>
                    <div class="layer-info">
                        <div class="layer-name">${layer.name}</div>
                    </div>
                `;
                div.onclick = () => {
                    currentLayer = i;
                    updateLayersList();
                };
                list.appendChild(div);
            });
        }

        function updateBlendMode() {
            const mode = document.getElementById('blendMode').value;
            if (currentImage) {
                ctx.globalCompositeOperation = mode;
            }
        }

        function updateOpacity(value) {
            document.getElementById('opacityValue').textContent = value;
            if (currentImage) {
                ctx.globalAlpha = value / 100;
            }
        }

        // ===== BRUSH SETTINGS =====
        function updateBrushSize(value) {
            brushSize = parseInt(value);
            document.getElementById('brushSizeValue').textContent = value;
        }

        function updateHardness(value) {
            brushHardness = parseInt(value);
            document.getElementById('hardnessValue').textContent = value;
        }

        function updateBrushColor(color) {
            brushColor = color;
        }

        // ===== UTILITIES =====
        function compress() {
            if (!currentImage) return;
            const quality = prompt('Compression quality (0-100):', '80');
            if (quality) {
                const link = document.createElement('a');
                link.download = 'compressed-image.jpg';
                link.href = canvas.toDataURL('image/jpeg', quality / 100);
                link.click();
                alert('Image compressed and downloaded!');
            }
        }

        function convertFormat() {
            exportImage();
        }

        function addWatermark() {
            if (!currentImage) return;
            const text = prompt('Watermark text:', '');
            if (text) {
                saveState();
                ctx.font = '30px Arial';
                ctx.fillStyle = 'rgba(255,255,255,0.5)';
                ctx.textAlign = 'center';
                ctx.fillText(text, canvas.width / 2, canvas.height - 50);
                currentImage = ctx.getImageData(0, 0, canvas.width, canvas.height);
            }
        }

        function borderTool() {
            if (!currentImage) return;
            const size = prompt('Border size (px):', '10');
            const color = prompt('Border color:', '#000000');
            if (size && color) {
                saveState();
                ctx.strokeStyle = color;
                ctx.lineWidth = parseInt(size) * 2;
                ctx.strokeRect(0, 0, canvas.width, canvas.height);
                currentImage = ctx.getImageData(0, 0, canvas.width, canvas.height);
            }
        }

    </script>


    

    
    <div class="trust-badges" style="text-align: center; padding: 20px; background: linear-gradient(135deg, #f8f9ff, #ffffff); border-radius: 12px; margin: 30px 0; border: 2px solid #e2e6ff;">
        <div style="display: flex; justify-content: center; align-items: center; gap: 40px; flex-wrap: wrap;">
            <div style="display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-shield-alt" style="font-size: 2rem; color: #4361ee;"></i>
                <div style="text-align: left;">
                    <div style="color: #0b1630; font-weight: 600; font-size: 1.1rem;">SSL Secured</div>
                    <div style="color: #56607a; font-size: 0.9rem;">256-bit Encryption</div>
                </div>
            </div>
            <div style="display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-lock" style="font-size: 2rem; color: #4361ee;"></i>
                <div style="text-align: left;">
                    <div style="color: #0b1630; font-weight: 600; font-size: 1.1rem;">100% Secure</div>
                    <div style="color: #56607a; font-size: 0.9rem;">Files Auto-Deleted</div>
                </div>
            </div>
            <div style="display: flex; align-items: center; gap: 10px;">
                <i class="fas fa-check-circle" style="font-size: 2rem; color: #4361ee;"></i>
                <div style="text-align: left;">
                    <div style="color: #0b1630; font-weight: 600; font-size: 1.1rem;">AdSense Verified</div>
                    <div style="color: #56607a; font-size: 0.9rem;">Google Approved</div>
                </div>
            </div>
        </div>
    </div>
<footer>
        <div class="container footer-inner">
            <div class="footer-company-links">
                <span>Company</span>
                <a href="index.html#about">About Us</a>
                <a href="index.html#contact">Contact</a>
                <a href="pricing.html">Pricing</a>
                <a href="privacy-policy.html">Privacy Policy</a>
                <a href="terms-of-service.html">Terms of Service</a>
                <a href="dmca-en.html">DMCA</a>
                <a href="blog.html">Blog</a>
            </div>
            <p class="footer-brand-line">&copy; easyjpgtopdf &mdash; Free PDF &amp; Image Tools for everyone. All rights reserved.</p>
            <p class="footer-credits">
                Thanks to Font Awesome, Google Fonts, jsPDF, pdf.js, pdf-lib, Mammoth, Tesseract.js, IMG.LY, Firebase, Unsplash photographers, and every open-source contributor powering this site.
                <a href="attributions.html">See full acknowledgements</a>.
            </p>
        </div>
    </footer>
</body>
</html>
