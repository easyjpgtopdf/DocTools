<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Background Workspace | easyjpgtopdf</title>
    <link rel="stylesheet" href="css/footer.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script type="importmap">
    {
      "imports": {
        "onnxruntime-web": "https://cdn.jsdelivr.net/npm/onnxruntime-web@1.21.0/dist/ort.min.mjs"
      }
    }
  </script>
  <style>
    :root {
      --primary: #4361ee;
      --secondary: #3a0ca3;
      --accent: #4cc9f0;
      --dark: #212529;
      --muted: #7a7f8c;
      --surface: #ffffff;
      --border: rgba(18, 20, 58, 0.1);
    }
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
    body { background: linear-gradient(180deg, #f3f4ff 0%, #f8f9ff 100%); color: var(--dark); min-height: 100vh; display: flex; flex-direction: column; }
    .topbar { background: var(--surface); box-shadow: 0 12px 30px rgba(14, 32, 86, 0.1); position: sticky; top: 0; z-index: 20; }
    .topbar .inner { max-width: 1200px; margin: 0 auto; padding: 14px 24px; display: flex; justify-content: space-between; align-items: center; gap: 18px; }
    .brand { display: flex; gap: 10px; align-items: center; font-weight: 700; font-size: 20px; color: var(--primary); text-decoration: none; }
    .quick-links { display: flex; gap: 10px; flex-wrap: wrap; }
    .quick-links a { text-decoration: none; padding: 8px 16px; border-radius: 999px; border: 1px solid var(--border); color: #253156; font-weight: 600; background: rgba(67, 97, 238, 0.08); transition: transform 0.2s, box-shadow 0.2s, background 0.2s; }
    .quick-links a:hover { background: linear-gradient(135deg, #4361ee, #3a0ca3); color: #fff; transform: translateY(-1px); box-shadow: 0 12px 24px rgba(67, 97, 238, 0.2); }
    main { flex: 1; width: 100%; max-width: 1200px; margin: 36px auto; padding: 0 24px 48px; display: grid; grid-template-columns: minmax(320px, 500px) 1fr; gap: 32px; align-items: start; }
    .panel { background: var(--surface); border-radius: 24px; padding: 28px; box-shadow: 0 20px 45px rgba(15, 30, 70, 0.08); }
    .panel h2 { font-size: 1.35rem; margin-bottom: 18px; display: flex; gap: 12px; align-items: center; color: #171f4d; }
    .preview-stage { position: relative; width: 8.5cm; height: 6cm; max-width: 100%; max-height: 100%; margin: 0 auto; border-radius: 18px; background: repeating-conic-gradient(#e5e9ff 0deg 25deg, #f8f9ff 25deg 50deg); overflow: hidden; display: flex; align-items: center; justify-content: center; }
    .preview-original, .preview-result { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: contain; transition: opacity 0.6s ease; }
    .preview-result { opacity: 0; }
    .preview-stage.revealed .preview-result { opacity: 1; }
    .preview-stage.revealed .preview-original { opacity: 0; }
    .preview-overlay { position: absolute; inset: 0; background: rgba(17, 24, 39, 0.55); display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 12px; color: #fff; font-weight: 600; letter-spacing: 0.03em; transition: opacity 0.4s ease; }
    .preview-stage.revealed .preview-overlay { opacity: 0; pointer-events: none; }
    .preview-stage.empty .preview-overlay { display: none; }
    .preview-placeholder { display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 12px; text-align: center; color: var(--muted); font-weight: 600; letter-spacing: 0.03em; }
    .preview-placeholder.hidden { display: none; }
    .preview-spinner { width: 34px; height: 34px; border: 3px solid rgba(255, 255, 255, 0.4); border-top-color: #fff; border-radius: 50%; animation: spin 1s linear infinite; }
    .actions { margin-top: 24px; display: flex; flex-wrap: wrap; gap: 14px; }
    .btn { display: inline-flex; align-items: center; gap: 8px; padding: 10px 22px; border-radius: 999px; border: none; cursor: pointer; font-weight: 600; font-size: 0.95rem; transition: transform 0.2s, box-shadow 0.2s; }
    .btn-primary { background: linear-gradient(135deg, #4361ee, #3a0ca3); color: #fff; box-shadow: 0 16px 30px rgba(67, 97, 238, 0.25); }
    .btn-outline { background: #fff; border: 1px solid var(--border); color: #233050; }
    .btn[disabled] { opacity: 0.5; cursor: not-allowed; box-shadow: none; transform: none; }
    .status-card { display: flex; flex-direction: column; gap: 18px; color: var(--muted); font-size: 0.95rem; line-height: 1.6; }
    .status-card strong { color: #1e254d; font-size: 1.05rem; }
    footer { text-align: center; padding: 24px 16px 40px; font-size: 0.85rem; color: var(--muted); }
    @keyframes spin { to { transform: rotate(360deg); } }
    @media (max-width: 960px) {
      main { grid-template-columns: 1fr; }
      .actions { justify-content: center; }
    }
  </style>
    <link rel="stylesheet" href="css/header.css">
    <link rel="stylesheet" href="css/theme-modern.css">
</head>
<body>
<header>
        <div class="container">
            <nav class="navbar">
                <a href="index.html" class="logo"><img src="images/logo.png" alt="Logo" style="height:54px;"></a>
                <div class="nav-links">
                    <div class="dropdown">
                        <a href="#">Convert to PDF <i class="fas fa-chevron-down"></i></a>
                        <div class="dropdown-content">
                            <a href="jpg-to-pdf.html">JPG to PDF</a>
                            <a href="word-to-pdf.html">Word to PDF</a>
                            <a href="excel-to-pdf.html">Excel to PDF</a>
                            <a href="ppt-to-pdf.html">PowerPoint to PDF</a>
                        </div>
                    </div>
                    <div class="dropdown">
                        <a href="#">Convert from PDF <i class="fas fa-chevron-down"></i></a>
                        <div class="dropdown-content">
                            <a href="pdf-to-jpg.html">PDF to JPG</a>
                            <a href="pdf-to-word.html">PDF to Word</a>
                            <a href="pdf-to-excel.html">PDF to Excel</a>
                            <a href="pdf-to-ppt.html">PDF to PowerPoint</a>
                        </div>
                    </div>
                    <div class="dropdown">
                        <a href="#">Edit PDF <i class="fas fa-chevron-down"></i></a>
                        <div class="dropdown-content">
                            <a href="merge-pdf.html">Merge PDF</a>
                            <a href="split-pdf.html">Split PDF</a>
                            <a href="compress-pdf.html">Compress PDF</a>
                            <a href="crop-pdf.html">Crop PDF</a>
                            <a href="protect-pdf.html">Protect PDF</a>
                            <a href="unlock-pdf.html">Unlock PDF</a>
                            <a href="add-page-numbers.html">Add Page Numbers</a>
                            <a href="watermark-pdf.html">Watermark PDF</a>
                        </div>
                    </div>
                    <div class="dropdown">
                        <a href="#">Image Tools <i class="fas fa-chevron-down"></i></a>
                        <div class="dropdown-content">
                            <a href="image-compressor.html">Image Compressor</a>
                            <a href="image-resizer.html">Image Resizer</a>
                            <a href="image-editor.html">Image Editor</a>
                            <a href="image-watermark.html">Image Watermark</a>
                            <a href="background-remover.html">Background Remover</a>
                        </div>
                    </div>
                </div>
                <div class="auth-buttons">
                    <button id="auth-button" class="auth-btn">Login</button>
                </div>
            </nav>
        </div>
    </header>

  <main>
    <section class="panel">
      <h2><i class="fas fa-wand-magic-sparkles"></i> Background Removed</h2>
      <div id="previewStage" class="preview-stage">
        <img id="previewOriginal" class="preview-original" alt="Original" hidden>
        <img id="previewResult" class="preview-result" alt="Result" hidden>
        <div id="previewOverlay" class="preview-overlay">
          <div class="preview-spinner"></div>
          <span>AI Processing...</span>
        </div>
        <div id="previewPlaceholder" class="preview-placeholder hidden">
          <i class="fas fa-image" style="font-size:3rem;opacity:0.3;"></i>
          <span>No image loaded</span>
        </div>
      </div>
      <div class="actions">
        <button id="backgroundChange" class="btn btn-outline" disabled>
          <i class="fas fa-palette"></i> Change Background
        </button>
        <button id="downloadPng" class="btn btn-primary" disabled>
          <i class="fas fa-download"></i> Download PNG
        </button>
      </div>
    </section>

    <section class="panel">
      <h2><i class="fas fa-info-circle"></i> Processing Info</h2>
      <div id="statusMessage" class="status-card"></div>
      <div class="status-card">
        <strong>‚úì 3-Tier Smart Processing</strong>
        <p>‚Ä¢ <strong>0-15 MB</strong>: Fast browser (IMG.LY AI) - Free</p>
        <p>‚Ä¢ <strong>15-50 MB</strong>: Free server (Render + Rembg) - Free</p>
        <p>‚Ä¢ <strong>50-100 MB</strong>: Cloud server (Google Cloud Run) - Premium</p>
        <p>‚Ä¢ Automatic routing for optimal speed & cost</p>
        <p>‚Ä¢ Professional AI quality at every tier</p>
      </div>
    </section>
  </main>

  <script type="module">
    const STORAGE_KEYS = {
      original: 'bgRemover:original',
      filename: 'bgRemover:filename',
      foreground: 'bgRemover:foreground',
      dimensions: 'bgRemover:dimensions'
    };

    const previewStage = document.getElementById('previewStage');
    const previewOriginal = document.getElementById('previewOriginal');
    const previewResult = document.getElementById('previewResult');
    const previewOverlay = document.getElementById('previewOverlay');
    const previewPlaceholder = document.getElementById('previewPlaceholder');
    const backgroundChangeBtn = document.getElementById('backgroundChange');
    const downloadBtn = document.getElementById('downloadPng');
    const statusMessage = document.getElementById('statusMessage');

    let resultCanvas = null;
    let resultContext = null;
    let resultDataURL = null;
    let removeBackgroundFn = null;
    let preloadFn = null;

    try {
      ({ removeBackground: removeBackgroundFn, preload: preloadFn } = await import('https://cdn.jsdelivr.net/npm/@imgly/background-removal@1.7.0/dist/index.mjs'));
    } catch (err) {
      showError('AI library failed to load. Please check your connection and refresh.');
      console.error(err);
    }

    function dataURLToBlob(dataURL) {
      const [meta, encoded] = dataURL.split(',');
      const mimeMatch = meta.match(/data:(.*?);/);
      const mime = mimeMatch ? mimeMatch[1] : 'image/png';
      const binary = atob(encoded);
      const len = binary.length;
      const buffer = new Uint8Array(len);
      for (let i = 0; i < len; i++) buffer[i] = binary.charCodeAt(i);
      return new Blob([buffer], { type: mime });
    }

    async function blobFromSource(source, meta) {
      if (!source) return null;
      if (source.startsWith('data:')) {
        return dataURLToBlob(source);
      }
      if (source.startsWith('blob:')) {
        return await new Promise((resolve, reject) => {
          const xhr = new XMLHttpRequest();
          xhr.open('GET', source);
          xhr.responseType = 'blob';
          xhr.onload = () => {
            const responseBlob = xhr.response;
            if (responseBlob && meta?.type && responseBlob.type !== meta.type) {
              resolve(responseBlob.slice(0, responseBlob.size, meta.type));
            } else {
              resolve(responseBlob);
            }
          };
          xhr.onerror = () => reject(new Error('Failed to read blob URL.'));
          xhr.send();
        });
      }
      const response = await fetch(source);
      return await response.blob();
    }

    function blobToDataURL(blob) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = reject;
        reader.readAsDataURL(blob);
      });
    }

    function showError(message) {
      statusMessage.innerHTML = `<div style="padding:16px;border-radius:14px;background:rgba(220,38,38,0.12);color:#7f1d1d;font-weight:600;">${message}</div>`;
    }

    function clearStatus() {
      statusMessage.innerHTML = '';
    }

    function ensureCanvas(width, height) {
      if (!resultCanvas) {
        resultCanvas = document.createElement('canvas');
        resultContext = resultCanvas.getContext('2d');
      }
      resultCanvas.width = width;
      resultCanvas.height = height;
    }

    // ============================================
    // HIGH QUALITY AI BACKGROUND REMOVER
    // 3-Tier Processing System (Fast + Free + Scalable)
    // ============================================
    // Tier 1: 0-15 MB ‚Üí IMG.LY (Browser AI) - Instant, Free, Unlimited
    // Tier 2: 15-50 MB ‚Üí Render Backend (Python Rembg) - Free 750hrs/month
    // Tier 3: 50-100 MB ‚Üí Cloud Run (Docker Rembg) - Free 2M requests/month
    // ============================================
    
    // STEP 1: Render backend URL (DEPLOYED AND LIVE!)
    const RENDER_API_URL = 'https://doctools-bg-remover.onrender.com/remove-background';
    
    // STEP 2: (Optional) Deploy Cloud Run backend for 50+ MB files
    const CLOUDRUN_API_URL = 'https://YOUR-CLOUDRUN-SERVICE.run.app/remove-background';
    
    // Smart routing based on file size (optimized for quality + speed)
    function getProcessingConfig(fileSize) {
      const sizeMB = fileSize / (1024 * 1024);
      
      // Tier 1: Browser AI (IMG.LY U¬≤-Net)
      if (fileSize < 8 * 1024 * 1024) {
        // 0-8 MB: High quality browser processing
        return {
          useBackend: false,
          model: 'medium',
          quality: 0.95,
          description: 'High Quality AI (Browser)',
          message: `Processing ${sizeMB.toFixed(1)} MB with advanced AI`,
          tier: 'browser',
          info: '‚ö° High quality processing, instant results'
        };
      } else if (fileSize < 15 * 1024 * 1024) {
        // 8-15 MB: Browser with medium model for best quality
        return {
          useBackend: false,
          model: 'medium',
          quality: 0.98,
          description: 'Premium Quality AI (Browser)',
          message: `Processing ${sizeMB.toFixed(1)} MB with premium AI`,
          tier: 'browser',
          info: 'üéØ Premium quality, precise edge detection'
        };
      } 
      // Tier 2: Render Backend (Python Rembg)
      else if (fileSize < 50 * 1024 * 1024) {
        // 15-50 MB: Professional server processing (Free)
        return {
          useBackend: true,
          backendUrl: RENDER_API_URL,
          description: 'Professional AI (Free Server)',
          message: `Uploading ${sizeMB.toFixed(1)} MB to professional AI server`,
          tier: 'render',
          info: 'üöÄ Professional quality with Rembg AI (Free)'
        };
      } 
      // Tier 3: Cloud Run Backend (Premium Docker)
      else if (fileSize < 100 * 1024 * 1024) {
        // 50-100 MB: Premium cloud processing with optimization
        return {
          useBackend: true,
          backendUrl: CLOUDRUN_API_URL,
          description: 'Premium AI (Google Cloud)',
          message: `Uploading ${sizeMB.toFixed(1)} MB to premium cloud AI`,
          tier: 'cloudrun',
          info: '‚≠ê Premium quality with alpha matting (Google Cloud)'
        };
      } 
      // Error: File too large
      else {
        return {
          useBackend: false,
          error: true,
          message: `File size ${sizeMB.toFixed(1)} MB exceeds maximum limit of 100 MB. Please compress your image first.`,
          tier: 'error'
        };
      }
    }

    // Process image using backend server (Render or Cloud Run)
    async function processWithBackend(dataURL, backendUrl, config) {
      try {
        // Show upload progress
        statusMessage.innerHTML = `<div style="padding:12px 16px;border-radius:12px;background:rgba(67,97,238,0.08);color:#1f2559;font-weight:600;">üì§ Uploading to ${config.tier === 'render' ? 'Free Server' : 'Premium Cloud'}...</div>`;
        
        // Make API request with timeout
        const controller = new AbortController();
        const timeout = setTimeout(() => controller.abort(), 180000); // 3 min timeout
        
        const response = await fetch(backendUrl, {
          method: 'POST',
          headers: { 
            'Content-Type': 'application/json',
            'Accept': 'application/json'
          },
          body: JSON.stringify({ 
            imageData: dataURL,
            apiKey: 'YOUR_REMOVEBG_API_KEY' // Get free key from remove.bg
          }),
          signal: controller.signal
        });
        
        clearTimeout(timeout);

        if (!response.ok) {
          const errorData = await response.json().catch(() => ({}));
          throw new Error(errorData.error || `Server error: ${response.status}`);
        }

        statusMessage.innerHTML = `<div style="padding:12px 16px;border-radius:12px;background:rgba(34,197,94,0.12);color:#065f46;font-weight:600;">‚ú® Processing with professional AI...</div>`;
        
        const result = await response.json();
        
        if (result.success && result.resultImage) {
          return { 
            success: true, 
            dataUrl: result.resultImage, 
            processedWith: result.processedWith || config.description,
            outputSize: result.outputSize,
            outputSizeMB: result.outputSizeMB
          };
        } else {
          throw new Error(result.error || 'Processing failed on server');
        }
      } catch (error) {
        console.error('‚ùå Backend processing error:', error);
        
        if (error.name === 'AbortError') {
          return { success: false, error: 'Request timeout. File too large or server busy.' };
        }
        
        return { success: false, error: error.message || 'Server connection failed' };
      }
    }

    async function processImage(dataURL) {
      clearStatus();
      previewPlaceholder.classList.add('hidden');
      previewStage.classList.remove('revealed');
      previewStage.classList.remove('empty');
      previewOverlay.style.opacity = 1;

      try {
        previewOriginal.hidden = false;
        previewOriginal.src = dataURL;
        
        // Get file size and optimal config
        const fileSize = Number(sessionStorage.getItem('bgRemover:originalSize') || 0);
        const config = getProcessingConfig(fileSize);
        
        // Check for error (file too large)
        if (config.error) {
          showError(config.message);
          previewStage.classList.add('empty');
          previewOverlay.style.opacity = 0;
          previewPlaceholder.classList.remove('hidden');
          return;
        }
        
        statusMessage.innerHTML = `<div style="padding:12px 16px;border-radius:12px;background:rgba(67,97,238,0.08);color:#1f2559;font-weight:600;">${config.message}...</div>`;

        let resultUrl = null;

        // ===== ROUTE 1: Backend Processing (15+ MB files) =====
        if (config.useBackend) {
          statusMessage.innerHTML = `<div style="padding:12px 16px;border-radius:12px;background:rgba(67,97,238,0.08);color:#1f2559;font-weight:600;">${config.info}</div>`;
          
          const backendResult = await processWithBackend(dataURL, config.backendUrl, config);
          
          if (backendResult.success) {
            resultUrl = backendResult.dataUrl;
            processingMethod = backendResult.processedWith || config.description;
            
            // Log success
            console.log('‚úÖ Backend processing successful:', {
              tier: config.tier,
              outputSize: backendResult.outputSizeMB || 'unknown'
            });
          } else {
            // Backend failed - try browser fallback for smaller files
            console.warn('‚ö†Ô∏è Backend failed:', backendResult.error);
            
            if (removeBackgroundFn && fileSize < 25 * 1024 * 1024) {
              statusMessage.innerHTML = '<div style="padding:12px 16px;border-radius:12px;background:rgba(251,146,60,0.12);color:#7c2d12;font-weight:600;">‚ö†Ô∏è Server busy, switching to browser processing...</div>';
              config.useBackend = false;
              config.model = 'medium';
              config.quality = 0.9;
              console.log('üîÑ Falling back to browser processing');
            } else {
              throw new Error(`Backend processing failed: ${backendResult.error}. File too large for browser fallback.`);
            }
          }
        }

        // Route 2: Use browser processing for small/medium files (0-15 MB)
        if (!config.useBackend && !resultUrl) {
          if (!removeBackgroundFn) {
            showError('AI library not loaded. Please refresh the page.');
            return;
          }

          // Preload AI model
          try {
            if (typeof preloadFn === 'function') {
              await preloadFn({ 
                publicPath: 'https://staticimgly.com/@imgly/background-removal-data/1.7.0/dist/',
                model: config.model
              });
            }
          } catch (err) {
            console.warn('Preload failed, continuing:', err);
          }

          const blob = await blobFromSource(dataURL, {
            type: sessionStorage.getItem('bgRemover:originalType') || 'image/png',
            size: fileSize
          });
          
          if (!blob) throw new Error('Unable to read uploaded image.');
          
          const filename = sessionStorage.getItem(STORAGE_KEYS.filename) || 'photo.png';
          const fileForProcessing = new File([blob], filename, { type: blob.type || 'image/png' });

          // Process with high quality settings and edge preservation
          const result = await removeBackgroundFn(fileForProcessing, {
            publicPath: 'https://staticimgly.com/@imgly/background-removal-data/1.7.0/dist/',
            model: config.model,
            output: { 
              format: 'image/png', 
              quality: config.quality,
              type: 'foreground'
            },
            // Advanced settings for better edge preservation
            postprocessMask: {
              featherRadius: 2  // Smooth edges without over-cleaning
            },
            progress: (key, current, total) => {
              const percent = Math.round((current / total) * 100);
              statusMessage.innerHTML = `<div style="padding:12px 16px;border-radius:12px;background:rgba(67,97,238,0.08);color:#1f2559;font-weight:600;">Processing with ${config.description}... ${percent}%</div>`;
            }
          });

          const resultBlob = result instanceof Blob ? result : await result.blob();
          resultUrl = await blobToDataURL(resultBlob);
        }
        
        // Common result handling for both routes
        if (!resultUrl) {
          throw new Error('Failed to generate result image');
        }
        
        sessionStorage.setItem(STORAGE_KEYS.foreground, resultUrl);

        const foregroundImage = new Image();
        foregroundImage.crossOrigin = 'anonymous';
        foregroundImage.src = resultUrl;
        await foregroundImage.decode();

        previewResult.hidden = false;
        previewResult.src = resultUrl;

        ensureCanvas(foregroundImage.width, foregroundImage.height);
        resultContext.clearRect(0, 0, resultCanvas.width, resultCanvas.height);
        resultContext.drawImage(foregroundImage, 0, 0, resultCanvas.width, resultCanvas.height);
        resultDataURL = resultCanvas.toDataURL('image/png');

        sessionStorage.setItem(STORAGE_KEYS.dimensions, JSON.stringify({ width: resultCanvas.width, height: resultCanvas.height }));
        previewOverlay.style.opacity = 0;
        requestAnimationFrame(() => previewStage.classList.add('revealed'));
        backgroundChangeBtn.disabled = false;
        downloadBtn.disabled = false;
        
        // Success message
        const sizeInMB = (fileSize / (1024 * 1024)).toFixed(1);
        statusMessage.innerHTML = `<div style="padding:12px 16px;border-radius:12px;background:rgba(34,197,94,0.12);color:#065f46;font-weight:600;">‚úì Background removed! (${sizeInMB} MB file processed with ${config.description})</div>`;
        setTimeout(() => clearStatus(), 4000);
        
      } catch (error) {
        console.error('Background removal failed', error);
        let errorMsg = 'Failed to remove background. ';
        if (error.message && error.message.includes('fetch')) {
          errorMsg += 'Network error. Please check your connection and try again.';
        } else if (error.message && error.message.includes('memory')) {
          errorMsg += 'Image too complex. Try a smaller or simpler image.';
        } else {
          errorMsg += 'Please try uploading a different image with clear subject.';
        }
        showError(errorMsg);
        previewStage.classList.add('empty');
        previewOverlay.style.opacity = 0;
        previewPlaceholder.classList.remove('hidden');
      }
    }

    const storedOriginal = sessionStorage.getItem(STORAGE_KEYS.original);
    if (!storedOriginal) {
      previewStage.classList.add('empty');
      previewPlaceholder.classList.remove('hidden');
      showError('No image found. Please upload a file first.');
      backgroundChangeBtn.disabled = true;
      downloadBtn.disabled = true;
    } else {
      processImage(storedOriginal);
    }

    backgroundChangeBtn.addEventListener('click', () => {
      if (backgroundChangeBtn.disabled) return;
      window.location.href = 'background-style.html';
    });

    downloadBtn.addEventListener('click', () => {
      if (!resultDataURL) return;
      const link = document.createElement('a');
      const filename = sessionStorage.getItem(STORAGE_KEYS.filename) || 'background-removed.png';
      link.href = resultDataURL;
      link.download = filename.endsWith('.png') ? filename : `${filename.replace(/\.[^/.]+$/, '') || 'background-removed'}.png`;
      link.click();
    });

    document.getElementById('footerYear').textContent = new Date().getFullYear();
  </script>

<footer>
        <div class="container footer-inner">
            <div class="footer-company-links">
                <span>Company</span>
                <a href="index.html#about">About Us</a>
                <a href="index.html#contact">Contact</a>
                <a href="privacy-policy.html">Privacy Policy</a>
                <a href="terms-of-service.html">Terms of Service</a>
            </div>
            <p class="footer-brand-line">&copy; easyjpgtopdf &mdash; Free PDF &amp; Image Tools for everyone.</p>
            <p class="footer-credits">
                Thanks to Font Awesome, Google Fonts, jsPDF, pdf.js, pdf-lib, Mammoth, Tesseract.js, IMG.LY, Firebase, Unsplash photographers, and every open-source contributor powering this site.
                <a href="attributions.html">See full acknowledgements</a>.
            </p>
        </div>
    </footer>
    <script type="module" src="js/auth.js"></script>
</body>
</html>
