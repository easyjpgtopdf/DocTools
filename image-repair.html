<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>AI Image Repair Tool - Fix Blurry, Scratched &amp; Damaged Photos</title>
<meta content="Repair and enhance your damaged, blurry, or scratched photos with our AI-powered image repair tool. Fix old photos, remove scratches, enhance details, and adjust alignment easily." name="description"/>
<!-- Favicon -->
<link href="images/favicon.png" rel="icon" type="image/png"/>
<!-- CSS -->
<link href="css/style.css" rel="stylesheet"/>
<link href="css/header.css" rel="stylesheet"/>
<link href="css/footer.css" rel="stylesheet"/>
<link href="css/image-tools.css" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.css" rel="stylesheet"/>
<link href="https://cdn.jsdelivr.net/npm/nouislider@15.7.0/dist/nouislider.min.css" rel="stylesheet"/>
<style>
        .tool-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px 20px;
        }
        
        .upload-section {
            background: #f8f9fa;
            border: 2px dashed #ddd;
            border-radius: 10px;
            padding: 40px 20px;
            text-align: center;
            margin-bottom: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .upload-section:hover {
            border-color: #4a6cf7;
            background: #f0f4ff;
        }
        
        .upload-icon {
            font-size: 48px;
            color: #4a6cf7;
            margin-bottom: 15px;
        }
        
        .canvas-container {
            display: flex;
            justify-content: space-between;
            margin: 30px 0;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .canvas-wrapper {
            flex: 1;
            min-width: 300px;
            text-align: center;
        }
        
        .canvas-container canvas {
            max-width: 100%;
            border: 1px solid #ddd;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 15px;
        }
        
        .controls {
            background: #fff;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.05);
            margin-bottom: 30px;
        }
        
        .control-group {
            margin-bottom: 20px;
        }
        
        .control-group h3 {
            margin-top: 0;
            color: #333;
            font-size: 18px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        
        .control-group h3 i {
            margin-right: 10px;
            color: #4a6cf7;
        }
        
        .btn {
            background: #4a6cf7;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn i {
            margin-right: 8px;
        }
        
        .btn:hover {
            background: #3a5bd9;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(74, 108, 247, 0.3);
        }
        
        .btn-outline {
            background: transparent;
            border: 1px solid #4a6cf7;
            color: #4a6cf7;
        }
        
        .btn-outline:hover {
            background: #f0f4ff;
        }
        
        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 20px 0;
        }
        
        .slider-container {
            margin: 15px 0;
        }
        
        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 14px;
            color: #555;
        }
        
        .preview-container {
            display: flex;
            overflow-x: auto;
            gap: 15px;
            padding: 15px 0;
            margin: 20px 0;
        }
        
        .preview-item {
            min-width: 100px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            border-radius: 5px;
            padding: 5px;
        }
        
        .preview-item:hover, .preview-item.active {
            border-color: #4a6cf7;
        }
        
        .preview-item img {
            width: 100%;
            height: 80px;
            object-fit: cover;
            border-radius: 3px;
        }
        
        .preview-item p {
            margin: 5px 0 0;
            font-size: 12px;
            color: #666;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4a6cf7;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .ai-suggestions {
            margin-top: 30px;
        }
        
        .suggestion-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
            display: flex;
            align-items: center;
        }
        
        .suggestion-title i {
            margin-right: 10px;
            color: #4a6cf7;
        }
        
        .suggestion-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .suggestion-card {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .suggestion-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
        }
        
        .suggestion-img {
            width: 100%;
            height: 100px;
            object-fit: cover;
        }
        
        .suggestion-label {
            padding: 10px;
            text-align: center;
            font-size: 13px;
            color: #555;
        }
        
        .manual-adjust {
            margin-top: 30px;
        }
        
        .corner-handle {
            width: 20px;
            height: 20px;
            background-color: #4a6cf7;
            border: 2px solid white;
            border-radius: 50%;
            position: absolute;
            cursor: move;
            z-index: 1000;
        }
        
        .corner-handle.tl { top: -10px; left: -10px; }
        .corner-handle.tr { top: -10px; right: -10px; }
        .corner-handle.bl { bottom: -10px; left: -10px; }
        .corner-handle.br { bottom: -10px; right: -10px; }
        
        .edge-handle {
            background-color: #4a6cf7;
            border: 2px solid white;
            position: absolute;
            z-index: 1000;
        }
        
        .edge-handle.t { left: 50%; top: -5px; transform: translateX(-50%); width: 80%; height: 10px; cursor: ns-resize; }
        .edge-handle.b { left: 50%; bottom: -5px; transform: translateX(-50%); width: 80%; height: 10px; cursor: ns-resize; }
        .edge-handle.l { top: 50%; left: -5px; transform: translateY(-50%); width: 10px; height: 80%; cursor: ew-resize; }
        .edge-handle.r { top: 50%; right: -5px; transform: translateY(-50%); width: 10px; height: 80%; cursor: ew-resize; }
        
        .canvas-wrapper {
            position: relative;
            display: inline-block;
        }
        
        .canvas-container-wrapper {
            position: relative;
            display: inline-block;
            margin: 20px 0;
        }
        
        @media (max-width: 768px) {
            .canvas-container {
                flex-direction: column;
            }
            
            .canvas-wrapper {
                width: 100%;
                margin-bottom: 20px;
            }
            
            .btn-group {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
<!-- Header -->
<header>
<div class="container">
<nav class="navbar">
<a class="logo" href="index.html"><img alt="Logo" src="images/logo.png" style="height:54px;"/></a>
<div class="nav-links">
<div class="dropdown">
<a href="#">Convert to PDF <i class="fas fa-chevron-down"></i></a>
<div class="dropdown-content">
<a href="jpg-to-pdf.html">JPG to PDF</a>
<a href="word-to-pdf.html">Word to PDF</a>
<a href="excel-to-pdf.html">Excel to PDF</a>
<a href="ppt-to-pdf.html">PowerPoint to PDF</a>
</div>
</div>
<div class="dropdown">
<a href="#">Convert from PDF <i class="fas fa-chevron-down"></i></a>
<div class="dropdown-content">
<a href="pdf-to-jpg.html">PDF to JPG</a>
<a href="pdf-to-word.html">PDF to Word</a>
<a href="pdf-to-excel.html">PDF to Excel</a>
<a href="pdf-to-ppt.html">PDF to PowerPoint</a>
</div>
</div>
<div class="dropdown">
<a href="#">Pdf Editor <i class="fas fa-chevron-down"></i></a>
<div class="dropdown-content">
<a href="merge-pdf.html">Merge PDF</a>
<a href="split-pdf.html">Split PDF</a>
<a href="compress-pdf.html">Compress PDF</a>
<a href="edit-pdf.html">Edit PDF</a>
<a href="protect-pdf.html">Protect PDF</a>
<a href="unlock-pdf.html">Unlock PDF</a>
<a href="watermark-pdf.html">Watermark PDF</a>
<a href="crop-pdf.html">Crop PDF</a>
<a href="add-page-numbers.html">Add Page Numbers</a>
</div>
</div>
<div class="dropdown">
<a href="#">Image Tools <i class="fas fa-chevron-down"></i></a>
<div class="dropdown-content"><a class="active" href="image-repair.html">AI Image Repair</a><a class="active" href="image-compressor.html">Image Compressor</a><a class="active" href="image-resizer.html">Image Resizer</a><a class="active" href="image-editor.html">Image Editor</a><a class="active" href="background-remover.html">Background Remover</a><a class="active" href="ocr-image.html">OCR Image</a><a class="active" href="image-watermark.html">Image Watermark</a></div>
</div>
<div class="dropdown">
<a href="#">Design Tools <i class="fas fa-chevron-down"></i></a>
<div class="dropdown-content">
<a href="resume-maker.html">Resume Maker</a>
<a href="biodata-maker.html">Marriage Biodata Maker</a>
<a href="ai-image-generator.html">AI Image Generator</a>
<a href="marriage-card.html">Marriage Card</a>
</div>
</div>
<div class="dropdown">
<a href="#">Other Tools <i class="fas fa-chevron-down"></i></a>
<div class="dropdown-content">
<a href="excel-unlocker.html">Excel Unlocker</a>
<a href="protect-excel.html">Protect Excel Sheet</a>
</div>
</div>
</div>
<div class="auth-buttons">
<a class="auth-link" href="login.html">Sign In</a>
<a class="auth-btn" href="signup.html"><i aria-hidden="true" class="fas fa-user-plus"></i><span>Signup</span></a>
</div>
<div class="user-menu" data-open="false" id="user-menu">
<button aria-expanded="false" aria-haspopup="true" aria-label="Account menu" class="user-menu-toggle" id="user-menu-toggle" type="button">
<span aria-hidden="true" class="user-initial">U</span>
<i aria-hidden="true" class="fas fa-chevron-down"></i>
</button>
<div class="user-dropdown" hidden="" id="user-dropdown">
<a href="dashboard.html">Dashboard</a>
<a href="accounts.html">Account Settings</a>
<a href="kyc-support.html">KYC Support</a>
<a href="payment-receipt.html">Payment Receipt</a>
<a href="#" id="logout-button">Logout</a>
</div>
</div>
</nav>
</div>
</header>
<!-- Main Content -->
<main class="tool-container">
<h1>AI Image Repair Tool</h1>
<p class="subtitle">Fix blurry, scratched, or damaged photos with our powerful AI technology</p>
<div class="upload-section" id="dropZone">
<div class="upload-icon">
<i class="fas fa-cloud-upload-alt"></i>
</div>
<h3>Drag &amp; Drop your image here</h3>
<p>or</p>
<input accept="image/*" id="fileInput" style="display: none;" type="file"/>
<button class="btn" id="selectFileBtn"><i class="fas fa-folder-open"></i> Select Image</button>
<p class="file-requirements">Supports JPG, PNG, WEBP (Max 20MB)</p>
</div>
<div id="editorSection" style="display: none;">
<div class="canvas-container">
<div class="canvas-wrapper">
<h3>Original Image</h3>
<div class="canvas-container-wrapper">
<canvas id="originalCanvas"></canvas>
</div>
</div>
<div class="canvas-wrapper">
<h3>Repaired Image <span id="processingIndicator" style="display: none;"><i class="fas fa-spinner fa-spin"></i> Processing...</span></h3>
<div class="canvas-container-wrapper">
<canvas id="resultCanvas"></canvas>
</div>
</div>
</div>
<div class="controls">
<div class="control-group">
<h3><i class="fas fa-magic"></i> AI Repair Options</h3>
<p>Select the type of repair needed for your image:</p>
<div class="btn-group">
<button class="btn btn-outline" id="btnAutoFix">
<i class="fas fa-robot"></i> Auto Fix All Issues
                        </button>
<button class="btn btn-outline" id="btnRemoveScratches">
<i class="fas fa-broom"></i> Remove Scratches
                        </button>
<button class="btn btn-outline" id="btnEnhanceQuality">
<i class="fas fa-star"></i> Enhance Quality
                        </button>
</div>
<div class="slider-container">
<div class="slider-label">
<span>Repair Intensity</span>
<span id="intensityValue">50%</span>
</div>
<div class="slider" id="intensitySlider"></div>
</div>
</div>
<div class="manual-adjust">
<h3><i class="fas fa-crop-alt"></i> Manual Adjustments</h3>
<p>Fine-tune the image alignment and perspective:</p>
<div class="btn-group">
<button class="btn btn-outline" id="btnCrop">
<i class="fas fa-crop"></i> Crop
                        </button>
<button class="btn btn-outline" id="btnRotate">
<i class="fas fa-sync-alt"></i> Rotate
                        </button>
<button class="btn btn-outline" id="btnPerspective">
<i class="fas fa-vector-square"></i> Fix Perspective
                        </button>
<button class="btn btn-outline" id="btnReset">
<i class="fas fa-undo"></i> Reset
                        </button>
</div>
<div id="cropControls" style="display: none; margin-top: 15px;">
<p>Drag the corners to adjust the crop area</p>
<div class="btn-group">
<button class="btn" id="btnCropApply">Apply Crop</button>
<button class="btn btn-outline" id="btnCropCancel">Cancel</button>
</div>
</div>
</div>
<div class="ai-suggestions">
<div class="suggestion-title">
<i class="fas fa-lightbulb"></i> AI Suggestions
                    </div>
<p>Our AI has detected the following issues that can be fixed:</p>
<div class="suggestion-grid" id="aiSuggestions">
<!-- AI suggestions will be added here dynamically -->
</div>
</div>
<div class="btn-group" style="margin-top: 30px; justify-content: center;">
<button class="btn" disabled="" id="btnDownload">
<i class="fas fa-download"></i> Download Repaired Image
                    </button>
<button class="btn btn-outline" id="btnNewImage">
<i class="fas fa-plus"></i> New Image
                    </button>
</div>
</div>
</div>
<div class="loading" id="loadingIndicator">
<div class="loading-spinner"></div>
<p>Processing your image with AI. This may take a few moments...</p>
</div>
<section class="tools-section"><div class="section-title"><h2>More Image Tools</h2></div><div class="tools-grid"><a class="tool-card active" href="image-repair.html"><div class="tool-icon"><i class="fas fa-magic"></i></div><div class="tool-content"><h3>AI Image Repair</h3><p>Fix blurry, scratched, or damaged photos with AI</p></div></a><a class="tool-card" href="image-compressor.html"><div class="tool-icon"><i class="fas fa-compress-arrows-alt"></i></div><div class="tool-content"><h3>Image Compressor</h3><p>Reduce image file size without losing quality</p></div></a><a class="tool-card" href="image-resizer.html"><div class="tool-icon"><i class="fas fa-expand-arrows-alt"></i></div><div class="tool-content"><h3>Image Resizer</h3><p>Resize images to any dimension</p></div></a><a class="tool-card" href="image-editor.html"><div class="tool-icon"><i class="fas fa-edit"></i></div><div class="tool-content"><h3>Image Editor</h3><p>Edit and enhance your images online</p></div></a><a class="tool-card" href="background-remover.html"><div class="tool-icon"><i class="fas fa-eraser"></i></div><div class="tool-content"><h3>Background Remover</h3><p>Remove background from images automatically</p></div></a><a class="tool-card" href="ocr-image.html"><div class="tool-icon"><i class="fas fa-font"></i></div><div class="tool-content"><h3>OCR Image</h3><p>Extract text from images with OCR technology</p></div></a><a class="tool-card" href="image-watermark.html"><div class="tool-icon"><i class="fas fa-water"></i></div><div class="tool-content"><h3>Image Watermark</h3><p>Add watermarks to protect your images</p></div></a></div></section></main>
<!-- Footer -->
<footer>
<div class="container footer-inner">
<div class="footer-company-links">
<span>Company</span>
<a href="index.html#about">About Us</a>
<a href="index.html#contact">Contact</a>
<a href="privacy-policy.html">Privacy Policy</a>
<a href="terms-of-service.html">Terms of Service</a>
</div>
<p class="footer-brand-line">&copy; easyjpgtopdf &mdash; Free PDF &amp; Image Tools for everyone.</p>
<p class="footer-credits">
Thanks to Font Awesome, Google Fonts, jsPDF, pdf.js, pdf-lib, Mammoth, Tesseract.js, IMG.LY, Firebase, Unsplash photographers, and every open-source contributor powering this site.
<a href="attributions.html">See full acknowledgements</a>.
</p>
</div>
</footer>
<!-- JavaScript -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/nouislider@15.7.0/dist/nouislider.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/wnumb@1.2.0/wNumb.min.js"></script>
<script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM Elements
            const fileInput = document.getElementById('fileInput');
            const selectFileBtn = document.getElementById('selectFileBtn');
            const dropZone = document.getElementById('dropZone');
            const originalCanvas = document.getElementById('originalCanvas');
            const resultCanvas = document.getElementById('resultCanvas');
            const editorSection = document.getElementById('editorSection');
            const loadingIndicator = document.getElementById('loadingIndicator');
            const processingIndicator = document.getElementById('processingIndicator');
            const btnDownload = document.getElementById('btnDownload');
            const btnNewImage = document.getElementById('btnNewImage');
            const btnAutoFix = document.getElementById('btnAutoFix');
            const btnRemoveScratches = document.getElementById('btnRemoveScratches');
            const btnEnhanceQuality = document.getElementById('btnEnhanceQuality');
            const btnCrop = document.getElementById('btnCrop');
            const btnRotate = document.getElementById('btnRotate');
            const btnPerspective = document.getElementById('btnPerspective');
            const btnReset = document.getElementById('btnReset');
            const btnCropApply = document.getElementById('btnCropApply');
            const btnCropCancel = document.getElementById('btnCropCancel');
            const cropControls = document.getElementById('cropControls');
            const aiSuggestions = document.getElementById('aiSuggestions');
            
            // Variables
            let originalImage = null;
            let processedImage = null;
            let isProcessing = false;
            let cropMode = false;
            
            // Initialize Fabric.js canvases
            const originalFabric = new fabric.Canvas('originalCanvas', {
                backgroundColor: '#f5f5f5',
                selection: false
            });
            
            const resultFabric = new fabric.Canvas('resultCanvas', {
                backgroundColor: '#f5f5f5',
                selection: false
            });
            
            // Initialize noUiSlider for intensity
            const intensitySlider = document.getElementById('intensitySlider');
            const intensityValue = document.getElementById('intensityValue');
            
            noUiSlider.create(intensitySlider, {
                start: 50,
                connect: [true, false],
                range: {
                    'min': 0,
                    'max': 100
                },
                format: wNumb({
                    decimals: 0,
                    suffix: '%'
                })
            });
            
            intensitySlider.noUiSlider.on('update', function(values, handle) {
                intensityValue.textContent = values[handle];
            });
            
            // Event Listeners
            selectFileBtn.addEventListener('click', () => fileInput.click());
            
            fileInput.addEventListener('change', handleFileSelect);
            
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.style.borderColor = '#4a6cf7';
                dropZone.style.background = '#f0f4ff';
            });
            
            dropZone.addEventListener('dragleave', () => {
                dropZone.style.borderColor = '#ddd';
                dropZone.style.background = '#f8f9fa';
            });
            
            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.style.borderColor = '#ddd';
                dropZone.style.background = '#f8f9fa';
                
                if (e.dataTransfer.files.length) {
                    fileInput.files = e.dataTransfer.files;
                    handleFileSelect({ target: fileInput });
                }
            });
            
            btnDownload.addEventListener('click', downloadImage);
            btnNewImage.addEventListener('click', resetEditor);
            btnAutoFix.addEventListener('click', () => processImage('auto_fix'));
            btnRemoveScratches.addEventListener('click', () => processImage('remove_scratches'));
            btnEnhanceQuality.addEventListener('click', () => processImage('enhance_quality'));
            btnCrop.addEventListener('click', toggleCropMode);
            btnRotate.addEventListener('click', rotateImage);
            btnPerspective.addEventListener('click', fixPerspective);
            btnReset.addEventListener('click', resetImage);
            btnCropApply.addEventListener('click', applyCrop);
            btnCropCancel.addEventListener('click', cancelCrop);
            
            // Functions
            function handleFileSelect(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                if (!file.type.match('image.*')) {
                    alert('Please select a valid image file (JPG, PNG, WEBP)');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    const img = new Image();
                    img.onload = function() {
                        // Show editor section and hide upload section
                        dropZone.style.display = 'none';
                        editorSection.style.display = 'block';
                        
                        // Set image to canvas
                        setImageToCanvas(img);
                        
                        // Generate AI suggestions
                        generateAISuggestions();
                    };
                    img.src = event.target.result;
                };
                reader.readAsDataURL(file);
            }
            
            function setImageToCanvas(img) {
                // Clear existing content
                originalFabric.clear();
                resultFabric.clear();
                
                // Calculate dimensions to fit canvas
                const maxWidth = 500;
                const maxHeight = 500;
                let width = img.width;
                let height = img.height;
                
                if (width > maxWidth || height > maxHeight) {
                    const ratio = Math.min(maxWidth / width, maxHeight / height);
                    width = width * ratio;
                    height = height * ratio;
                }
                
                // Set canvas dimensions
                originalFabric.setDimensions({ width: width, height: height });
                resultFabric.setDimensions({ width: width, height: height });
                
                // Add image to canvas
                originalImage = new fabric.Image(img, {
                    left: 0,
                    top: 0,
                    scaleX: width / img.width,
                    scaleY: height / img.height,
                    selectable: false
                });
                
                originalFabric.add(originalImage);
                
                // Set initial processed image (original)
                processedImage = originalImage.clone();
                resultFabric.add(processedImage);
                
                // Enable download button
                btnDownload.disabled = false;
            }
            
            function processImage(mode) {
                if (isProcessing) return;
                
                isProcessing = true;
                processingIndicator.style.display = 'inline';
                loadingIndicator.style.display = 'block';
                
                // Simulate AI processing (in a real app, this would be an API call)
                setTimeout(() => {
                    // Get the current image data
                    const imageData = originalFabric.toDataURL({
                        format: 'jpeg',
                        quality: 0.9
                    });
                    
                    // In a real app, you would send this to your AI backend
                    // For demo purposes, we'll just add a filter to simulate processing
                    const img = new Image();
                    img.onload = function() {
                        resultFabric.clear();
                        
                        // Apply different effects based on mode
                        switch (mode) {
                            case 'auto_fix':
                                // Simulate auto-fix with contrast and sharpness
                                applyAutoFix(img);
                                break;
                            case 'remove_scratches':
                                // Simulate scratch removal
                                applyScratchRemoval(img);
                                break;
                            case 'enhance_quality':
                                // Simulate quality enhancement
                                applyQualityEnhancement(img);
                                break;
                            default:
                                // Default to original
                                setProcessedImage(img);
                        }
                        
                        isProcessing = false;
                        processingIndicator.style.display = 'none';
                        loadingIndicator.style.display = 'none';
                    };
                    img.src = imageData;
                    
                }, 1500); // Simulate processing time
            }
            
            function applyAutoFix(img) {
                // In a real app, this would be done by an AI model
                // For demo, we'll just apply some basic filters
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                canvas.width = img.width;
                canvas.height = img.height;
                
                // Draw original image
                ctx.drawImage(img, 0, 0);
                
                // Get image data
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                const data = imageData.data;
                
                // Simple auto-contrast and brightness adjustment
                for (let i = 0; i < data.length; i += 4) {
                    // Auto contrast
                    data[i] = (data[i] - 128) * 1.2 + 128; // Red
                    data[i + 1] = (data[i + 1] - 128) * 1.2 + 128; // Green
                    data[i + 2] = (data[i + 2] - 128) * 1.2 + 128; // Blue
                    
                    // Clamp values to 0-255
                    data[i] = Math.max(0, Math.min(255, data[i]));
                    data[i + 1] = Math.max(0, Math.min(255, data[i + 1]));
                    data[i + 2] = Math.max(0, Math.min(255, data[i + 2]));
                }
                
                ctx.putImageData(imageData, 0, 0);
                
                // Add some sharpening (simplified)
                ctx.filter = 'contrast(1.1) saturate(1.1)';
                ctx.drawImage(canvas, 0, 0);
                ctx.filter = 'none';
                
                // Set the processed image
                setProcessedImage(canvas);
            }
            
            function applyScratchRemoval(img) {
                // In a real app, this would use advanced algorithms
                // For demo, we'll just apply a slight blur to simulate scratch removal
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                canvas.width = img.width;
                canvas.height = img.height;
                
                // Apply a slight blur to simulate scratch removal
                ctx.filter = 'blur(0.8px)';
                ctx.drawImage(img, 0, 0);
                ctx.filter = 'none';
                
                // Set the processed image
                setProcessedImage(canvas);
            }
            
            function applyQualityEnhancement(img) {
                // In a real app, this would use super-resolution or similar
                // For demo, we'll just apply some sharpening and contrast
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                canvas.width = img.width;
                canvas.height = img.height;
                
                // Draw original image
                ctx.drawImage(img, 0, 0);
                
                // Apply some sharpening
                ctx.filter = 'contrast(1.1) saturate(1.2)';
                ctx.drawImage(canvas, 0, 0);
                ctx.filter = 'none';
                
                // Set the processed image
                setProcessedImage(canvas);
            }
            
            function setProcessedImage(imageElement) {
                resultFabric.clear();
                
                fabric.Image.fromURL(imageElement.src || imageElement.toDataURL(), function(img) {
                    processedImage = img.set({
                        left: 0,
                        top: 0,
                        scaleX: originalImage.scaleX,
                        scaleY: originalImage.scaleY,
                        selectable: false
                    });
                    
                    resultFabric.add(processedImage);
                    resultFabric.renderAll();
                });
            }
            
            function toggleCropMode() {
                cropMode = !cropMode;
                
                if (cropMode) {
                    // Enable crop mode
                    btnCrop.classList.add('active');
                    cropControls.style.display = 'block';
                    
                    // Add crop handles to the result canvas
                    addCropHandles();
                } else {
                    // Disable crop mode
                    btnCrop.classList.remove('active');
                    cropControls.style.display = 'none';
                    
                    // Remove crop handles
                    removeCropHandles();
                }
            }
            
            function addCropHandles() {
                // In a real app, you would add draggable handles to the canvas
                // For demo, we'll just show a border to indicate crop mode
                resultCanvas.style.border = '2px dashed #4a6cf7';
                
                // Add a transparent rectangle for the crop area
                const cropRect = new fabric.Rect({
                    left: 50,
                    top: 50,
                    width: resultFabric.width - 100,
                    height: resultFabric.height - 100,
                    fill: 'rgba(0,0,0,0.3)',
                    stroke: '#4a6cf7',
                    strokeWidth: 2,
                    selectable: true,
                    hasControls: true,
                    hasBorders: true,
                    lockRotation: true,
                    lockScalingFlip: true
                });
                
                resultFabric.add(cropRect);
                resultFabric.setActiveObject(cropRect);
                resultFabric.renderAll();
            }
            
            function removeCropHandles() {
                resultCanvas.style.border = '1px solid #ddd';
                
                // Remove any existing crop rectangles
                resultFabric.getObjects().forEach(obj => {
                    if (obj.type === 'rect') {
                        resultFabric.remove(obj);
                    }
                });
                
                resultFabric.discardActiveObject();
                resultFabric.renderAll();
            }
            
            function applyCrop() {
                // In a real app, you would apply the crop to the image
                // For demo, we'll just exit crop mode
                toggleCropMode();
                alert('Crop applied! (Demo: In a real app, this would crop the image)');
            }
            
            function cancelCrop() {
                toggleCropMode();
            }
            
            function rotateImage() {
                // Rotate the processed image 90 degrees
                if (processedImage) {
                    processedImage.angle = (processedImage.angle || 0) + 90;
                    resultFabric.renderAll();
                }
            }
            
            function fixPerspective() {
                // In a real app, this would allow the user to adjust perspective
                // For demo, we'll just show a message
                alert('Perspective tool activated! Drag the corners to adjust the perspective.');
            }
            
            function resetImage() {
                // Reset to original image
                if (originalImage) {
                    resultFabric.clear();
                    processedImage = originalImage.clone();
                    resultFabric.add(processedImage);
                    resultFabric.renderAll();
                }
            }
            
            function generateAISuggestions() {
                // In a real app, this would analyze the image and provide suggestions
                // For demo, we'll show some example suggestions
                const suggestions = [
                    { id: 'fix_contrast', label: 'Enhance Contrast', icon: 'fa-sun' },
                    { id: 'remove_noise', label: 'Remove Noise', icon: 'fa-broom' },
                    { id: 'color_correct', label: 'Color Correction', icon: 'fa-fill-drip' },
                    { id: 'sharpen', label: 'Sharpen Details', icon: 'fa-search-plus' },
                    { id: 'fix_red_eye', label: 'Fix Red Eye', icon: 'fa-eye' },
                    { id: 'whiten_teeth', label: 'Whiten Teeth', icon: 'fa-tooth' }
                ];
                
                // Clear existing suggestions
                aiSuggestions.innerHTML = '';
                
                // Add new suggestions
                suggestions.forEach(suggestion => {
                    const suggestionEl = document.createElement('div');
                    suggestionEl.className = 'suggestion-card';
                    suggestionEl.innerHTML = `
                        <div class="suggestion-img" style="background: #f0f4ff; display: flex; align-items: center; justify-content: center; color: #4a6cf7;">
                            <i class="fas ${suggestion.icon} fa-2x"></i>
                        </div>
                        <div class="suggestion-label">${suggestion.label}</div>
                    `;
                    
                    suggestionEl.addEventListener('click', () => {
                        // In a real app, this would apply the specific enhancement
                        alert(`Applying ${suggestion.label}... (Demo)`);
                    });
                    
                    aiSuggestions.appendChild(suggestionEl);
                });
            }
            
            function downloadImage() {
                if (!processedImage) return;
                
                // Create a temporary link
                const link = document.createElement('a');
                link.download = 'repaired-image.jpg';
                
                // Get the canvas data URL
                const dataURL = resultFabric.toDataURL({
                    format: 'jpeg',
                    quality: 0.9
                });
                
                link.href = dataURL;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
            
            function resetEditor() {
                // Reset file input
                fileInput.value = '';
                
                // Clear canvases
                originalFabric.clear();
                resultFabric.clear();
                
                // Hide editor and show upload section
                editorSection.style.display = 'none';
                dropZone.style.display = 'flex';
                
                // Reset buttons
                btnDownload.disabled = true;
                processingIndicator.style.display = 'none';
                loadingIndicator.style.display = 'none';
                
                // Exit crop mode if active
                if (cropMode) {
                    toggleCropMode();
                }
            }
            
            // Handle window resize
            window.addEventListener('resize', function() {
                if (originalImage) {
                    // Recalculate canvas dimensions on window resize
                    const img = originalImage.getElement();
                    const maxWidth = Math.min(500, window.innerWidth * 0.9);
                    const maxHeight = 500;
                    let width = img.width;
                    let height = img.height;
                    
                    if (width > maxWidth || height > maxHeight) {
                        const ratio = Math.min(maxWidth / width, maxHeight / height);
                        width = width * ratio;
                        height = height * ratio;
                    }
                    
                    originalFabric.setDimensions({ width: width, height: height });
                    resultFabric.setDimensions({ width: width, height: height });
                    
                    // Update image scale
                    if (originalImage) {
                        originalImage.scaleX = width / originalImage.width;
                        originalImage.scaleY = height / originalImage.height;
                        originalFabric.renderAll();
                    }
                    
                    if (processedImage) {
                        processedImage.scaleX = width / processedImage.width;
                        processedImage.scaleY = height / processedImage.height;
                        resultFabric.renderAll();
                    }
                }
            });
        });
    </script>
</body>
</html>
