<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>PDF to Word Premium - OCR Conversion | High Accuracy Word Export | easyjpgtopdf</title>
<meta name="description" content="Premium PDF to Word conversion with OCR technology. High-accuracy text extraction for scanned PDFs, complex documents, and multi-page files. Enterprise-grade Google Document AI processing.">
<meta name="keywords" content="pdf to word premium, pdf to word ocr, scanned pdf to word, premium pdf converter, ocr pdf to word, document ai word, high accuracy pdf conversion">
<meta name="robots" content="index, follow">
<meta name="author" content="easyjpgtopdf">
<link rel="canonical" href="https://easyjpgtopdf.com/pdf-to-word-premium.html">
<link rel="stylesheet" href="css/header.css">
<link href="css/footer.css" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script>pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';</script>
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    :root {
        --primary: #4361ee;
        --secondary: #3a0ca3;
        --accent: #4cc9f0;
        --light: #f8f9fa;
        --dark: #0f172a;
        --muted: #6b7280;
        --surface: #ffffff;
        --border: #e5e7eb;
        --success: #0f9d58;
        --danger: #dc2626;
    }
    body {
        background: #f5f7ff;
        min-height: 100vh;
        color: var(--dark);
        line-height: 1.6;
    }
    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 24px;
        width: 100%;
    }
    .hero {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: #fff;
        padding: 48px 0;
        text-align: center;
    }
    .hero h1 {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 12px;
    }
    .hero p {
        font-size: 1.1rem;
        opacity: 0.9;
    }
    .premium-section {
        padding: 60px 0;
    }
    .premium-card {
        background: var(--surface);
        border-radius: 16px;
        padding: 40px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        margin-bottom: 24px;
    }
    .premium-card h2 {
        color: var(--primary);
        margin-bottom: 20px;
        font-size: 1.75rem;
    }
    .upload-area {
        border: 2px dashed var(--border);
        border-radius: 12px;
        padding: 40px;
        text-align: center;
        background: var(--light);
        margin: 24px 0;
        transition: all 0.3s;
    }
    .upload-area.dragover {
        border-color: var(--primary);
        background: rgba(67, 97, 238, 0.05);
    }
    .upload-area i {
        font-size: 3rem;
        color: var(--primary);
        margin-bottom: 16px;
    }
    .btn {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 14px 28px;
        border-radius: 30px;
        border: none;
        font-weight: 600;
        cursor: pointer;
        transition: 0.2s ease;
        text-decoration: none;
        font-size: 1rem;
    }
    .btn-primary {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: #fff;
        box-shadow: 0 4px 16px rgba(67, 97, 238, 0.3);
    }
    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(67, 97, 238, 0.4);
    }
    .btn-secondary {
        background: var(--light);
        color: var(--dark);
        border: 1px solid var(--border);
    }
    .btn-secondary:hover {
        background: var(--border);
    }
    .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }
    .progress-bar {
        width: 100%;
        height: 8px;
        background: var(--light);
        border-radius: 4px;
        overflow: hidden;
        margin: 20px 0;
        display: none;
    }
    .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, var(--primary), var(--accent));
        width: 0%;
        transition: width 0.3s;
    }
    .status-message {
        padding: 16px;
        border-radius: 8px;
        margin: 16px 0;
        display: none;
    }
    .status-message.success {
        background: rgba(15, 157, 88, 0.1);
        color: var(--success);
        border-left: 4px solid var(--success);
    }
    .status-message.error {
        background: rgba(220, 38, 38, 0.1);
        color: var(--danger);
        border-left: 4px solid var(--danger);
    }
    .status-message.info {
        background: rgba(67, 97, 238, 0.1);
        color: var(--primary);
        border-left: 4px solid var(--primary);
    }
    .file-info {
        display: none;
        padding: 16px;
        background: var(--light);
        border-radius: 8px;
        margin: 16px 0;
    }
    .file-info.show {
        display: block;
    }
    .credit-info {
        padding: 16px;
        background: linear-gradient(135deg, rgba(67, 97, 238, 0.1), rgba(67, 97, 238, 0.05));
        border-radius: 8px;
        margin: 20px 0;
        text-align: center;
        border-left: 4px solid var(--primary);
    }
    .back-link {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        color: var(--primary);
        text-decoration: none;
        font-weight: 600;
        margin-bottom: 24px;
        transition: color 0.3s;
    }
    .back-link:hover {
        color: var(--secondary);
    }
    .breadcrumb-nav {
        padding: 15px 0;
        background: #f8f9ff;
        border-bottom: 1px solid #e2e6ff;
    }
    .breadcrumb-nav .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 24px;
    }
    .breadcrumb-nav ol {
        list-style: none;
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin: 0;
        padding: 0;
        align-items: center;
    }
    .breadcrumb-nav a {
        color: #4361ee;
        text-decoration: none;
        font-weight: 500;
        transition: color 0.3s;
    }
    .breadcrumb-nav a:hover {
        color: #3a0ca3;
    }
    .breadcrumb-nav span {
        margin: 0 8px;
        color: #9ca3af;
    }
    .ssl-badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 12px;
        background: rgba(15, 157, 88, 0.1);
        color: var(--success);
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
        margin-top: 12px;
    }
    .seo-content {
        max-width: 1200px;
        margin: 40px auto;
        padding: 0 24px;
    }
    .seo-section {
        background: var(--surface);
        border-radius: 16px;
        padding: 32px;
        margin-bottom: 24px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.05);
    }
    .seo-section h2 {
        color: var(--primary);
        font-size: 1.75rem;
        margin-bottom: 16px;
    }
    .seo-section h3 {
        color: var(--dark);
        font-size: 1.25rem;
        margin-top: 24px;
        margin-bottom: 12px;
    }
    .seo-section p {
        color: var(--muted);
        line-height: 1.8;
        margin-bottom: 12px;
    }
    .seo-section ul {
        list-style: none;
        padding: 0;
    }
    .seo-section ul li {
        padding: 8px 0;
        padding-left: 24px;
        position: relative;
    }
    .seo-section ul li:before {
        content: "✓";
        position: absolute;
        left: 0;
        color: var(--success);
        font-weight: bold;
    }
    .upload-area.disabled {
        opacity: 0.6;
        cursor: not-allowed;
        pointer-events: none;
    }
</style>
</head>
<body>
<div id="global-header-placeholder"></div>

<!-- Breadcrumb Navigation -->
<nav aria-label="Breadcrumb" class="breadcrumb-nav">
    <div class="container">
        <ol>
            <li><a href="index.html">Home</a></li>
            <li><span>|</span></li>
            <li><a href="pdf-to-word-converter.html">PDF to Word</a></li>
            <li><span>|</span></li>
            <li>Premium</li>
        </ol>
    </div>
</nav>

<div class="hero">
    <div class="container">
        <h1><i class="fas fa-star"></i> Premium PDF to Word Conversion</h1>
        <p>High-accuracy OCR-powered conversion for scanned PDFs and complex documents</p>
        <div class="ssl-badge">
            <i class="fas fa-lock"></i> SSL Secured
        </div>
    </div>
</div>

<main class="premium-section">
    <div class="container">
        <a href="pdf-to-word-converter.html" class="back-link">
            <i class="fas fa-arrow-left"></i> Back to Basic Conversion
        </a>

        <div class="premium-card">
            <h2><i class="fas fa-file-word"></i> Upload PDF for Premium Conversion</h2>
            
            <div id="creditInfo" class="credit-info" style="display: none;">
                <strong>Your Credits:</strong> <span id="creditBalance">0</span>
                <br>
                <small>Premium conversion requires minimum 30 credits. Credits are deducted per page after successful conversion (2 credits/page).</small>
            </div>

            <div class="upload-area" id="uploadArea">
                <i class="fas fa-cloud-upload-alt"></i>
                <h3>Drop PDF file here or click to browse</h3>
                <p style="color: var(--muted); margin-top: 8px;">Maximum file size: 50 MB</p>
                <input type="file" id="fileInput" accept=".pdf" style="display: none;">
            </div>

            <div class="file-info" id="fileInfo">
                <strong>Selected File:</strong> <span id="fileName"></span>
                <br>
                <small>Size: <span id="fileSize"></span></small>
            </div>

            <div class="progress-bar" id="progressBar">
                <div class="progress-fill" id="progressFill"></div>
            </div>

            <div class="status-message" id="statusMessage"></div>

            <div style="display: flex; gap: 12px; margin-top: 24px;">
                <button class="btn btn-primary" id="convertBtn" disabled>
                    <i class="fas fa-magic"></i> Convert with Premium OCR
                </button>
                <button class="btn btn-secondary" id="cancelBtn" style="display: none;">
                    <i class="fas fa-times"></i> Cancel
                </button>
            </div>
        </div>

        <div class="premium-card">
            <h2><i class="fas fa-info-circle"></i> Premium Features</h2>
            <ul style="list-style: none; padding: 0;">
                <li style="padding: 12px 0; border-bottom: 1px solid var(--border);">
                    <i class="fas fa-check-circle" style="color: var(--success); margin-right: 8px;"></i>
                    <strong>OCR Technology:</strong> Extract text from scanned PDFs and images
                </li>
                <li style="padding: 12px 0; border-bottom: 1px solid var(--border);">
                    <i class="fas fa-check-circle" style="color: var(--success); margin-right: 8px;"></i>
                    <strong>Complex Documents:</strong> Handle multi-column layouts, forms, and structured documents
                </li>
                <li style="padding: 12px 0; border-bottom: 1px solid var(--border);">
                    <i class="fas fa-check-circle" style="color: var(--success); margin-right: 8px;"></i>
                    <strong>High Accuracy:</strong> Enterprise-grade text extraction with Google Document AI
                </li>
                <li style="padding: 12px 0;">
                    <i class="fas fa-check-circle" style="color: var(--success); margin-right: 8px;"></i>
                    <strong>Multi-Language:</strong> Support for Hindi, Unicode, and international fonts
                </li>
            </ul>
        </div>
    </div>
</main>

<!-- SEO Content Section -->
<section class="seo-content">
    <div class="seo-section">
        <h2>Premium PDF to Word Conversion with OCR Technology</h2>
        <p>Our premium PDF to Word converter uses advanced OCR (Optical Character Recognition) technology powered by Google Document AI to extract text from scanned PDFs, images, and complex documents with enterprise-grade accuracy.</p>
        
        <h3>Why Choose Premium PDF to Word Conversion?</h3>
        <h4>Advanced OCR Processing</h4>
        <p>Unlike basic converters that only work with text-based PDFs, our premium service can extract text from scanned documents, images, and PDFs without selectable text. The OCR technology recognizes text and structures even from low-quality scans.</p>
        
        <h4>Complex Document Handling</h4>
        <p>Handle complex document structures including:</p>
        <ul>
            <li>Multi-column layouts and newsletters</li>
            <li>Forms and structured documents</li>
            <li>Mixed text and image layouts</li>
            <li>Documents with annotations and markups</li>
        </ul>
        
        <h3>How Premium Conversion Works</h3>
        <h4>Step 1: Upload Your PDF</h4>
        <p>Upload your scanned PDF or complex document. Maximum file size is 50 MB.</p>
        
        <h4>Step 2: Automatic Processing</h4>
        <p>Our system analyzes your document and processes it with Google Document AI for best results.</p>
        
        <h4>Step 3: High-Accuracy Extraction</h4>
        <p>Google Document AI processes your document with enterprise-grade OCR technology.</p>
        
        <h4>Step 4: Download Word File</h4>
        <p>Receive your converted Word file with preserved formatting, structure, and text accuracy.</p>
        
        <h3>Credit System</h3>
        <p>Premium conversion uses a pay-per-page credit system. Credits are deducted only after successful conversion. Minimum 30 credits required to access premium features. Cost: 2 credits per page for OCR conversion.</p>
        
        <h3>Security & Privacy</h3>
        <p>All conversions are processed securely with SSL encryption. Files are automatically deleted after processing. Your data privacy is our priority.</p>
    </div>
</section>

<!-- Global Footer Placeholder -->
<div id="global-footer-placeholder"></div>

<!-- Non-Convertible Document Popup -->
<div id="popup-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999;"></div>
<div id="non-convertible-popup" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); z-index: 10000; max-width: 500px; width: 90%;">
    <h3 style="color: #e74c3c; margin: 0 0 15px 0; font-size: 24px;">⚠️ This PDF Cannot Be Converted to Word</h3>
    <p id="popup-message" style="color: #555; line-height: 1.6; margin: 0 0 20px 0;">
        This document is not suitable for Word conversion.
    </p>
    <div style="display: flex; gap: 10px; justify-content: center;">
        <button class="btn btn-primary" onclick="redirectToPdfToExcel()" style="padding: 12px 24px; border: none; border-radius: 6px; font-size: 16px; cursor: pointer; background: #3498db; color: white;">
            Convert PDF to Excel Instead
        </button>
        <button class="btn btn-secondary" onclick="closeNonConvertiblePopup()" style="padding: 12px 24px; border: none; border-radius: 6px; font-size: 16px; cursor: pointer; background: #95a5a6; color: white;">
            Close
        </button>
    </div>
</div>

<script src="js/global-components.js" defer></script>
<script type="module" src="/js/auth.js"></script>
<script>
const API_BASE_URL = 'https://pdf-to-word-converter-iwumaktavq-uc.a.run.app';

// Load PDF from sessionStorage if available
async function loadPdfFromSession() {
    try {
        const stored = sessionStorage.getItem('pdfFileForPremium');
        if (stored) {
            const fileData = JSON.parse(stored);
            const byteCharacters = atob(fileData.data);
            const byteNumbers = new Array(byteCharacters.length);
            for (let i = 0; i < byteCharacters.length; i++) {
                byteNumbers[i] = byteCharacters.charCodeAt(i);
            }
            const byteArray = new Uint8Array(byteNumbers);
            const blob = new Blob([byteArray], { type: 'application/pdf' });
            const file = new File([blob], fileData.name, { type: 'application/pdf' });
            
            window.premiumPdfBlob = file;
            window.premiumPdfFilename = fileData.name;
            
            document.getElementById('fileName').textContent = fileData.name;
            document.getElementById('fileSize').textContent = formatFileSize(file.size);
            document.getElementById('fileInfo').classList.add('show');
            document.getElementById('convertBtn').disabled = false;
            
            sessionStorage.removeItem('pdfFileForPremium');
        }
    } catch (error) {
        console.error('Error loading PDF from session:', error);
    }
}

// Check user credits and block access if insufficient
let creditsCheckPassed = false;

async function checkCredits() {
    try {
        const MIN_REQUIRED_CREDITS = 30;
        
        // Get user ID - prefer Firebase auth
        let userId = 'anonymous';
        
        // First try Firebase auth (most reliable)
        if (window.auth && window.auth.currentUser) {
            userId = window.auth.currentUser.uid;
            console.log('Using Firebase auth user ID:', userId);
        } else if (window.auth) {
            // Wait for auth state if auth is ready but user not loaded yet
            const { onAuthStateChanged } = await import("https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js");
            await new Promise((resolve) => {
                let resolved = false;
                const unsubscribe = onAuthStateChanged(window.auth, (user) => {
                    if (!resolved) {
                        resolved = true;
                        unsubscribe();
                        if (user && user.uid) {
                            userId = user.uid;
                            console.log('Got user ID from auth state change:', userId);
                        }
                        resolve();
                    }
                });
                setTimeout(() => {
                    if (!resolved) {
                        resolved = true;
                        unsubscribe();
                        console.warn('Auth state change timeout, using fallback');
                        resolve();
                    }
                }, 2000);
            });
        }
        
        if (userId === 'anonymous') {
            showStatus('Please sign in to use premium conversion. Minimum 30 credits required.', 'error');
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('fileInput');
            const convertBtn = document.getElementById('convertBtn');
            if (uploadArea) uploadArea.classList.add('disabled');
            if (fileInput) fileInput.disabled = true;
            if (convertBtn) convertBtn.disabled = true;
            return false;
        }
        
        console.log(`Checking credits for user: ${userId}, API: ${API_BASE_URL}/api/credits`);
        
        const response = await fetch(`${API_BASE_URL}/api/credits`, {
            method: 'GET',
            headers: {
                'X-User-ID': userId
            }
        });
        
        console.log('Credits API response status:', response.status, response.statusText);
        
        if (response.ok) {
            const data = await response.json();
            console.log('Credits API response data:', data);
            const credits = data.credits || 0;
            
            console.log(`User has ${credits} credits, minimum required: ${MIN_REQUIRED_CREDITS}`);
            
            // Update credit display
            const creditBalanceEl = document.getElementById('creditBalance');
            const creditInfoEl = document.getElementById('creditInfo');
            if (creditBalanceEl) {
                creditBalanceEl.textContent = credits;
            }
            if (creditInfoEl) {
                creditInfoEl.style.display = 'block';
            }
            
            // CRITICAL: Block page access if credits < 30
            if (credits < MIN_REQUIRED_CREDITS) {
                console.warn(`Access denied: User has ${credits} credits, need ${MIN_REQUIRED_CREDITS}`);
                // Hide all premium features
                const premiumCard = document.querySelector('.premium-card');
                if (premiumCard) {
                    premiumCard.style.display = 'none';
                }
                
                // Show access denied message
                const accessDeniedHTML = `
                    <div class="premium-card" style="text-align: center; padding: 60px 40px;">
                        <i class="fas fa-lock" style="font-size: 4rem; color: var(--danger); margin-bottom: 24px;"></i>
                        <h2 style="color: var(--danger); margin-bottom: 16px;">Access Restricted</h2>
                        <p style="font-size: 1.1rem; margin-bottom: 24px; color: var(--muted);">
                            Premium conversion requires minimum <strong>${MIN_REQUIRED_CREDITS} credits</strong>.
                            <br>Your current balance: <strong>${credits} credits</strong>
                        </p>
                        <p style="margin-bottom: 32px; color: var(--muted);">
                            Please purchase credits to access premium features.
                        </p>
                        <div style="display: flex; gap: 12px; justify-content: center; flex-wrap: wrap;">
                            <a href="pricing.html" class="btn btn-primary" style="text-decoration: none;">
                                <i class="fas fa-shopping-cart"></i> Purchase Credits
                            </a>
                            <a href="pdf-to-word-converter.html" class="btn btn-secondary" style="text-decoration: none;">
                                <i class="fas fa-arrow-left"></i> Back to Basic Conversion
                            </a>
                        </div>
                    </div>
                `;
                
                // Insert access denied message before premium card
                const premiumSection = document.querySelector('.premium-section');
                if (premiumSection) {
                    premiumSection.insertAdjacentHTML('afterbegin', accessDeniedHTML);
                }
                
                // Disable all upload and conversion features
                const uploadArea = document.getElementById('uploadArea');
                const fileInput = document.getElementById('fileInput');
                const convertBtn = document.getElementById('convertBtn');
                
                if (uploadArea) uploadArea.classList.add('disabled');
                if (fileInput) fileInput.disabled = true;
                if (convertBtn) convertBtn.disabled = true;
                
                showStatus(`Insufficient credits. Minimum ${MIN_REQUIRED_CREDITS} credits required. You have ${credits}. Please purchase credits to continue.`, 'error');
                
                return false; // Access denied
            } else {
                // Credits sufficient - allow access
                console.log(`✅ Premium page access granted: User ${userId} has ${credits} credits (>= ${MIN_REQUIRED_CREDITS})`);
                creditsCheckPassed = true;
                return true; // Access granted
            }
        } else {
            // If credits API fails, still block access for safety
            console.error('Failed to check credits, blocking access for safety');
            const premiumCard = document.querySelector('.premium-card');
            if (premiumCard) {
                premiumCard.style.display = 'none';
            }
            showStatus('Unable to verify credits. Please refresh the page or contact support.', 'error');
            return false;
        }
    } catch (error) {
        console.error('Error checking credits:', error);
        // On error, block access for safety
        const premiumCard = document.querySelector('.premium-card');
        if (premiumCard) {
            premiumCard.style.display = 'none';
        }
        showStatus('Error checking credits. Please refresh the page or contact support.', 'error');
        return false;
    }
}

// File upload handlers (only enable if credits check passes)
async function initializeUploadHandlers() {
    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('fileInput');
    const convertBtn = document.getElementById('convertBtn');
    const cancelBtn = document.getElementById('cancelBtn');

    if (!uploadArea || !fileInput) {
        console.error('Upload area or file input not found');
        return;
    }

    uploadArea.addEventListener('click', () => {
        if (!creditsCheckPassed) {
            showStatus('Insufficient credits. Minimum 30 credits required. Please purchase credits to continue.', 'error');
            return;
        }
        fileInput.click();
    });

    uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        if (creditsCheckPassed) {
            uploadArea.classList.add('dragover');
        }
    });

    uploadArea.addEventListener('dragleave', () => {
        uploadArea.classList.remove('dragover');
    });

    uploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
        if (!creditsCheckPassed) {
            showStatus('Insufficient credits. Minimum 30 credits required. Please purchase credits to continue.', 'error');
            return;
        }
        const files = e.dataTransfer.files;
        if (files.length > 0 && files[0].type === 'application/pdf') {
            handleFileSelect(files[0]);
        }
    });

    fileInput.addEventListener('change', (e) => {
        if (!creditsCheckPassed) {
            showStatus('Insufficient credits. Minimum 30 credits required. Please purchase credits to continue.', 'error');
            e.target.value = '';
            return;
        }
        if (e.target.files && e.target.files.length > 0) {
            handleFileSelect(e.target.files[0]);
        }
    });
}

function handleFileSelect(file) {
    if (!file) {
        showStatus('No file selected.', 'error');
        return;
    }
    
    if (file.type !== 'application/pdf') {
        showStatus('Please select a PDF file.', 'error');
        return;
    }
    
    if (file.size > 50 * 1024 * 1024) {
        showStatus('File size exceeds 50 MB limit.', 'error');
        return;
    }
    
    // Check credits before allowing file selection
    if (!creditsCheckPassed) {
        console.warn('Credits check failed in handleFileSelect');
        showStatus('Insufficient credits. Minimum 30 credits required. Please purchase credits to continue.', 'error');
        return;
    }
    
    window.premiumPdfBlob = file;
    window.premiumPdfFilename = file.name;
    
    document.getElementById('fileName').textContent = file.name;
    document.getElementById('fileSize').textContent = formatFileSize(file.size);
    document.getElementById('fileInfo').classList.add('show');
    const convertBtn = document.getElementById('convertBtn');
    if (convertBtn) {
        convertBtn.disabled = false;
    }
}

// Convert button handler
const convertBtn = document.getElementById('convertBtn');
if (convertBtn) {
convertBtn.addEventListener('click', async function() {
        // Double-check credits before conversion
        if (!creditsCheckPassed) {
            showStatus('Insufficient credits. Minimum 30 credits required. Please purchase credits to continue.', 'error');
            return;
        }
        
    if (!window.premiumPdfBlob) {
        showStatus('Please select a PDF file first.', 'error');
        return;
    }
    
    convertBtn.disabled = true;
    const cancelBtn = document.getElementById('cancelBtn');
    if (cancelBtn) cancelBtn.style.display = 'inline-flex';
    showProgress(0);
    showStatus('Uploading PDF and processing with Premium OCR...', 'info');
    
    try {
        // Get auth token
        let authToken = null;
        let userId = 'anonymous';
        try {
            const authModule = await import('/js/auth.js').catch(() => null);
            if (authModule && authModule.auth && authModule.auth.currentUser) {
                authToken = await authModule.auth.currentUser.getIdToken();
                userId = authModule.auth.currentUser.uid;
            }
        } catch (e) {
            showStatus('Please sign in to use premium conversion.', 'error');
            convertBtn.disabled = false;
            if (cancelBtn) cancelBtn.style.display = 'none';
            hideProgress();
            return;
        }
        
        if (!authToken) {
            showStatus('Please sign in to use premium conversion.', 'error');
            convertBtn.disabled = false;
            if (cancelBtn) cancelBtn.style.display = 'none';
            hideProgress();
            return;
        }
        
        // Create FormData
        const formData = new FormData();
        const pdfFile = new File([window.premiumPdfBlob], window.premiumPdfFilename || 'document.pdf', { type: 'application/pdf' });
        formData.append('file', pdfFile);
        
        showProgress(30);
        
        // Call premium endpoint
        const response = await fetch(`${API_BASE_URL}/api/convert/pdf-to-word`, {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${authToken}`,
                'X-User-ID': userId
            },
            body: formData
        });
        
        showProgress(70);
        
        if (!response.ok) {
            let errorMessage = 'Conversion failed. Please try again.';
            let errorData = null;
            let showPopup = false;
            
            try {
                errorData = await response.json();
                errorMessage = errorData.detail?.message || errorData.detail?.error || errorData.message || errorData.error || errorMessage;
                
                // Check if this is a truly non-convertible file (show popup)
                if (errorData.detail && errorData.detail.show_popup === true) {
                    showPopup = true;
                }
                
                if (response.status === 402 && errorData.error === 'NOT_ENOUGH_CREDITS') {
                    errorMessage = `Insufficient credits. You need ${errorData.required || 'N/A'} credits but only have ${errorData.available || 0}. Please purchase credits.`;
                    showPopup = false;
                }
            } catch (e) {
                try {
                    const errorText = await response.text();
                    if (errorText) {
                        errorMessage = errorText;
                    }
                } catch (e2) {
                    errorMessage = `Server error (${response.status}): ${response.statusText}`;
                }
            }
            
            // Show popup only for truly non-convertible files
            if (showPopup && typeof showNonConvertiblePopup === 'function') {
                showNonConvertiblePopup();
                showStatus(errorMessage, 'error');
                convertBtn.disabled = false;
                if (cancelBtn) cancelBtn.style.display = 'none';
                hideProgress();
                return;
            }
            
            showStatus(errorMessage, 'error');
            convertBtn.disabled = false;
            if (cancelBtn) cancelBtn.style.display = 'none';
            hideProgress();
            return;
        }
        
        const result = await response.json();
        
        if (result.status !== 'success' && !result.success) {
            throw new Error(result.error || result.detail || result.message || 'Conversion failed');
        }
        
        showProgress(100);
        showStatus(`Success! Converted successfully. Downloading...`, 'success');
        
        // Download Word file
        const downloadUrl = result.primary_download_url || result.download_url;
        if (downloadUrl) {
            setTimeout(() => {
                window.location.href = downloadUrl;
            }, 1000);
        } else {
            throw new Error('No download URL received');
        }
        
    } catch (error) {
        console.error('Premium conversion error:', error);
        showStatus('Conversion failed: ' + error.message, 'error');
        convertBtn.disabled = false;
        const cancelBtn = document.getElementById('cancelBtn');
        if (cancelBtn) cancelBtn.style.display = 'none';
        hideProgress();
    }
});
}

// Cancel button
const cancelBtn = document.getElementById('cancelBtn');
if (cancelBtn) {
cancelBtn.addEventListener('click', () => {
    window.location.href = 'pdf-to-word-converter.html';
});
}

// Helper functions
function showStatus(message, type) {
    const statusEl = document.getElementById('statusMessage');
    if (statusEl) {
        statusEl.textContent = message;
        statusEl.className = 'status-message ' + type;
        statusEl.style.display = 'block';
    }
}

function showProgress(percent) {
    const progressBar = document.getElementById('progressBar');
    const progressFill = document.getElementById('progressFill');
    if (progressBar) progressBar.style.display = 'block';
    if (progressFill) progressFill.style.width = percent + '%';
}

function hideProgress() {
    const progressBar = document.getElementById('progressBar');
    if (progressBar) progressBar.style.display = 'none';
}

function formatFileSize(bytes) {
    if (bytes < 1024) return bytes + ' B';
    if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(2) + ' KB';
    return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
}

function showNonConvertiblePopup(errorType) {
    const popup = document.getElementById('non-convertible-popup');
    const overlay = document.getElementById('popup-overlay');
    const message = document.getElementById('popup-message');
    
    // Customize message based on reason
    if (errorType === 'image_document' || errorType === 'table_document') {
        if (message) message.textContent = 'This document contains mainly tables or structured data. Excel is best for structured data. You can use the PDF to Excel converter instead.';
    } else {
        if (message) message.textContent = 'This document is not suitable for Word conversion. Please try PDF to Excel converter or PDF Editor instead.';
    }
    
    if (popup) popup.style.display = 'block';
    if (overlay) overlay.style.display = 'block';
}

function closeNonConvertiblePopup() {
    const popup = document.getElementById('non-convertible-popup');
    const overlay = document.getElementById('popup-overlay');
    if (popup) popup.style.display = 'none';
    if (overlay) overlay.style.display = 'none';
}

function redirectToPdfToExcel() {
    window.location.href = 'pdf-to-excel-convert.html';
}

// Initialize on page load
window.addEventListener('DOMContentLoaded', async function() {
    // Wait for auth to be ready
    let authReady = false;
    if (window.auth && window.auth.currentUser) {
        authReady = true;
    } else if (window.auth) {
        // Wait for auth state
        const { onAuthStateChanged } = await import("https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js");
        await new Promise((resolve) => {
            const unsubscribe = onAuthStateChanged(window.auth, (user) => {
                unsubscribe();
                authReady = true;
                resolve();
            });
            setTimeout(() => {
                unsubscribe();
                resolve();
            }, 2000);
        });
    }
    
    // Check credits AFTER auth is ready
    creditsCheckPassed = await checkCredits();
    
    // Initialize upload handlers after credits check
    await initializeUploadHandlers();
    
    // Load PDF from sessionStorage if available (only if credits check passed)
    if (creditsCheckPassed) {
        loadPdfFromSession();
    }
});
</script>
</body>
</html>

